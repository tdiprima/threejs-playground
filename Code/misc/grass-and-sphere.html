<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta content="IE=edge" http-equiv="X-UA-Compatible">
  <meta content="width=device-width, initial-scale=1.0" name="viewport">
  <title>Shiny Sphere in Grass</title>
  <!-- hierba y esfera, rolling sphere... -->
  <style>
    body {
      margin: 0;
      overflow: hidden;
    }

    canvas { display: block; }
  </style>
</head>
<body>
<script type="importmap">{
    "imports": {
      "three": "/build/three.module.js",
      "three/addons/": "/jsm/"
    }
  }
</script>
<script async src="/es-module-shims-1.3.6/dist/es-module-shims.js"></script>
<script type="module">
  import * as THREE from "three";
  import {OrbitControls} from "three/addons/controls/OrbitControls.js";

  // Set up the scene
  const scene = new THREE.Scene();

  // Create the camera
  const camera = new THREE.PerspectiveCamera(75, window.innerWidth / window.innerHeight, 0.1, 1000);
  camera.position.z = 5;

  // Create the renderer
  const renderer = new THREE.WebGLRenderer({antialias: true});
  renderer.setSize(window.innerWidth, window.innerHeight);
  renderer.shadowMap.enabled = true; // Enable shadows
  document.body.appendChild(renderer.domElement);

  // Create the sphere
  const sphereGeometry = new THREE.SphereGeometry(1, 32, 32);
  // const sphereMaterial = new THREE.MeshStandardMaterial({ color: 0x555555, metalness: 1, roughness: 0 });
  const sphereMaterial = new THREE.MeshPhongMaterial({color: 0x0000ff});

  const sphere = new THREE.Mesh(sphereGeometry, sphereMaterial);
  sphere.castShadow = true; // Enable shadow casting
  scene.add(sphere);

  // Create the grass
  const grassGeometry = new THREE.PlaneGeometry(10, 10);
  const grassMaterial = new THREE.MeshStandardMaterial({color: 0x00ff00, side: THREE.DoubleSide});
  const grass = new THREE.Mesh(grassGeometry, grassMaterial);
  grass.rotation.x = -Math.PI / 2; // Rotate the grass to face up
  grass.receiveShadow = true; // Enable shadow receiving
  scene.add(grass);

  // Create the light
  const light = new THREE.PointLight(0xffffff, 1, 100);
  light.position.set(0, 3, 3);
  light.castShadow = true; // Enable shadow casting for the light
  scene.add(light);

  // Set up shadow properties
  light.shadow.mapSize.width = 512;
  light.shadow.mapSize.height = 512;
  light.shadow.camera.near = 0.5;
  light.shadow.camera.far = 500;

  // Let there be [more] light
  let directionalLight = new THREE.DirectionalLight(
    0xffffff, // color
    1.1 // intensity
  );
  directionalLight.position.set(2, 2, 5);
  directionalLight.intensity = 1;
  scene.add(directionalLight);

  // Add orbit controls to move the camera
  const controls = new OrbitControls(camera, renderer.domElement);

  // Set up animation variables
  let rotationSpeed = 0.01;
  // let rollingSpeed = 0.1;
  let rollingSpeed = 0.001;

  // Animate the scene
  function animate() {
    requestAnimationFrame(animate);

    // Rotate the sphere
    sphere.rotation.x += rotationSpeed;
    sphere.rotation.y += rotationSpeed;

    // Move the sphere in a rolling motion
    sphere.position.x += Math.cos(sphere.rotation.y) * rollingSpeed;
    sphere.position.z += Math.sin(sphere.rotation.y) * rollingSpeed;

    // Move the grass in the opposite direction to give the illusion of rolling
    // Fisher Price alert... There's no texture to this grass.
    grass.position.x -= Math.cos(sphere.rotation.y) * rollingSpeed;
    grass.position.z -= Math.sin(sphere.rotation.y) * rollingSpeed;

    // Render the scene
    renderer.render(scene, camera);
  }

  // Start the animation
  animate();
</script>
</body>
</html>
