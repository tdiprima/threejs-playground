<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta content="width=device-width, initial-scale=1.0" name="viewport">
  <title>Which of these things does linewidth?</title>
  <!-- https://stackoverflow.com/questions/70531225/adding-thickness-to-lines-in-threejs -->
</head>
<body>
<script async src="/es-module-shims-1.3.6/dist/es-module-shims.js"></script>
<script type="importmap">{
    "imports": {
      "three": "/build/three.module.js",
      "three/examples/": "/jsm/"
    }
  }
</script>
<script type="module">
  import * as THREE from 'three';

  import { LineMaterial } from 'three/examples/lines/LineMaterial.js';
  import { LineSegments2 } from 'three/examples/lines/LineSegments2.js';
  import { LineSegmentsGeometry } from 'three/examples/lines/LineSegmentsGeometry.js';
  import { Line2 } from 'three/examples/lines/Line2.js';
  import { LineGeometry } from 'three/examples/lines/LineGeometry.js';

  console.log(`%cREVISION ${THREE.REVISION}`, "color: #ff6a5a; font-size: larger;");

  let scene = new THREE.Scene();
  let camera = new THREE.PerspectiveCamera(50, 500 / 400, 0.1, 1000);
  let renderer = new THREE.WebGLRenderer();
  renderer.setClearColor(new THREE.Color(0x041122));
  renderer.setSize(825, 600);
  document.body.appendChild(renderer.domElement);

  function myLine2() {
    // Originally https://threejs.org/manual/examples/scenegraph-sun-earth-moon.html
    // https://codesandbox.io/s/static-forked-68lif?file=/index.html:0-3768
    function QuadGeometry(w, h) {
      let pts = [
        [-2, 0],
        [2, 0]
      ].map(p => {
        return new THREE.Vector2(p[0], p[1]);
      });
      let g = new THREE.BufferGeometry().setFromPoints(pts);
      g.scale(w, h, 1);

      let unindexed = g.toNonIndexed();
      let geo = new LineGeometry().setPositions(unindexed.getAttribute('position').array);

      return geo;
    }

    let g = QuadGeometry(11, 11);
    let m = new LineMaterial({
      color: "yellow",
      linewidth: 5  // Set the desired line thickness
    });
    // This really belongs in render, but...
    m.resolution.set(window.innerWidth, window.innerHeight); // resolution of the viewport
    let quad = new Line2(g, m);

    scene.add(quad);
  }

  function lineSegments() {
    // let vertices = [2, 0, 0, 2, 0, 0, 0, 0, -2, 0, 0, 2];
    // let vertices = [1, 0, 0, 1, 0, 0, 0, 0, -1, 0, 0, 1];

    // The positions should be in the format of [x1, y1, z1, x2, y2, z2, ...]
    let vertices = [-1, 0, 0, 1, 0, 0];

    // For testing:
    let geometry;
    // let positions = new Float32Array(vertices);
    // let positionAttribute = new THREE.BufferAttribute(positions, 3);
    // geometry = new LineSegmentsGeometry();
    // geometry.setAttribute('position', positionAttribute);
    // // Wrong, 12.
    // console.log("%cFloat32Array", "color: #ff00cc;", geometry.attributes.position.array);

    // For real:
    geometry = new LineSegmentsGeometry().setPositions(vertices);
    // Correct, 24.
    console.log("%cArray", "color: #ccff00;", geometry.attributes.position.array);

    let material = new LineMaterial({ linewidth: 5, color: 0xff0000 });
    // The LineMaterial expects the resolution of the material to be set explicitly, which affects how the lines are rendered.
    material.resolution.set(window.innerWidth, window.innerHeight);

    let line = new LineSegments2(geometry, material);

    scene.add(line);
  }

  class CustomSinCurve extends THREE.Curve {
    // https://threejs.org/docs/#api/en/geometries/TubeGeometry

    constructor(scale = 1) {
      super();
      this.scale = scale;
    }

    getPoint(t, optionalTarget = new THREE.Vector3()) {
      let tx = t * 3 - 1.5;
      let ty = Math.sin(2 * Math.PI * t);
      let tz = 0;

      return optionalTarget.set(tx, ty, tz).multiplyScalar(this.scale);
    }

    // let curve = new THREE.LineCurve3(
    //   new THREE.Vector3(-2, 0, 0), // Start point
    //   new THREE.Vector3(2, 0, 0) // End point
    // );
  }

  function tubular() {
    // https://stackoverflow.com/questions/11638883/thickness-of-lines-using-three-linebasicmaterial
    let curve = new CustomSinCurve(10);

    let segments = 20;
    let thickness = 0.5;
    let radiusSegments = 8;
    let tubeGeometry = new THREE.TubeBufferGeometry(curve, segments, thickness, radiusSegments);

    let material = new THREE.MeshBasicMaterial({ color: 0x00ff00 });

    let tubeMesh = new THREE.Mesh(tubeGeometry, material);

    scene.add(tubeMesh);
  }

  // myLine2();
  lineSegments();
  // tubular();

  // TODO:
  camera.position.z = 5;

  // renders the scene
  let render = function () {
    requestAnimationFrame(render);
    renderer.render(scene, camera);
    // m.resolution.set(window.innerWidth, window.innerHeight);
  };

  render();
</script>
</body>
</html>
