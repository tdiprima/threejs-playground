<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta content="width=device-width, initial-scale=1.0" name="viewport">
  <title>01100110 01110010 01100101 01100101</title>
  <!-- https://stackoverflow.com/questions/70531225/adding-thickness-to-lines-in-threejs -->
</head>
<body>
<script async src="/es-module-shims-1.3.6/dist/es-module-shims.js"></script>
<script type="importmap">{
    "imports": {
      "three": "/build/three.module.js",
      "three/addons/": "/jsm/"
    }
  }
</script>
<script type="module">
  // Originally https://threejs.org/manual/examples/scenegraph-sun-earth-moon.html
  import * as THREE from 'three';

  // Line2
  import { Line2 } from 'three/addons/lines/Line2.js';
  import { LineMaterial } from 'three/addons/lines/LineMaterial.js';
  import { LineGeometry } from 'three/addons/lines/LineGeometry.js';

  // Segments
  import { LineSegmentsGeometry } from 'three/addons/lines/LineSegmentsGeometry.js';

  let scene = new THREE.Scene();
  let camera = new THREE.PerspectiveCamera(50, 500 / 400, 0.1, 1000);
  let renderer = new THREE.WebGLRenderer();
  renderer.setClearColor(new THREE.Color(0x041122));
  renderer.setSize(825, 600);
  document.body.appendChild(renderer.domElement);

  function myLine2() {
    // https://codesandbox.io/s/static-forked-68lif?file=/index.html:0-3768
    function QuadGeometry(w, h) {
      let pts = [
        [-2, 0],
        [2, 0]
      ].map(p => {
        return new THREE.Vector2(p[0], p[1]);
      });
      let g = new THREE.BufferGeometry().setFromPoints(pts);
      g.scale(w, h, 1);

      let unindexed = g.toNonIndexed();
      let geo = new LineGeometry().setPositions(unindexed.getAttribute('position').array);

      return geo;
    }

    let g = QuadGeometry(11, 11);
    let m = new LineMaterial({
      color: "yellow",
      linewidth: 5  // Set the desired line thickness
    });
    // This really belongs in render, but...
    m.resolution.set(window.innerWidth, window.innerHeight); // resolution of the viewport
    let quad = new Line2(g, m);

    scene.add(quad);
  }

  function lineSegments() {
    // Define your custom line segments as an array of vertices
    let vertices = [
      -2, 0, 0, // Start point of first segment
      2, 0, 0, // End point of first segment
      0, 0, -2, // Start point of second segment
      0, 0, 2, // End point of second segment
      // Add more vertices for additional segments
    ];

    // Create a LineSegments geometry
    let geometry = new LineSegmentsGeometry().setPositions(vertices);
    // OR -
    // let geometry = new LineSegmentsGeometry().setPositions([-2, 0, 0, 2, 0, 0]);

    // Create a material for the line
    let material = new LineMaterial({
      linewidth: 5, // EH! WRONG.
      color: 0xff0000 // Set the line color
    });

    // Create the LineSegments object
    let line = new THREE.LineSegments(geometry, material);

    // Add the line to the scene
    scene.add(line);
  }

  class CustomSinCurve extends THREE.Curve {
    // https://threejs.org/docs/#api/en/geometries/TubeGeometry

    constructor(scale = 1) {
      super();
      this.scale = scale;
    }

    getPoint(t, optionalTarget = new THREE.Vector3()) {
      let tx = t * 3 - 1.5;
      let ty = Math.sin(2 * Math.PI * t);
      let tz = 0;

      return optionalTarget.set(tx, ty, tz).multiplyScalar(this.scale);
    }
  }

  function tubular() {
    // Create a custom curve for the line
    // let curve = new THREE.LineCurve3(
    //   new THREE.Vector3(-2, 0, 0), // Start point
    //   new THREE.Vector3(2, 0, 0) // End point
    // );

    let curve = new CustomSinCurve(10);

    // Create a tube geometry with the custom curve (curve, segments, thickness, radiusSegments)
    let segments = 20;
    let thickness = 0.5;
    let radiusSegments = 8;
    let tubeGeometry = new THREE.TubeBufferGeometry(curve, segments, thickness, radiusSegments);

    // Create a material for the tube
    let material = new THREE.MeshBasicMaterial({ color: 0x00ff00 });

    // Create the mesh using the tube geometry and material
    let tubeMesh = new THREE.Mesh(tubeGeometry, material);

    // Add the tube mesh to the scene
    scene.add(tubeMesh);
  }

  function parallel() {
    // todo: understand when to use Vector3, and when to use flat array
    let positions = new Float32Array([-1, 0, 0, 0, 1, 0, 1, 0, 0, 0, -1, 0, -1, 0, 0]);

    // Create a LineSegments geometry
    let geometry = new LineSegmentsGeometry().setPositions(positions);
    console.log(positions);

    // Create a material for the line
    let material = new LineMaterial({
      linewidth: 5, // Set the desired line thickness
      color: 0x00ffff, // Set the line color
    });

    // Create the LineSegments object
    let line = new THREE.LineSegments(geometry, material);

    // Add the line to the scene
    scene.add(line);
  }

  // todo: play
  myLine2();
  lineSegments();
  tubular();
  parallel();

  // default camera pos
  camera.position.z = 100;

  // renders the scene
  let render = function () {
    requestAnimationFrame(render);
    renderer.render(scene, camera);
    // m.resolution.set(window.innerWidth, window.innerHeight);
  };

  render();
</script>
</body>
</html>
