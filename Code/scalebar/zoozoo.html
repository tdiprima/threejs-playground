<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta content="width=device-width, initial-scale=1.0" name="viewport">
  <title>Zoo zoo zoo</title>
  <!-- <link href="/css/main.css" rel="stylesheet"> -->
  <style>
    .label {
      color: black;
      font-family: Arial, sans-serif;
      border: 1px solid lime;
    }
  </style>
</head>
<body>
<script type="importmap">{
  "imports": {
    "three": "/build/three.module.js",
    "three/examples/": "/jsm/"
  }
}
</script>
<script async src="/es-module-shims-1.3.6/dist/es-module-shims.js"></script>
<script type="module">
  import * as THREE from "three";
  import { CSS2DRenderer, CSS2DObject } from 'three/examples/renderers/CSS2DRenderer.js';
  console.info({ CSS2DRenderer, CSS2DObject });
  // import { OrbitControls } from 'three/examples/controls/OrbitControls.js';

  let scene = new THREE.Scene();
  let camera = new THREE.PerspectiveCamera(75, window.innerWidth / window.innerHeight, 0.1, 1000);
  camera.position.z = 5;

  let renderer = new THREE.WebGLRenderer({ antialias: true });
  renderer.setSize(window.innerWidth, window.innerHeight);
  document.body.appendChild(renderer.domElement);

  // const controls = new OrbitControls(camera, renderer.domElement);

  let geometry = new THREE.BoxGeometry(1, 1, 1);
  let material = new THREE.MeshBasicMaterial({ color: 0x0000ff });
  let cube = new THREE.Mesh(geometry, material);
  scene.add(cube);

  // Create scale bar mesh
  let scaleBarGeometry = new THREE.PlaneGeometry(1, 0.1);
  let scaleBarMaterial = new THREE.MeshBasicMaterial({ color: 0xffffff });
  let scaleBar = new THREE.Mesh(scaleBarGeometry, scaleBarMaterial);
  scaleBar.position.set(-2, -2, 0); // Set initial position of the scale bar
  scene.add(scaleBar);

  // Create a label for the scale bar
  let labelDiv = document.createElement('div');
  labelDiv.className = 'label';
  labelDiv.textContent = 'Scale: ';
  labelDiv.style.marginTop = '-1em';
  let label = new CSS2DObject(labelDiv);
  label.position.set(0, 0.1, 0); // Set position of label above the scale bar
  scaleBar.add(label);

  let labelRenderer = new CSS2DRenderer();
  labelRenderer.setSize(window.innerWidth, window.innerHeight);
  labelRenderer.domElement.style.position = 'absolute';
  labelRenderer.domElement.style.top = '0px';
  document.body.appendChild(labelRenderer.domElement);

  function calculateScale(zoom) {
    // This function should return a scale value based on the camera's zoom
    // Here's a simple example that inversely scales the bar with the camera's zoom
    return 1 / zoom;
  }

  function update() {
    // Update scale bar position relative to the camera
    let vector = new THREE.Vector3(-0.95, -0.95, -1);
    vector.unproject(camera);
    scaleBar.position.copy(vector);

    // Update scale bar size based on camera zoom
    let scale = calculateScale(camera.zoom);
    scaleBar.scale.set(scale, 1, 1);

    // Update text labels
    labelDiv.textContent = `Scale: ${(1 / scale).toFixed(2)}`;
  }

  window.addEventListener("resize", function () {
    renderer.setSize(window.innerWidth, window.innerHeight);
    camera.aspect = window.innerWidth / window.innerHeight;
    camera.updateProjectionMatrix();
  });

  function animate() {
    requestAnimationFrame(animate);
    update();
    // controls.update();
    renderer.render(scene, camera);
    labelRenderer.render(scene, camera);
  }

  animate();
</script>
</body>
</html>
