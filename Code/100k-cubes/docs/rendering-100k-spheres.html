<!DOCTYPE html>
<html lang="en">
  <head>
  <!-- https://velasquezdaniel.com/blog/rendering-100k-spheres-instantianing-and-draw-calls/ -->
  <meta charSet="utf-8"/>
  <meta http-equiv="x-ua-compatible" content="ie=edge"/>
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"/>
  <style data-href="/commons.af2791e6252d6ec634ad.css">.blog-post-preview-module--root--3atzz{display:blog;color:inherit;text-decoration:none}@media (min-width:675px){.blog-post-preview-module--inList--3aHje{display:grid;grid-template-columns:1fr 2fr;grid-gap:2em}}.blog-post-preview-module--leadMediaThumb--10e8T{position:relative;padding-bottom:66.666%;background:#e7ebed}.blog-post-preview-module--leadMediaThumb--10e8T img{position:absolute;top:0;left:0;width:100%;height:100%;-o-object-fit:cover;object-fit:cover}@media (hover:hover){.blog-post-preview-module--root--3atzz:hover .blog-post-preview-module--title--35-HT{text-decoration:underline}}@media (min-width:675px){.blog-post-preview-module--inList--3aHje .blog-post-preview-module--title--35-HT{margin-top:0}}.blog-post-preview-module--excerpt--2MJ55 p{margin:.5em 0}.blog-post-preview-module--excerpt--2MJ55 strong{font-weight:600}.blog-post-preview-module--date--1QZQ0{font-size:.875rem;line-height:1.5;color:#697a90}.blog-post-preview-list-module--root--2LgdR{margin:2em 0 4em}.blog-post-preview-list-module--headline--3j8kB{font-size:.625rem;line-height:1.2;font-weight:600;text-transform:uppercase;letter-spacing:.5px;margin:2rem 0}.blog-post-preview-list-module--grid--S1onS{margin:0;padding:0;list-style:none;display:grid;grid-template-columns:1fr;grid-column-gap:2em;grid-row-gap:2em}.blog-post-preview-list-module--browseMoreNav--3bwJw{margin-top:2rem;text-align:center}.blog-post-preview-list-module--browseMoreNav--3bwJw a{display:inline-block;padding:.5rem 0;color:inherit;text-decoration:none}@media (hover:hover){.blog-post-preview-list-module--browseMoreNav--3bwJw a:hover{color:#156dff}}

/*! normalize.css v8.0.1 | MIT License | github.com/necolas/normalize.css */html{line-height:1.15;-webkit-text-size-adjust:100%}main{display:block}h1{font-size:2em;margin:.67em 0}pre{font-family:monospace,monospace;font-size:1em}a{background-color:transparent}b,strong{font-weight:bolder}code{font-family:monospace,monospace;font-size:1em}img{border-style:none}button,input{font-family:inherit;font-size:100%;line-height:1.15;margin:0;overflow:visible}button{text-transform:none}[type=button],[type=reset],[type=submit],button{-webkit-appearance:button}[type=button]::-moz-focus-inner,[type=reset]::-moz-focus-inner,[type=submit]::-moz-focus-inner,button::-moz-focus-inner{border-style:none;padding:0}[type=button]:-moz-focusring,[type=reset]:-moz-focusring,[type=submit]:-moz-focusring,button:-moz-focusring{outline:1px dotted ButtonText}progress{vertical-align:baseline}[type=checkbox],[type=radio]{box-sizing:border-box;padding:0}[type=number]::-webkit-inner-spin-button,[type=number]::-webkit-outer-spin-button{height:auto}[type=search]{-webkit-appearance:textfield;outline-offset:-2px}[type=search]::-webkit-search-decoration{-webkit-appearance:none}::-webkit-file-upload-button{-webkit-appearance:button;font:inherit}summary{display:list-item}[hidden],template{display:none}html{box-sizing:border-box;font-family:sans-serif}*,:after,:before{box-sizing:inherit}blockquote,figure,h1,h2,h3,h4,h5,p,pre{margin:0}button{background:transparent;padding:0}button:focus{outline:1px dotted;outline:5px auto -webkit-focus-ring-color}ol,ul{list-style:none;margin:0;padding:0}html{font-family:-apple-system,BlinkMacSystemFont,Segoe UI,Roboto,Helvetica Neue,Arial,Noto Sans,sans-serif,Apple Color Emoji,Segoe UI Emoji,Segoe UI Symbol,Noto Color Emoji}*,:after,:before{border:0 solid #e2e8f0}img{border-style:solid}input::-webkit-input-placeholder{color:#a0aec0}input::-moz-placeholder{color:#a0aec0}input:-ms-input-placeholder{color:#a0aec0}input::-ms-input-placeholder{color:#a0aec0}input::placeholder{color:#a0aec0}[role=button],button{cursor:pointer}h1,h2,h3,h4,h5{font-size:inherit;font-weight:inherit}a{color:inherit;text-decoration:inherit}button,input{padding:0;line-height:inherit;color:inherit}code,pre{font-family:SFMono-Regular,Menlo,Monaco,Consolas,Liberation Mono,Courier New,monospace}canvas,iframe,img,svg{display:block;vertical-align:middle}img{max-width:100%;height:auto}.container{width:100%}@media (min-width:413px){.container{max-width:413px}}@media (min-width:640px){.container{max-width:640px}}@media (min-width:768px){.container{max-width:768px}}@media (min-width:1024px){.container{max-width:1024px}}@media (min-width:1280px){.container{max-width:1280px}}@media (min-width:1440px){.container{max-width:1440px}}.bg-transparent{background-color:transparent}.bg-white{background-color:#fff}.bg-gray-800{background-color:#2d3748}.bg-darkBlue{background-color:#0f121d}.hover\:bg-transparent:hover{background-color:transparent}.hover\:bg-white:hover{background-color:#fff}.bg-cover{background-size:cover}.border-transparent{border-color:transparent}.border-white{border-color:#fff}.border-gray-200{border-color:#edf2f7}.rounded-soft{border-radius:3px}.border-none{border-style:none}.border-1{border-width:1px}.border-t-1{border-top-width:1px}.border-b-1{border-bottom-width:1px}.border-b-2{border-bottom-width:3px}.border-l-4{border-left-width:4px}.cursor-pointer{cursor:pointer}.block{display:block}.inline-block{display:inline-block}.inline{display:inline}.flex{display:-webkit-box;display:flex}.inline-flex{display:-webkit-inline-box;display:inline-flex}.hidden{display:none}.flex-row{-webkit-box-orient:horizontal;flex-direction:row}.flex-col,.flex-row{-webkit-box-direction:normal}.flex-col{-webkit-box-orient:vertical;flex-direction:column}.items-end{-webkit-box-align:end;align-items:flex-end}.items-center{-webkit-box-align:center;align-items:center}.justify-start{-webkit-box-pack:start;justify-content:flex-start}.justify-end{-webkit-box-pack:end;justify-content:flex-end}.justify-center{-webkit-box-pack:center;justify-content:center}.justify-between{-webkit-box-pack:justify;justify-content:space-between}.flex-1{-webkit-box-flex:1;flex:1 1 0%}.flex-grow-0{-webkit-box-flex:0;flex-grow:0}.font-body{font-family:Inter,serif}.font-display{font-family:fertigo-pro,sans-serif}.font-code{font-family:SFMono-Regular,Menlo,Monaco,Consolas,Liberation Mono,Courier New,monospace}.font-light{font-weight:300}.font-normal{font-weight:400}.font-semibold{font-weight:600}.font-bold{font-weight:700}.h-full{height:100%}.h-screen{height:100vh}.leading-none{line-height:1}.leading-tight{line-height:1.25}.leading-snug{line-height:1.375}.leading-normal{line-height:1.5}.leading-relaxed{line-height:1.625}.leading-extra-relaxed{line-height:1.8}.list-inside{list-style-position:inside}.list-none{list-style-type:none}.list-disc{list-style-type:disc}.list-decimal{list-style-type:decimal}.m-0{margin:0}.mx-1{margin-left:8px;margin-right:8px}.my-7{margin-top:48px;margin-bottom:48px}.mx-auto{margin-left:auto;margin-right:auto}.mb-1{margin-bottom:8px}.mt-2{margin-top:12px}.mb-2{margin-bottom:12px}.mb-3{margin-bottom:16px}.mb-4{margin-bottom:24px}.mt-5{margin-top:32px}.mt-7{margin-top:48px}.mb-7{margin-bottom:48px}.mb-8{margin-bottom:56px}.mb-9{margin-bottom:64px}.-ml-5{margin-left:-32px}.max-w-sm{max-width:22rem}.max-w-2xl{max-width:35rem}.max-w-3xl{max-width:40rem}.max-w-desktop{max-width:80rem}.outline-none{outline:0}.overflow-hidden{overflow:hidden}.overflow-x-auto{overflow-x:auto}.p-1{padding:8px}.p-3{padding:16px}.px-0{padding-left:0;padding-right:0}.py-2{padding-top:12px;padding-bottom:12px}.px-2{padding-left:12px;padding-right:12px}.px-3{padding-left:16px;padding-right:16px}.py-4{padding-top:24px;padding-bottom:24px}.px-4{padding-left:24px;padding-right:24px}.py-5{padding-top:32px;padding-bottom:32px}.px-5{padding-left:32px;padding-right:32px}.py-6{padding-top:40px;padding-bottom:40px}.px-6{padding-left:40px;padding-right:40px}.py-1\/2{padding-top:4px;padding-bottom:4px}.pl-0{padding-left:0}.pt-1{padding-top:8px}.pr-1{padding-right:8px}.pb-1{padding-bottom:8px}.pl-1{padding-left:8px}.pb-3{padding-bottom:16px}.pr-4{padding-right:24px}.pb-4{padding-bottom:24px}.pl-4{padding-left:24px}.pb-5{padding-bottom:32px}.pt-6{padding-top:40px}.pr-6{padding-right:40px}.pb-7{padding-bottom:48px}.pt-8{padding-top:56px}.pb-8{padding-bottom:56px}.pt-9{padding-top:64px}.pb-9{padding-bottom:64px}.last\:pr-0:last-child{padding-right:0}.last\:pb-0:last-child{padding-bottom:0}.static{position:static}.fixed{position:fixed}.absolute{position:absolute}.relative{position:relative}.top-0{top:0}.right-0{right:0}.bottom-0{bottom:0}.left-0{left:0}.fill-current{fill:currentColor}.text-left{text-align:left}.text-center{text-align:center}.text-black{color:#000}.text-white{color:#fff}.text-bodyWhite{color:#e3e3f5}.text-darkBlue{color:#0f121d}.text-lowerWhite{color:#d6d4d4}.text-lowWhite{color:#93939e}.text-highWhite{color:#efeff4}.hover\:text-black:hover{color:#000}.hover\:text-white:hover{color:#fff}.hover\:text-gray-600:hover{color:#718096}.text-xs{font-size:.75rem}.text-sm{font-size:.875rem}.text-lg{font-size:1.125rem}.text-2lg{font-size:1.25rem}.text-xl{font-size:1.5rem}.text-2xl{font-size:1.875rem}.text-3xl{font-size:2rem}.italic{font-style:italic}.uppercase{text-transform:uppercase}.capitalize{text-transform:capitalize}.no-underline{text-decoration:none}.tracking-normal{letter-spacing:0}.tracking-wide{letter-spacing:.025em}.tracking-wider{letter-spacing:.05em}.tracking-widest{letter-spacing:.1em}.tracking-tiny{letter-spacing:.01em}.whitespace-no-wrap{white-space:nowrap}.whitespace-pre{white-space:pre}.w-1\/3{width:33.333333%}.w-2\/3{width:66.666667%}.w-6\/12{width:50%}.w-10\/12{width:83.333333%}.w-11\/12{width:91.666667%}.w-full{width:100%}.w-screen{width:100vw}.w-full-bleed-2{width:calc(100% + 64px)}.z-50{z-index:50}.z-minus1{z-index:-1}@font-face{font-family:Inter;font-style:normal;font-weight:300;font-display:swap;src:url(/static/Inter-Light-a1f9e860d918b33aa82a0c2c10d30d6f.woff2) format("woff2"),url(/static/Inter-Light-c58ea231468353018b9f8ca321f18282.woff) format("woff")}@font-face{font-family:Inter;font-style:italic;font-weight:300;font-display:swap;src:url(/static/Inter-LightItalic-778bddb259920029e780cbebc8d88f72.woff2) format("woff2"),url(/static/Inter-LightItalic-5cef43e5c2a3cc7efe510e791b70d79a.woff) format("woff")}@font-face{font-family:Inter;font-style:normal;font-weight:400;font-display:swap;src:url(/static/Inter-Regular-1e081edc16d92d42aeccec760174fbf4.woff2) format("woff2"),url(/static/Inter-Regular-3ae6a7d3890c33d857fc00bd2e4c4820.woff) format("woff")}@font-face{font-family:Inter;font-style:italic;font-weight:400;font-display:swap;src:url(/static/Inter-Italic-2b94fbba68b9cd1f27d6a45d210cce99.woff2) format("woff2"),url(/static/Inter-Italic-5ddabe6d5f3898bd2f4bbf2d71e3548e.woff) format("woff")}@font-face{font-family:Inter;font-style:normal;font-weight:600;font-display:swap;src:url(/static/Inter-SemiBold-4663322354d4300146ac57cd55daabf2.woff2) format("woff2"),url(/static/Inter-SemiBold-19b57197b819695d334b9961ee41910e.woff) format("woff")}@font-face{font-family:Inter;font-style:italic;font-weight:600;font-display:swap;src:url(/static/Inter-SemiBoldItalic-30785b8aea4a0de8fe92363390bcbfd5.woff2) format("woff2"),url(/static/Inter-SemiBoldItalic-32bb0e26464b0a6ff79016e6ad0af5bb.woff) format("woff")}html{font-family:Inter,serif;font-size:1em;line-height:1.5;font-feature-settings:"ss03","cv08"}*{box-sizing:border-box}body{-webkit-font-smoothing:antialiased;background:#0f121d;color:#fff;margin:0}pre{white-space:pre-wrap}body,body>div,body>div>div,html{height:100%}@media (min-width:1024px){.feature-left{margin-left:calc(33.33333% - 8px)}.feature-right{margin-left:calc(16.66667% - 40px)}}@media (min-width:1440px){.feature-left{margin-left:16.66667%}}.title-link{display:inline-block;margin-left:.5rem;height:1em;color:#fff;fill:#fff;stroke:#fff;-webkit-transform:translateY(.2em);transform:translateY(.2em)}.centered-block{margin-bottom:0;margin-top:40px}.centered-block+.centered-block{margin-top:0;margin-bottom:40px}p{letter-spacing:-.014em}.font-feature-2{font-feature-settings:"ss03","ss01","cv08","cv11"}.title{font-size:60px;font-weight:800}.image{width:100%;padding-bottom:60.6060606%}.feature-body:hover a,.feature .feature-img:hover+.feature-body a{text-decoration:underline}@keyframes jumpy{0%{-webkit-transform:scaleX(1) scaleY(1);transform:scaleX(1) scaleY(1)}70%{-webkit-transform:scaleX(1.1) scaleY(.9);transform:scaleX(1.1) scaleY(.9)}to{-webkit-transform:scaleX(1) scaleY(1);transform:scaleX(1) scaleY(1)}}@media (min-width:413px){.xs\:px-6{padding-left:40px;padding-right:40px}.xs\:text-xl{font-size:1.5rem}.xs\:text-4xl{font-size:3rem}.xs\:w-9\/12{width:75%}}@media (min-width:640px){.sm\:flex-row{-webkit-box-orient:horizontal;-webkit-box-direction:normal;flex-direction:row}.sm\:justify-start{-webkit-box-pack:start;justify-content:flex-start}.sm\:list-none{list-style-type:none}.sm\:mb-0{margin-bottom:0}.sm\:mb-3{margin-bottom:16px}.sm\:mb-4{margin-bottom:24px}.sm\:-ml-3{margin-left:-16px}.sm\:px-0{padding-left:0;padding-right:0}.sm\:px-7{padding-left:48px;padding-right:48px}.sm\:pr-1{padding-right:8px}.sm\:pl-2{padding-left:12px}.sm\:pl-3{padding-left:16px}.sm\:pl-4{padding-left:24px}.sm\:pt-6{padding-top:40px}.sm\:pb-6{padding-bottom:40px}.sm\:pt-9{padding-top:64px}.sm\:text-base{font-size:1rem}.sm\:text-lg{font-size:1.125rem}.sm\:text-2xl{font-size:1.875rem}.sm\:text-3xl{font-size:2rem}.sm\:text-5xl{font-size:3.75rem}.sm\:w-auto{width:auto}.sm\:w-6\/12{width:50%}.sm\:w-10\/12{width:83.333333%}.sm\:w-full{width:100%}.sm\:w-full-bleed{width:calc(100% + 32px)}}@media (min-width:768px){.md\:flex-row{-webkit-box-orient:horizontal;-webkit-box-direction:normal;flex-direction:row}.md\:mx-0{margin-left:0;margin-right:0}.md\:mx-auto{margin-left:auto;margin-right:auto}.md\:-mt-5{margin-top:-32px}.md\:p-7{padding:48px}.md\:px-7{padding-left:48px;padding-right:48px}.md\:pb-0{padding-bottom:0}.md\:pl-0{padding-left:0}.md\:pl-1{padding-left:8px}.md\:pr-5{padding-right:32px}.md\:pt-9{padding-top:64px}.md\:text-center{text-align:center}.md\:text-xl{font-size:1.5rem}.md\:text-3xl{font-size:2rem}.md\:w-auto{width:auto}.md\:w-1\/2{width:50%}.md\:w-4\/12{width:33.333333%}.md\:w-5\/12{width:41.666667%}.md\:w-7\/12{width:58.333333%}.md\:w-10\/12{width:83.333333%}.md\:w-11\/12{width:91.666667%}.md\:w-full{width:100%}}@media (min-width:1024px){.lg\:bg-transparent{background-color:transparent}.lg\:border-b-0{border-bottom-width:0}.lg\:border-l-2{border-left-width:3px}.lg\:flex-row{-webkit-box-orient:horizontal;flex-direction:row}.lg\:flex-col,.lg\:flex-row{-webkit-box-direction:normal}.lg\:flex-col{-webkit-box-orient:vertical;flex-direction:column}.lg\:items-start{-webkit-box-align:start;align-items:flex-start}.lg\:justify-start{-webkit-box-pack:start;justify-content:flex-start}.lg\:justify-end{-webkit-box-pack:end;justify-content:flex-end}.lg\:mx-0{margin-left:0;margin-right:0}.lg\:mb-2{margin-bottom:12px}.lg\:-ml-2{margin-left:-12px}.lg\:last\:mb-0:last-child{margin-bottom:0}.lg\:px-0{padding-left:0;padding-right:0}.lg\:pb-0{padding-bottom:0}.lg\:pl-0{padding-left:0}.lg\:pr-1{padding-right:8px}.lg\:pl-1{padding-left:8px}.lg\:pr-2{padding-right:12px}.lg\:pl-2{padding-left:12px}.lg\:pl-5{padding-left:32px}.lg\:pl-m-3\/24{padding-left:12.5%}.lg\:text-left{text-align:left}.lg\:text-3xl{font-size:2rem}.lg\:text-4xl{font-size:3rem}.lg\:w-auto{width:auto}.lg\:w-1\/2{width:50%}.lg\:w-2\/12{width:16.666667%}.lg\:w-3\/12{width:25%}.lg\:w-5\/12{width:41.666667%}.lg\:w-7\/12{width:58.333333%}.lg\:w-9\/12{width:75%}.lg\:w-full{width:100%}.lg\:w-8\/12-bleed{width:calc(66.66667% + 32px)}}@media (min-width:1280px){.xl\:max-w-4xl{max-width:46rem}.xl\:text-2lg{font-size:1.25rem}.xl\:text-xl{font-size:1.5rem}.xl\:text-3xl2{font-size:2.2rem}.xl\:w-4\/12{width:33.333333%}.xl\:w-8\/12{width:66.666667%}.xl\:w-9\/12{width:75%}.xl\:w-9\/12-bleed{width:calc(75% + 32px)}}@media (min-width:1440px){.\32xl\:w-9\/12{width:75%}}</style><style data-href="/styles.187861bd865b9dbb0d00.css">.author-list-module--root--1p3hD{margin:2rem 0 3rem;border-top:1px solid #e7ebed}.author-list-module--headline--2Fplz{font-weight:600;margin:.5rem 0 0}.author-list-module--list--zu1zx{list-style:none;margin:0;padding:0}.author-list-module--listItem--1VB46{font-size:.875rem;margin:1rem 0;display:-webkit-box;display:flex;-webkit-box-pack:center;justify-content:center;-webkit-box-align:center;align-items:center}.author-list-module--listItem--1VB46>div:last-child{-webkit-box-flex:1;flex:1;margin-left:.5rem}.author-list-module--avatar--2Va-e{position:relative;width:3em;height:3em;background:#e7ebed;border-radius:50%;overflow:hidden}.author-list-module--avatar--2Va-e img{width:100%;height:100%;vertical-align:top;-o-object-fit:cover;object-fit:cover}.blog-post-module--mainImage--1FS8k{display:block;position:relative;background:#e7ebed;padding-bottom:56.25%}.blog-post-module--mainImage--1FS8k img{display:block;position:absolute;top:0;left:0;width:100%;height:100%;vertical-align:top;-o-object-fit:cover;object-fit:cover}@media (min-width:675px){.blog-post-module--grid--9o63X{display:grid;grid-template-columns:1fr;grid-column-gap:2em;grid-template-columns:3fr 1fr}}.blog-post-module--publishedAt--2HawB{margin:2rem 0 3rem;color:#697a90}.blog-post-module--categories--3MaID{border-top:1px solid #e7ebed;margin:2rem 0 3rem}.blog-post-module--categories--3MaID ul{list-style:none;margin:.75rem 0;padding:0}.blog-post-module--categories--3MaID ul li{padding:.25rem 0}.blog-post-preview-grid-module--root--3vhkg{margin:2em 0 4em}.blog-post-preview-grid-module--headline--3E2Zn{font-size:.625rem;line-height:1.2;font-weight:600;text-transform:uppercase;letter-spacing:.5px;margin:2rem 0}.blog-post-preview-grid-module--grid--2Cso-{margin:0;padding:0;list-style:none;display:grid;grid-template-columns:1fr;grid-gap:2em}@media (min-width:450px){.blog-post-preview-grid-module--grid--2Cso-{grid-template-columns:1fr 1fr}}@media (min-width:675px){.blog-post-preview-grid-module--grid--2Cso-{grid-template-columns:1fr 1fr 1fr}}.blog-post-preview-grid-module--browseMoreNav--2FWHw{margin-top:1rem;text-align:right}.blog-post-preview-grid-module--browseMoreNav--2FWHw a{display:inline-block;padding:.5rem 0;color:inherit;text-decoration:none}@media (hover:hover){.blog-post-preview-grid-module--browseMoreNav--2FWHw a:hover{color:#156dff}}</style><meta name="generator" content="Gatsby 2.15.9"/><title data-react-helmet="true">Rendering 100k spheres, instantiating and draw calls | Daniel Velasquez</title><link data-react-helmet="true" rel="stylesheet" href="https://use.typekit.net/mxj2yik.css"/><link data-react-helmet="true" rel="icon" href="data:image/vnd.microsoft.icon;base64,AAABAAEAEBAAAAEAIABoBAAAFgAAACgAAAAQAAAAIAAAAAEAIAAAAAAAAAQAABILAAASCwAAAAAAAAAAAAAAAAACSJLPp1Wz//9Vs///VbP//1Wz//9Vs///VbX//1W3//9Vt///Wbv+/12///9fwP//YMH+/1KgzqAAAAABAAAAAEeQyp5Vsv7/VbP//1Wz//9Vs///VbP//1W1//9Vt///Vbf//1m7/v9dv///X8D//2DB/f9RnsqW////AKj//wBGjceSVLL9/1Wz//9Vs///VbP//1Wz//9Vtf//Vbf//1W3//9Zu///Xb///1/A//9gwfz/UJrGipH//wBx//8ARYrChlSx/P9Vs///VbP//1Wz//9Vs///VbX//1W3//9Vt///WLf4/1y8+v9fwP//X8D7/0+XwH9z9P8AXM3/AESHvXpUsPv/VbP//1Wz//9Vs///VbP//1W1//9VuP//T6rs/yFFXv8uW3n/Xbz5/1+/+v9OlLt0ZM//AFOy/gBDhLluU6/5/1Wz//9Vs///VbP//1Wz//9Vtf//Vrn//0qf3v8NGiP/HDdJ/1y59f9fv/n/TJC4Z1y47wBMoOQAQYG1YlOu+P9Vs///VbP//1Wz//9Wtf//VLP8/1O0+/9Vt/3/S5vS/1Op4P9atvH/Va7l/keKsVpSpNUAR5PRAEB+sVZSrfb9VbP//1Wz//9VtP//QYnD/yRGYP87XXX/S5PI/1u///9Rptz/Lkpc/2J3g/5uhZJeao2hAEOHvQA9eqpHUqzz+FWz//9VtP//TqTq/xcqOv97eXf/39zb/6q6x/9dtfD/L19//4mHhv/6+Pj/8vHwpd3bzwQ6cZcAOW6TKVSt6+ZZuf//Wbj//0qb2f8pMzr/3t7d///////o8PX/bsDy/y1Wb/+1srH///////7+/aD08ucDJ0VWABMVFwdQpdOoXcL9/13B//9Yuff/Nl94/7GztP/z9PX/tt7y/2bL/v9NnML/ZIaS/77Mz779+vYl9vf2AAEAAABOoMQAQoSgOFm85+Jgzf//X8v//1m/7/9Zpsn/dMDh/2jP+f9n1v//a9z//1/D3uFAfow4UKC0AAAAAAAAAAAAITY6AAAAAABKl69TXMXl32PX/P9k2v//Zdv//2bd//9r4f//beL8/2bQ5N5Tn6tQ////ACk9PAAAAAAAAAAAAAAAAAAhMjEAAAAAAEaLljBYuMmXYs/i12fa7O1q3OzsZ9Xi1l+/yZRNkJUuAAAAACQxLQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAArOS4AICQaA0F1chhMkpIuTJOTLkB1cxcaHxgDJDQtAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAABAACAAQAAgAEAAIABAACAAQAAgAEAAIABAACAAAAAgAAAAIABAADAAwAAwAcAAOAHAAD4HwAA//8AAA==" type="image/x-icon"/><link data-react-helmet="true" rel="shortcut icon" href="data:image/vnd.microsoft.icon;base64,AAABAAEAEBAAAAEAIABoBAAAFgAAACgAAAAQAAAAIAAAAAEAIAAAAAAAAAQAABILAAASCwAAAAAAAAAAAAAAAAACSJLPp1Wz//9Vs///VbP//1Wz//9Vs///VbX//1W3//9Vt///Wbv+/12///9fwP//YMH+/1KgzqAAAAABAAAAAEeQyp5Vsv7/VbP//1Wz//9Vs///VbP//1W1//9Vt///Vbf//1m7/v9dv///X8D//2DB/f9RnsqW////AKj//wBGjceSVLL9/1Wz//9Vs///VbP//1Wz//9Vtf//Vbf//1W3//9Zu///Xb///1/A//9gwfz/UJrGipH//wBx//8ARYrChlSx/P9Vs///VbP//1Wz//9Vs///VbX//1W3//9Vt///WLf4/1y8+v9fwP//X8D7/0+XwH9z9P8AXM3/AESHvXpUsPv/VbP//1Wz//9Vs///VbP//1W1//9VuP//T6rs/yFFXv8uW3n/Xbz5/1+/+v9OlLt0ZM//AFOy/gBDhLluU6/5/1Wz//9Vs///VbP//1Wz//9Vtf//Vrn//0qf3v8NGiP/HDdJ/1y59f9fv/n/TJC4Z1y47wBMoOQAQYG1YlOu+P9Vs///VbP//1Wz//9Wtf//VLP8/1O0+/9Vt/3/S5vS/1Op4P9atvH/Va7l/keKsVpSpNUAR5PRAEB+sVZSrfb9VbP//1Wz//9VtP//QYnD/yRGYP87XXX/S5PI/1u///9Rptz/Lkpc/2J3g/5uhZJeao2hAEOHvQA9eqpHUqzz+FWz//9VtP//TqTq/xcqOv97eXf/39zb/6q6x/9dtfD/L19//4mHhv/6+Pj/8vHwpd3bzwQ6cZcAOW6TKVSt6+ZZuf//Wbj//0qb2f8pMzr/3t7d///////o8PX/bsDy/y1Wb/+1srH///////7+/aD08ucDJ0VWABMVFwdQpdOoXcL9/13B//9Yuff/Nl94/7GztP/z9PX/tt7y/2bL/v9NnML/ZIaS/77Mz779+vYl9vf2AAEAAABOoMQAQoSgOFm85+Jgzf//X8v//1m/7/9Zpsn/dMDh/2jP+f9n1v//a9z//1/D3uFAfow4UKC0AAAAAAAAAAAAITY6AAAAAABKl69TXMXl32PX/P9k2v//Zdv//2bd//9r4f//beL8/2bQ5N5Tn6tQ////ACk9PAAAAAAAAAAAAAAAAAAhMjEAAAAAAEaLljBYuMmXYs/i12fa7O1q3OzsZ9Xi1l+/yZRNkJUuAAAAACQxLQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAArOS4AICQaA0F1chhMkpIuTJOTLkB1cxcaHxgDJDQtAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAABAACAAQAAgAEAAIABAACAAQAAgAEAAIABAACAAAAAgAAAAIABAADAAwAAwAcAAOAHAAD4HwAA//8AAA==" type="image/x-icon"/><meta data-react-helmet="true" name="description" content="Rendering millions of objects is all about communication"/><meta data-react-helmet="true" property="og:title" content="Rendering 100k spheres, instantiating and draw calls"/><meta data-react-helmet="true" property="og:description" content="Rendering millions of objects is all about communication"/><meta data-react-helmet="true" property="og:type" content="website"/><meta data-react-helmet="true" property="og:image" content="https://cdn.sanity.io/images/b9gj9gnh/production/8ea83d78de1e7b8af891244453f628ec10d6c837-975x801.jpg?w=1200"/><meta data-react-helmet="true" name="twitter:card" content="summary"/><meta data-react-helmet="true" name="twitter:creator" content="Daniel Velasquez"/><meta data-react-helmet="true" name="twitter:title" content="Rendering 100k spheres, instantiating and draw calls"/><meta data-react-helmet="true" name="twitter:description" content="Rendering millions of objects is all about communication"/><link as="script" rel="preload" href="/component---src-templates-blog-post-js-f1eb32bc38fa7bff34a8.js"/><link as="script" rel="preload" href="/styles-d30453f2f4859e0a1e01.js"/><link as="script" rel="preload" href="/commons-1758a6b6f23ad1712269.js"/><link as="script" rel="preload" href="/app-5d74ca955f61abd7afbb.js"/><link as="script" rel="preload" href="/webpack-runtime-a9ec4b2830606288efa7.js"/><link as="fetch" rel="preload" href="/page-data/blog/rendering-100k-spheres-instantianing-and-draw-calls/page-data.json" crossorigin="anonymous"/></head><body><noscript id="gatsby-noscript">This app works best with JavaScript enabled.</noscript><div id="___gatsby"><div style="outline:none" tabindex="-1" role="group" id="gatsby-focus-wrapper"><div class="max-w-desktop mx-auto"><div class="relative z-50"><div class="w-full flex flex-row p-3 xs:px-6 py-4 sm:pt-6 md:p-7"><div class="w-1/3 uppercase font-display font-normal flex-1 leading-none"><a class="hover:text-gray-600 no-underline tracking-widest text-xs sm:text-base" href="/">Daniel Velasquez</a></div><ul class="w-2/3 m-0 px-0 sm:list-none flex justify-end items-center "><li class="pr-6 last:pr-0 font-display font-normal text-xs sm:text-base tracking-wide"><a class="block no-underline hover:text-gray-600" href="/blog/">Articles</a></li><li class="pr-6 last:pr-0 font-display font-normal text-xs sm:text-base tracking-wide"><a class="block no-underline hover:text-gray-600" href="/about/">About</a></li></ul></div></div><div class="relative w-full px-5 sm:px-7"><article><header class="pb-5"><div class="fixed top-0 left-0 w-screen h-screen overflow-hidden z-minus1"><canvas class="w-full h-full"></canvas></div><h5 class="w-full mx-auto text-center text-normal font-display pb-1">March 8th 2020</h5><h1 class="w-full font-light sm:w-12/12 md:w-11/12 xl:w-9/12 mx-auto text-center text-2xl sm:text-3xl md:text-3xl lg:text-4xl font-display leading-snug">Rendering 100k spheres, instantiating and draw calls</h1></header><div><p class="w-full max-w-3xl xl:max-w-4xl mx-auto sm:text-lg leading-extra-relaxed font-light mb-4  text-bodyWhite">I knew I had to learn webGL when I saw <a href="https://codepen.io/mnmxmx/pen/rzqoeW" target="_blank" class=" border-b-1 border-gray-200 text-white font-display tracking-tiny">Misaki&#x27;s curl noise simulation</a>. I&#x27;m not sure if it was the colors, the movement, or being able to zoom and rotate around the simulation. But I knew I wanted to make something like that. <em>I just needed to figure out how...</em> </p><p class="w-full max-w-3xl xl:max-w-4xl mx-auto text-2lg xl:text-xl font-display  text-highWhite leading-normal text-center centered-block">Simulation who? A few days went by and I forgot all about it.</p><p class="w-full max-w-3xl xl:max-w-4xl mx-auto text-sm sm:text-base text-lowWhite leading-normal text-center centered-block">Welcome to my new blog, this sentence encapsulates what you&#x27;ll be seeing here.</p><p class="w-full max-w-3xl xl:max-w-4xl mx-auto sm:text-lg leading-extra-relaxed font-light mb-4  text-bodyWhite">Two years after that, I managed to learn enough webGL to get by. And more recently, I stumbled upon <a href="https://particle-love.com/" target="_blank" class=" border-b-1 border-gray-200 text-white font-display tracking-tiny">Edan Kwan&#x27;s beautiful Particle Love</a> and loved it. But It also reminded me of that elusive curl noise simulation I wanted to make but didn&#x27;t. </p><p class="w-full max-w-3xl xl:max-w-4xl mx-auto sm:text-lg leading-extra-relaxed font-light mb-4  text-bodyWhite">If I don&#x27;t code it now, my honor is on the line. <em>One part of me blames Edan for that.</em></p><p class="w-full max-w-3xl xl:max-w-4xl mx-auto sm:text-lg leading-extra-relaxed font-light mb-4  text-bodyWhite">So it&#x27;s about time to tackle particle simulations in Webgl. And I&#x27;m bringing you down this rabbit hole with me:</p><div class="w-full max-w-3xl xl:max-w-4xl mx-auto my-7"><figure class="-ml-5 sm:-ml-3  w-full-bleed-2 sm:w-full-bleed "><div class="mb-1 gatsby-image-wrapper" style="position:relative;overflow:hidden"><div style="width:100%;padding-bottom:60.50650239561944%"></div><noscript><picture><source type='image/webp' srcset="https://cdn.sanity.io/images/b9gj9gnh/production/9dd8e85dc0cdda2df0a274e0837c6735a7238599-1461x884.jpg?w=200&h=121&fit=crop&fm=webp 200w,
https://cdn.sanity.io/images/b9gj9gnh/production/9dd8e85dc0cdda2df0a274e0837c6735a7238599-1461x884.jpg?w=400&h=242&fit=crop&fm=webp 400w,
https://cdn.sanity.io/images/b9gj9gnh/production/9dd8e85dc0cdda2df0a274e0837c6735a7238599-1461x884.jpg?w=800&h=484&fit=crop&fm=webp 800w,
https://cdn.sanity.io/images/b9gj9gnh/production/9dd8e85dc0cdda2df0a274e0837c6735a7238599-1461x884.jpg?w=1200&h=726&fit=crop&fm=webp 1200w" sizes="(max-width: 800px) 100vw, 800px" /><source srcset="https://cdn.sanity.io/images/b9gj9gnh/production/9dd8e85dc0cdda2df0a274e0837c6735a7238599-1461x884.jpg?w=200&h=121&fit=crop 200w,
https://cdn.sanity.io/images/b9gj9gnh/production/9dd8e85dc0cdda2df0a274e0837c6735a7238599-1461x884.jpg?w=400&h=242&fit=crop 400w,
https://cdn.sanity.io/images/b9gj9gnh/production/9dd8e85dc0cdda2df0a274e0837c6735a7238599-1461x884.jpg?w=800&h=484&fit=crop 800w,
https://cdn.sanity.io/images/b9gj9gnh/production/9dd8e85dc0cdda2df0a274e0837c6735a7238599-1461x884.jpg?w=1200&h=726&fit=crop 1200w" sizes="(max-width: 800px) 100vw, 800px" /><img loading="lazy" sizes="(max-width: 800px) 100vw, 800px" srcset="https://cdn.sanity.io/images/b9gj9gnh/production/9dd8e85dc0cdda2df0a274e0837c6735a7238599-1461x884.jpg?w=200&h=121&fit=crop 200w,
https://cdn.sanity.io/images/b9gj9gnh/production/9dd8e85dc0cdda2df0a274e0837c6735a7238599-1461x884.jpg?w=400&h=242&fit=crop 400w,
https://cdn.sanity.io/images/b9gj9gnh/production/9dd8e85dc0cdda2df0a274e0837c6735a7238599-1461x884.jpg?w=800&h=484&fit=crop 800w,
https://cdn.sanity.io/images/b9gj9gnh/production/9dd8e85dc0cdda2df0a274e0837c6735a7238599-1461x884.jpg?w=1200&h=726&fit=crop 1200w" src="https://cdn.sanity.io/images/b9gj9gnh/production/9dd8e85dc0cdda2df0a274e0837c6735a7238599-1461x884.jpg?w=800&h=484&fit=crop" alt="A Sphere curl noise simulation." style="position:absolute;top:0;left:0;opacity:1;width:100%;height:100%;object-fit:cover;object-position:center"/></picture></noscript></div><figcaption class="text-lowWhite mx-auto text-center font-display text-sm">Not an embed because I don&#x27;t want to fry your device.</figcaption></figure></div><h4 class="w-full max-w-3xl xl:max-w-4xl mx-auto sm:text-lg font-bold tracking-widest uppercase leading-none  text-normal mb-3 mt-7" id="Curl-Simulation-Series">Curl Simulation Series<!-- --> <a class="inline-flex" href="#Curl-Simulation-Series"><svg version="1.1" id="Capa_1" xmlns="http://www.w3.org/2000/svg" x="0px" y="0px" viewBox="0 0 54.971 54.971" style="enable-background:new 0 0 54.971 54.971" class="title-link" xml:space="preserve"><g><path d="M51.173,3.801c-5.068-5.068-13.315-5.066-18.384,0l-9.192,9.192c-0.781,0.781-0.781,2.047,0,2.828 c0.781,0.781,2.047,0.781,2.828,0l9.192-9.192c1.691-1.69,3.951-2.622,6.363-2.622c2.413,0,4.673,0.932,6.364,2.623 s2.623,3.951,2.623,6.364c0,2.412-0.932,4.672-2.623,6.363L36.325,31.379c-3.51,3.508-9.219,3.508-12.729,0 c-0.781-0.781-2.047-0.781-2.828,0s-0.781,2.048,0,2.828c2.534,2.534,5.863,3.801,9.192,3.801s6.658-1.267,9.192-3.801 l12.021-12.021c2.447-2.446,3.795-5.711,3.795-9.192C54.968,9.512,53.62,6.248,51.173,3.801z"></path><path d="M27.132,40.57l-7.778,7.778c-1.691,1.691-3.951,2.623-6.364,2.623c-2.412,0-4.673-0.932-6.364-2.623 c-3.509-3.509-3.509-9.219,0-12.728L17.94,24.306c1.691-1.69,3.951-2.622,6.364-2.622c2.412,0,4.672,0.932,6.363,2.622 c0.781,0.781,2.047,0.781,2.828,0s0.781-2.047,0-2.828c-5.067-5.067-13.314-5.068-18.384,0L3.797,32.793 c-2.446,2.446-3.794,5.711-3.794,9.192c0,3.48,1.348,6.745,3.795,9.191c2.446,2.447,5.711,3.795,9.191,3.795 c3.481,0,6.746-1.348,9.192-3.795l7.778-7.778c0.781-0.781,0.781-2.047,0-2.828S27.913,39.789,27.132,40.57z"></path></g></svg></a></h4><p class="w-full max-w-3xl xl:max-w-4xl mx-auto sm:text-lg leading-extra-relaxed font-light mb-4  text-bodyWhite">This is the first article in a series where I&#x27;m going to explain the main techniques needed to make a pretty and interactable curl simulation: </p><ol class="w-full max-w-3xl xl:max-w-4xl mx-auto list-inside mb-4 xl:text-2lg leading-relaxed pl-1"><li class="mb-1 pl-4 relative sm:text-lg leading-relaxed font-light text-bodyWhite"><span class="absolute left-0 top-0 font-bold text-white text-sm inline-block" style="line-height:1.9rem">0<!-- -->.</span><strong class=" font-light tracking-normal text-white font-feature-2 font-semibold">Instancing and draw calls</strong><br/><em>Rendering 100k objects is all about communication</em></li><li class="mb-1 pl-4 relative sm:text-lg leading-relaxed font-light text-bodyWhite"><span class="absolute left-0 top-0 font-bold text-white text-sm inline-block" style="line-height:1.9rem">1<!-- -->.</span><strong class=" font-light tracking-normal text-white font-feature-2 font-semibold">GPUPU and FBO particle systems</strong><br/><em>Simulating life with only a GPU </em></li><li class="mb-1 pl-4 relative sm:text-lg leading-relaxed font-light text-bodyWhite"><span class="absolute left-0 top-0 font-bold text-white text-sm inline-block" style="line-height:1.9rem">2<!-- -->.</span><strong class=" font-light tracking-normal text-white font-feature-2 font-semibold">Light, shadows, and extended ThreeJS materials</strong><br/><em>Custom shaders means more work</em></li></ol><p class="w-full max-w-3xl xl:max-w-4xl mx-auto sm:text-lg leading-extra-relaxed font-light mb-4  text-bodyWhite">Each article is going to dive deep into their topic and then use it to build the curl simulation. If you aren&#x27;t interested in the curl simulation itself or don&#x27;t use ThreeJS, all the concepts are still going to be useful!</p><p class="w-full max-w-3xl xl:max-w-4xl mx-auto sm:text-lg leading-extra-relaxed font-light mb-4  text-bodyWhite">These are going to be intermediate to advanced level concepts. Best understood if you are comfortable with <a href="https://www.youtube.com/watch?v=6oFvqLfRnsU" target="_blank" class=" border-b-1 border-gray-200 text-white font-display tracking-tiny">ThreeJS</a>, <a href="https://threejs.org/docs/index.html#manual/en/introduction/Creating-a-scene" target="_blank" class=" border-b-1 border-gray-200 text-white font-display tracking-tiny">Setting up the scene</a>, <a href="https://thebookofshaders.com/01/" target="_blank" class=" border-b-1 border-gray-200 text-white font-display tracking-tiny">what are shaders and GPUs</a>.</p><p class="w-full max-w-3xl xl:max-w-4xl mx-auto sm:text-lg leading-extra-relaxed font-light mb-4  text-bodyWhite">If you don&#x27;t like the series feel free to <a href="https://ctt.ac/8EdHb" target="_blank" class=" border-b-1 border-gray-200 text-white font-display tracking-tiny">direct your hate/suggestions here.</a></p><p class="w-full max-w-3xl xl:max-w-4xl mx-auto sm:text-lg leading-extra-relaxed font-light mb-4  text-bodyWhite">Let&#x27;s figure out the first step, how to render a 100k of spheres!</p><h3 class="w-full max-w-3xl xl:max-w-4xl mx-auto text-3xl xl:text-3xl2 font-display leading-none  text-normal mb-3 mt-7" id="Using-meshes-to-create-100k-spheres">Using meshes to create 100k spheres<!-- --> <a class="inline-flex" href="#Using-meshes-to-create-100k-spheres"><svg version="1.1" id="Capa_1" xmlns="http://www.w3.org/2000/svg" x="0px" y="0px" viewBox="0 0 54.971 54.971" style="enable-background:new 0 0 54.971 54.971" class="title-link" xml:space="preserve"><g><path d="M51.173,3.801c-5.068-5.068-13.315-5.066-18.384,0l-9.192,9.192c-0.781,0.781-0.781,2.047,0,2.828 c0.781,0.781,2.047,0.781,2.828,0l9.192-9.192c1.691-1.69,3.951-2.622,6.363-2.622c2.413,0,4.673,0.932,6.364,2.623 s2.623,3.951,2.623,6.364c0,2.412-0.932,4.672-2.623,6.363L36.325,31.379c-3.51,3.508-9.219,3.508-12.729,0 c-0.781-0.781-2.047-0.781-2.828,0s-0.781,2.048,0,2.828c2.534,2.534,5.863,3.801,9.192,3.801s6.658-1.267,9.192-3.801 l12.021-12.021c2.447-2.446,3.795-5.711,3.795-9.192C54.968,9.512,53.62,6.248,51.173,3.801z"></path><path d="M27.132,40.57l-7.778,7.778c-1.691,1.691-3.951,2.623-6.364,2.623c-2.412,0-4.673-0.932-6.364-2.623 c-3.509-3.509-3.509-9.219,0-12.728L17.94,24.306c1.691-1.69,3.951-2.622,6.364-2.622c2.412,0,4.672,0.932,6.363,2.622 c0.781,0.781,2.047,0.781,2.828,0s0.781-2.047,0-2.828c-5.067-5.067-13.314-5.068-18.384,0L3.797,32.793 c-2.446,2.446-3.794,5.711-3.794,9.192c0,3.48,1.348,6.745,3.795,9.191c2.446,2.447,5.711,3.795,9.191,3.795 c3.481,0,6.746-1.348,9.192-3.795l7.778-7.778c0.781-0.781,0.781-2.047,0-2.828S27.913,39.789,27.132,40.57z"></path></g></svg></a></h3><p class="w-full max-w-3xl xl:max-w-4xl mx-auto sm:text-lg leading-extra-relaxed font-light mb-4  text-bodyWhite">The straight forward way of rendering a lot of spheres is by creating a lot of meshes in a loop and adding them to the scene:</p><div class="w-full max-w-3xl xl:max-w-4xl mx-auto  mx-auto my-7"><div class="-ml-5 sm:-ml-3  w-full-bleed-2 sm:w-full-bleed "><pre class="prism-code language-javascript py-5 overflow-x-auto" style="color:#d6deeb;background-color:#1d2132"><div class="token-line relative whitespace-no-wrap" style="color:#d6deeb"><span class="  px-5"><span class="token keyword whitespace-pre" style="color:rgb(199, 146, 234);font-style:italic">let</span><span class="token plain whitespace-pre"> geometry </span><span class="token operator whitespace-pre" style="color:rgb(127, 219, 202)">=</span><span class="token plain whitespace-pre"> </span><span class="token keyword whitespace-pre" style="color:rgb(199, 146, 234);font-style:italic">new</span><span class="token plain whitespace-pre"> </span><span class="token class-name whitespace-pre" style="color:rgb(255, 203, 139)">THREE</span><span class="token class-name punctuation whitespace-pre" style="color:rgb(199, 146, 234);font-style:italic">.</span><span class="token class-name whitespace-pre" style="color:rgb(255, 203, 139)">SphereBufferGeometry</span><span class="token punctuation whitespace-pre" style="color:rgb(199, 146, 234);font-style:italic">(</span><span class="token number whitespace-pre" style="color:rgb(247, 140, 108)">1</span><span class="token punctuation whitespace-pre" style="color:rgb(199, 146, 234);font-style:italic">,</span><span class="token plain whitespace-pre"> </span><span class="token number whitespace-pre" style="color:rgb(247, 140, 108)">12</span><span class="token punctuation whitespace-pre" style="color:rgb(199, 146, 234);font-style:italic">,</span><span class="token plain whitespace-pre"> </span><span class="token number whitespace-pre" style="color:rgb(247, 140, 108)">12</span><span class="token punctuation whitespace-pre" style="color:rgb(199, 146, 234);font-style:italic">)</span><span class="token punctuation whitespace-pre" style="color:rgb(199, 146, 234);font-style:italic">;</span><span class="token plain whitespace-pre"></span></span></div><div class="token-line relative whitespace-no-wrap" style="color:#d6deeb"><span class="  px-5"><span class="token plain whitespace-pre"></span><span class="token keyword whitespace-pre" style="color:rgb(199, 146, 234);font-style:italic">let</span><span class="token plain whitespace-pre"> colors </span><span class="token operator whitespace-pre" style="color:rgb(127, 219, 202)">=</span><span class="token plain whitespace-pre"> </span><span class="token punctuation whitespace-pre" style="color:rgb(199, 146, 234);font-style:italic">[</span><span class="token number whitespace-pre" style="color:rgb(247, 140, 108)">0xfafafa</span><span class="token punctuation whitespace-pre" style="color:rgb(199, 146, 234);font-style:italic">,</span><span class="token plain whitespace-pre"> </span><span class="token number whitespace-pre" style="color:rgb(247, 140, 108)">0xff0000</span><span class="token punctuation whitespace-pre" style="color:rgb(199, 146, 234);font-style:italic">]</span><span class="token punctuation whitespace-pre" style="color:rgb(199, 146, 234);font-style:italic">;</span><span class="token plain whitespace-pre"></span></span></div><div class="token-line relative whitespace-no-wrap" style="color:#d6deeb"><span class="  px-5"><span class="token plain whitespace-pre"></span><span class="token keyword whitespace-pre" style="color:rgb(199, 146, 234);font-style:italic">for</span><span class="token plain whitespace-pre"> </span><span class="token punctuation whitespace-pre" style="color:rgb(199, 146, 234);font-style:italic">(</span><span class="token keyword whitespace-pre" style="color:rgb(199, 146, 234);font-style:italic">let</span><span class="token plain whitespace-pre"> i </span><span class="token operator whitespace-pre" style="color:rgb(127, 219, 202)">=</span><span class="token plain whitespace-pre"> </span><span class="token number whitespace-pre" style="color:rgb(247, 140, 108)">0</span><span class="token punctuation whitespace-pre" style="color:rgb(199, 146, 234);font-style:italic">;</span><span class="token plain whitespace-pre"> i </span><span class="token operator whitespace-pre" style="color:rgb(127, 219, 202)">&lt;</span><span class="token plain whitespace-pre"> </span><span class="token number whitespace-pre" style="color:rgb(247, 140, 108)">5000</span><span class="token punctuation whitespace-pre" style="color:rgb(199, 146, 234);font-style:italic">;</span><span class="token plain whitespace-pre"> i</span><span class="token operator whitespace-pre" style="color:rgb(127, 219, 202)">++</span><span class="token punctuation whitespace-pre" style="color:rgb(199, 146, 234);font-style:italic">)</span><span class="token plain whitespace-pre"> </span><span class="token punctuation whitespace-pre" style="color:rgb(199, 146, 234);font-style:italic">{</span><span class="token plain whitespace-pre"></span></span></div><div class="token-line relative whitespace-no-wrap" style="color:#d6deeb"><span class="  px-5"><span class="token plain whitespace-pre">  </span><span class="token keyword whitespace-pre" style="color:rgb(199, 146, 234);font-style:italic">let</span><span class="token plain whitespace-pre"> color </span><span class="token operator whitespace-pre" style="color:rgb(127, 219, 202)">=</span><span class="token plain whitespace-pre"> colors</span><span class="token punctuation whitespace-pre" style="color:rgb(199, 146, 234);font-style:italic">[</span><span class="token plain whitespace-pre">random</span><span class="token punctuation whitespace-pre" style="color:rgb(199, 146, 234);font-style:italic">.</span><span class="token method function property-access whitespace-pre" style="color:rgb(199, 146, 234);font-style:italic">int</span><span class="token punctuation whitespace-pre" style="color:rgb(199, 146, 234);font-style:italic">(</span><span class="token plain whitespace-pre">colors</span><span class="token punctuation whitespace-pre" style="color:rgb(199, 146, 234);font-style:italic">.</span><span class="token property-access whitespace-pre">length</span><span class="token punctuation whitespace-pre" style="color:rgb(199, 146, 234);font-style:italic">)</span><span class="token punctuation whitespace-pre" style="color:rgb(199, 146, 234);font-style:italic">]</span><span class="token punctuation whitespace-pre" style="color:rgb(199, 146, 234);font-style:italic">;</span><span class="token plain whitespace-pre"></span></span></div><div class="token-line relative whitespace-no-wrap" style="color:#d6deeb"><span class="  px-5"><span class="token plain whitespace-pre">  </span><span class="token keyword whitespace-pre" style="color:rgb(199, 146, 234);font-style:italic">let</span><span class="token plain whitespace-pre"> material </span><span class="token operator whitespace-pre" style="color:rgb(127, 219, 202)">=</span><span class="token plain whitespace-pre"> </span><span class="token keyword whitespace-pre" style="color:rgb(199, 146, 234);font-style:italic">new</span><span class="token plain whitespace-pre"> </span><span class="token class-name whitespace-pre" style="color:rgb(255, 203, 139)">THREE</span><span class="token class-name punctuation whitespace-pre" style="color:rgb(199, 146, 234);font-style:italic">.</span><span class="token class-name whitespace-pre" style="color:rgb(255, 203, 139)">MeshBasicMaterial</span><span class="token punctuation whitespace-pre" style="color:rgb(199, 146, 234);font-style:italic">(</span><span class="token punctuation whitespace-pre" style="color:rgb(199, 146, 234);font-style:italic">{</span><span class="token plain whitespace-pre">color</span><span class="token punctuation whitespace-pre" style="color:rgb(199, 146, 234);font-style:italic">:</span><span class="token plain whitespace-pre"> color</span><span class="token punctuation whitespace-pre" style="color:rgb(199, 146, 234);font-style:italic">}</span><span class="token punctuation whitespace-pre" style="color:rgb(199, 146, 234);font-style:italic">)</span><span class="token punctuation whitespace-pre" style="color:rgb(199, 146, 234);font-style:italic">;</span><span class="token plain whitespace-pre"></span></span></div><div class="token-line relative whitespace-no-wrap" style="color:#d6deeb"><span class="  px-5"><span class="token plain whitespace-pre">  </span></span></div><div class="token-line relative whitespace-no-wrap" style="color:#d6deeb"><span class="  px-5"><span class="token plain whitespace-pre">  </span><span class="token keyword whitespace-pre" style="color:rgb(199, 146, 234);font-style:italic">let</span><span class="token plain whitespace-pre"> mesh </span><span class="token operator whitespace-pre" style="color:rgb(127, 219, 202)">=</span><span class="token plain whitespace-pre"> </span><span class="token keyword whitespace-pre" style="color:rgb(199, 146, 234);font-style:italic">new</span><span class="token plain whitespace-pre"> </span><span class="token class-name whitespace-pre" style="color:rgb(255, 203, 139)">THREE</span><span class="token class-name punctuation whitespace-pre" style="color:rgb(199, 146, 234);font-style:italic">.</span><span class="token class-name whitespace-pre" style="color:rgb(255, 203, 139)">Mesh</span><span class="token punctuation whitespace-pre" style="color:rgb(199, 146, 234);font-style:italic">(</span><span class="token plain whitespace-pre">geometry</span><span class="token punctuation whitespace-pre" style="color:rgb(199, 146, 234);font-style:italic">,</span><span class="token plain whitespace-pre"> material</span><span class="token punctuation whitespace-pre" style="color:rgb(199, 146, 234);font-style:italic">)</span><span class="token punctuation whitespace-pre" style="color:rgb(199, 146, 234);font-style:italic">;</span><span class="token plain whitespace-pre"></span></span></div><div class="token-line relative whitespace-no-wrap" style="color:#d6deeb"><span class="  px-5"><span class="token plain whitespace-pre">  scene</span><span class="token punctuation whitespace-pre" style="color:rgb(199, 146, 234);font-style:italic">.</span><span class="token method function property-access whitespace-pre" style="color:rgb(199, 146, 234);font-style:italic">add</span><span class="token punctuation whitespace-pre" style="color:rgb(199, 146, 234);font-style:italic">(</span><span class="token plain whitespace-pre">mesh</span><span class="token punctuation whitespace-pre" style="color:rgb(199, 146, 234);font-style:italic">)</span><span class="token punctuation whitespace-pre" style="color:rgb(199, 146, 234);font-style:italic">;</span><span class="token plain whitespace-pre"></span></span></div><div class="token-line relative whitespace-no-wrap" style="color:#d6deeb"><span class="  px-5"><span class="token plain whitespace-pre"></span><span class="token punctuation whitespace-pre" style="color:rgb(199, 146, 234);font-style:italic">}</span></span></div></pre></div></div><p class="w-full max-w-3xl xl:max-w-4xl mx-auto mt-2 mb-4 relative border-1 px-5 py-4 font-display text-normal"><span class=" font-body font-bold text-xs bg-white text-darkBlue absolute top-0 uppercase tracking-widest leading-relaxed px-3 py-1/2" style="transform:translateY(-70%);left:20px">note</span>You can find the complete code for the demo: <a href="https://github.com/Anemolo/100k-objects-with-Instanced-Geometries" target="_blank" class=" border-b-1 border-gray-200 text-white font-display tracking-tiny">https://github.com/Anemolo/100k-objects-with-Instanced-Geometries</a></p><p class="w-full max-w-3xl xl:max-w-4xl mx-auto sm:text-lg leading-extra-relaxed font-light mb-4  text-bodyWhite">Creating one mesh per sphere is simple, easy to manage and it does the trick most of the time. But try to <strong class=" font-light tracking-normal text-white font-feature-2 font-semibold"><em>add as many spheres as you can without dropping below 60fps</em></strong> in this demo:</p><div class="w-full max-w-3xl xl:max-w-4xl mx-auto mb-4">

<p class="text-lowWhite mx-auto text-center font-display text-sm">You can find me <a href="https://codesandbox.io/s/spheres-mehses-b5v1m " target="_blank" class=" border-b-1 border-gray-200 text-white font-display tracking-tiny">Codesanbox</a> </p></div><p class="w-full max-w-3xl xl:max-w-4xl mx-auto sm:text-lg leading-extra-relaxed font-light mb-4  text-bodyWhite">Depending on the device you are using you may get up to different amounts. In my electronic potato, <em>I can barely make it over 7,000 spheres without dropping below 60fps</em>. Using cubes instead of spheres helps, but only up to 13k cubes.</p><p class="w-full max-w-3xl xl:max-w-4xl mx-auto sm:text-lg leading-extra-relaxed font-light mb-4  text-bodyWhite">Still, that&#x27;s a lot of spheres! But if you are considering doing something more than rendering 7k spheres. That number may have to go down even further.</p><p class="w-full max-w-3xl xl:max-w-4xl mx-auto sm:text-lg leading-extra-relaxed font-light mb-4  text-bodyWhite">If you take a look at the code for <a href="https://codepen.io/mnmxmx/pen/rzqoeW" target="_blank" class=" border-b-1 border-gray-200 text-white font-display tracking-tiny">Misaki&#x27;s Curl noise</a>, <a href="https://www.clicktorelease.com/code/polygon-shredder/#2048" target="_blank" class=" border-b-1 border-gray-200 text-white font-display tracking-tiny">Jaume&#x27;s Polygon Shredder</a> or <a href="https://particle-love.com/" target="_blank" class=" border-b-1 border-gray-200 text-white font-display tracking-tiny">Edan&#x27;s Particle love</a>. You&#x27;ll notice that <strong class=" font-light tracking-normal text-white font-feature-2 font-semibold">they all start at 16k instances</strong>. Some can go up to 4 million if your device is up to the challenge. </p><p class="w-full max-w-3xl xl:max-w-4xl mx-auto sm:text-lg leading-extra-relaxed font-light mb-4  text-bodyWhite">On top of that, they are running simulations, and even adding lights and shadows. Those are some impressing demos, but they make me a little self-conscious about ours...</p><p class="w-full max-w-3xl xl:max-w-4xl mx-auto sm:text-lg leading-extra-relaxed font-light mb-4  text-bodyWhite">Our one-mesh-per-sphere demo doesn&#x27;t even reach half of that 16k instance mark. And adding a simulation or shadows is definitely out of our league. <em><strong class=" font-light tracking-normal text-white font-feature-2 font-semibold">What&#x27;s wrong with our code? </strong>Isn&#x27;t everything I make perfect? <strong class=" font-light tracking-normal text-white font-feature-2 font-semibold">:(</strong></em></p><h3 class="w-full max-w-3xl xl:max-w-4xl mx-auto text-3xl xl:text-3xl2 font-display leading-none  text-normal mb-3 mt-7" id="Too-many-draw-calls">Too many draw calls<!-- --> <a class="inline-flex" href="#Too-many-draw-calls"><svg version="1.1" id="Capa_1" xmlns="http://www.w3.org/2000/svg" x="0px" y="0px" viewBox="0 0 54.971 54.971" style="enable-background:new 0 0 54.971 54.971" class="title-link" xml:space="preserve"><g><path d="M51.173,3.801c-5.068-5.068-13.315-5.066-18.384,0l-9.192,9.192c-0.781,0.781-0.781,2.047,0,2.828 c0.781,0.781,2.047,0.781,2.828,0l9.192-9.192c1.691-1.69,3.951-2.622,6.363-2.622c2.413,0,4.673,0.932,6.364,2.623 s2.623,3.951,2.623,6.364c0,2.412-0.932,4.672-2.623,6.363L36.325,31.379c-3.51,3.508-9.219,3.508-12.729,0 c-0.781-0.781-2.047-0.781-2.828,0s-0.781,2.048,0,2.828c2.534,2.534,5.863,3.801,9.192,3.801s6.658-1.267,9.192-3.801 l12.021-12.021c2.447-2.446,3.795-5.711,3.795-9.192C54.968,9.512,53.62,6.248,51.173,3.801z"></path><path d="M27.132,40.57l-7.778,7.778c-1.691,1.691-3.951,2.623-6.364,2.623c-2.412,0-4.673-0.932-6.364-2.623 c-3.509-3.509-3.509-9.219,0-12.728L17.94,24.306c1.691-1.69,3.951-2.622,6.364-2.622c2.412,0,4.672,0.932,6.363,2.622 c0.781,0.781,2.047,0.781,2.828,0s0.781-2.047,0-2.828c-5.067-5.067-13.314-5.068-18.384,0L3.797,32.793 c-2.446,2.446-3.794,5.711-3.794,9.192c0,3.48,1.348,6.745,3.795,9.191c2.446,2.447,5.711,3.795,9.191,3.795 c3.481,0,6.746-1.348,9.192-3.795l7.778-7.778c0.781-0.781,0.781-2.047,0-2.828S27.913,39.789,27.132,40.57z"></path></g></svg></a></h3><p class="w-full max-w-3xl xl:max-w-4xl mx-auto sm:text-lg leading-extra-relaxed font-light mb-4  text-bodyWhite">Our code has an issue of communication. On every render, we&#x27;re telling the GPU to draw one sphere mesh, then another, then another, then 6,997 more times, one at the time. We&#x27;re making way to many <strong class=" font-light tracking-normal text-white font-feature-2 font-semibold">draw calls</strong>.</p><p class="w-full max-w-3xl xl:max-w-4xl mx-auto sm:text-lg leading-extra-relaxed font-light mb-4  text-bodyWhite"><strong class=" font-light tracking-normal text-white font-feature-2 font-semibold">Draw calls</strong> are orders/commands from the CPU<em>(javascript)</em> to the GPU<em>(GLSL)</em> saying &quot;<em>hey, draw this sphere</em>&quot;. When you make a draw call, your CPU has to prepare the render state. Things like allocating memory, binding buffers, and other processes.</p><p class="w-full max-w-3xl xl:max-w-4xl mx-auto sm:text-lg leading-extra-relaxed font-light mb-4  text-bodyWhite">Although the GPU <a href="https://youtu.be/-P28LKWTzrI?t=60" target="_blank" class=" border-b-1 border-gray-200 text-white font-display tracking-tiny">renders pretty damn fast</a>. The CPU is significantly slower at processing the draw call for the GPU. And while the CPU is communicating, the GPU has to stop all its work/rendering.</p><p class="w-full max-w-3xl xl:max-w-4xl mx-auto sm:text-lg leading-extra-relaxed font-light mb-4  text-bodyWhite">This leaves us in a situation where even though the GPU is <a href="https://twitter.com/acdlite/status/974390255393505280?lang=en" target="_blank" class=" border-b-1 border-gray-200 text-white font-display tracking-tiny">blazing-fast</a> at rendering. The slow and old CPU limits the GPU while it prepares and sends over the data. <strong class=" font-light tracking-normal text-white font-feature-2 font-semibold">The CPU can&#x27;t feed information to the GPU fast enough</strong>. This is what the cool kids call: <strong class=" font-light tracking-normal text-white font-feature-2 font-semibold">CPU-Bottlenecking or CPU-bound.</strong></p><div class="w-full max-w-3xl xl:max-w-4xl mx-auto my-7"><figure class="-ml-5 sm:-ml-3  w-full-bleed-2 sm:w-full-bleed "><div class="mb-1 gatsby-image-wrapper" style="position:relative;overflow:hidden"><div style="width:100%;padding-bottom:47.419928825622776%"></div><noscript><picture><source type='image/webp' srcset="https://cdn.sanity.io/images/b9gj9gnh/production/8359711acd4eedc06936d00c1c88ccf6138ec6ba-3372x1599.png?w=200&h=95&fit=crop&fm=webp 200w,
https://cdn.sanity.io/images/b9gj9gnh/production/8359711acd4eedc06936d00c1c88ccf6138ec6ba-3372x1599.png?w=400&h=190&fit=crop&fm=webp 400w,
https://cdn.sanity.io/images/b9gj9gnh/production/8359711acd4eedc06936d00c1c88ccf6138ec6ba-3372x1599.png?w=800&h=379&fit=crop&fm=webp 800w,
https://cdn.sanity.io/images/b9gj9gnh/production/8359711acd4eedc06936d00c1c88ccf6138ec6ba-3372x1599.png?w=1200&h=569&fit=crop&fm=webp 1200w,
https://cdn.sanity.io/images/b9gj9gnh/production/8359711acd4eedc06936d00c1c88ccf6138ec6ba-3372x1599.png?w=1600&h=759&fit=crop&fm=webp 1600w,
https://cdn.sanity.io/images/b9gj9gnh/production/8359711acd4eedc06936d00c1c88ccf6138ec6ba-3372x1599.png?w=2400&h=1138&fit=crop&fm=webp 2400w" sizes="(max-width: 800px) 100vw, 800px" /><source srcset="https://cdn.sanity.io/images/b9gj9gnh/production/8359711acd4eedc06936d00c1c88ccf6138ec6ba-3372x1599.png?w=200&h=95&fit=crop 200w,
https://cdn.sanity.io/images/b9gj9gnh/production/8359711acd4eedc06936d00c1c88ccf6138ec6ba-3372x1599.png?w=400&h=190&fit=crop 400w,
https://cdn.sanity.io/images/b9gj9gnh/production/8359711acd4eedc06936d00c1c88ccf6138ec6ba-3372x1599.png?w=800&h=379&fit=crop 800w,
https://cdn.sanity.io/images/b9gj9gnh/production/8359711acd4eedc06936d00c1c88ccf6138ec6ba-3372x1599.png?w=1200&h=569&fit=crop 1200w,
https://cdn.sanity.io/images/b9gj9gnh/production/8359711acd4eedc06936d00c1c88ccf6138ec6ba-3372x1599.png?w=1600&h=759&fit=crop 1600w,
https://cdn.sanity.io/images/b9gj9gnh/production/8359711acd4eedc06936d00c1c88ccf6138ec6ba-3372x1599.png?w=2400&h=1138&fit=crop 2400w" sizes="(max-width: 800px) 100vw, 800px" /><img loading="lazy" sizes="(max-width: 800px) 100vw, 800px" srcset="https://cdn.sanity.io/images/b9gj9gnh/production/8359711acd4eedc06936d00c1c88ccf6138ec6ba-3372x1599.png?w=200&h=95&fit=crop 200w,
https://cdn.sanity.io/images/b9gj9gnh/production/8359711acd4eedc06936d00c1c88ccf6138ec6ba-3372x1599.png?w=400&h=190&fit=crop 400w,
https://cdn.sanity.io/images/b9gj9gnh/production/8359711acd4eedc06936d00c1c88ccf6138ec6ba-3372x1599.png?w=800&h=379&fit=crop 800w,
https://cdn.sanity.io/images/b9gj9gnh/production/8359711acd4eedc06936d00c1c88ccf6138ec6ba-3372x1599.png?w=1200&h=569&fit=crop 1200w,
https://cdn.sanity.io/images/b9gj9gnh/production/8359711acd4eedc06936d00c1c88ccf6138ec6ba-3372x1599.png?w=1600&h=759&fit=crop 1600w,
https://cdn.sanity.io/images/b9gj9gnh/production/8359711acd4eedc06936d00c1c88ccf6138ec6ba-3372x1599.png?w=2400&h=1138&fit=crop 2400w" src="https://cdn.sanity.io/images/b9gj9gnh/production/8359711acd4eedc06936d00c1c88ccf6138ec6ba-3372x1599.png?w=800&h=379&fit=crop" alt="The CPU Bottlenecking the GPU because of the ammount of small calculations " style="position:absolute;top:0;left:0;opacity:1;width:100%;height:100%;object-fit:cover;object-position:center"/></picture></noscript></div><figcaption class="text-lowWhite mx-auto text-center font-display text-sm">CPU Bottlenecking the GPU. Original https://www.wepc.com/tips/cpu-gpu-bottleneck/</figcaption></figure></div><p class="w-full max-w-3xl xl:max-w-4xl mx-auto mt-2 mb-4 relative border-1 px-5 py-4 font-display text-normal"><span class=" font-body font-bold text-xs bg-white text-darkBlue absolute top-0 uppercase tracking-widest leading-relaxed px-3 py-1/2" style="transform:translateY(-70%);left:20px">note</span> I didn&#x27;t mention anything about the &quot;<em>amount of data</em>&quot;. Of course, rendering 3<strong class=" font-light tracking-normal text-white font-feature-2 font-semibold"> triangles</strong> is going to be faster than rendering <strong class=" font-light tracking-normal text-white font-feature-2 font-semibold">7,000 triangles,</strong> <em>that&#x27;s easy to figure out</em>. But size isn&#x27;t the core of the draw call issue. </p><p class="w-full max-w-3xl xl:max-w-4xl mx-auto sm:text-lg leading-extra-relaxed font-light mb-4  text-bodyWhite">What makes a draw call expensive, isn&#x27;t the amount of data. <strong class=" font-light tracking-normal text-white font-feature-2 font-semibold">What makes a draw call expensive is the preparation of the GPU commands, it&#x27;s the CPU-to-GPU communication.</strong></p><p class="w-full max-w-3xl xl:max-w-4xl mx-auto sm:text-lg leading-extra-relaxed font-light mb-4  text-bodyWhite">The process of transferring and preparing the draw information from the CPU to the GPU is expensive. <em>Draw calls are going to have that overhead whether <a href="https://developer.arm.com/docs/dui0555/latest/api-level-optimizations/minimize-draw-calls/about-minimizing-draw-calls" target="_blank" class=" border-b-1 border-gray-200 text-white font-display tracking-tiny">you have one triangle or thousand triangles</a></em><a href="https://developer.arm.com/docs/dui0555/latest/api-level-optimizations/minimize-draw-calls/about-minimizing-draw-calls" target="_blank" class=" border-b-1 border-gray-200 text-white font-display tracking-tiny">. </a></p><p class="w-full max-w-3xl xl:max-w-4xl mx-auto text-2lg xl:text-xl font-display  text-highWhite leading-normal text-center centered-block">Make fewer draw calls, get better performance.</p><p class="w-full max-w-3xl xl:max-w-4xl mx-auto text-sm sm:text-base text-lowWhite leading-normal text-center centered-block">Although It isn&#x27;t the only way of getting <a href="https://discoverthreejs.com/tips-and-tricks/" target="_blank" class=" border-b-1 border-gray-200 text-white font-display tracking-tiny">better performance</a>. </p><p class="w-full max-w-3xl xl:max-w-4xl mx-auto sm:text-lg leading-extra-relaxed font-light mb-4  text-bodyWhite">So,<strong class=" font-light tracking-normal text-white font-feature-2 font-semibold"> one big draw call is going to be significantly faster than 10 small draw calls of the same size.</strong> This is because the CPU only needs to communicate just once with the GPU. The render state doesn&#x27;t need to change.</p><p class="w-full max-w-3xl xl:max-w-4xl mx-auto sm:text-lg leading-extra-relaxed font-light mb-4  text-bodyWhite">Compare it to developing 1 large website with 10 pages, versus 10 small websites of a single page. It&#x27;s the same amount of pages/work, but setting up every new project and talking to a new client takes a bit of extra time. Making one big website it&#x27;s going to be faster because you have less overhead and setup time.</p><p class="w-full max-w-3xl xl:max-w-4xl mx-auto sm:text-lg leading-extra-relaxed font-light mb-4  text-bodyWhite">This is also the case for <a href="https://simonschreibt.de/gat/renderhell-book3/" target="_blank" class=" border-b-1 border-gray-200 text-white font-display tracking-tiny">deleting files on your computer!</a></p><div class="w-full max-w-3xl xl:max-w-4xl mx-auto my-7"><figure class="-ml-5 sm:-ml-3  w-full-bleed-2 sm:w-full-bleed "><div class="mb-1 gatsby-image-wrapper" style="position:relative;overflow:hidden"><div style="width:100%;padding-bottom:42.98633827208005%"></div><noscript><picture><source type='image/webp' srcset="https://cdn.sanity.io/images/b9gj9gnh/production/e4107a53793e3056a35678387962fdfb14307d1f-5197x2234.png?w=200&h=86&fit=crop&fm=webp 200w,
https://cdn.sanity.io/images/b9gj9gnh/production/e4107a53793e3056a35678387962fdfb14307d1f-5197x2234.png?w=400&h=172&fit=crop&fm=webp 400w,
https://cdn.sanity.io/images/b9gj9gnh/production/e4107a53793e3056a35678387962fdfb14307d1f-5197x2234.png?w=800&h=344&fit=crop&fm=webp 800w,
https://cdn.sanity.io/images/b9gj9gnh/production/e4107a53793e3056a35678387962fdfb14307d1f-5197x2234.png?w=1200&h=516&fit=crop&fm=webp 1200w,
https://cdn.sanity.io/images/b9gj9gnh/production/e4107a53793e3056a35678387962fdfb14307d1f-5197x2234.png?w=1600&h=688&fit=crop&fm=webp 1600w,
https://cdn.sanity.io/images/b9gj9gnh/production/e4107a53793e3056a35678387962fdfb14307d1f-5197x2234.png?w=2400&h=1032&fit=crop&fm=webp 2400w" sizes="(max-width: 800px) 100vw, 800px" /><source srcset="https://cdn.sanity.io/images/b9gj9gnh/production/e4107a53793e3056a35678387962fdfb14307d1f-5197x2234.png?w=200&h=86&fit=crop 200w,
https://cdn.sanity.io/images/b9gj9gnh/production/e4107a53793e3056a35678387962fdfb14307d1f-5197x2234.png?w=400&h=172&fit=crop 400w,
https://cdn.sanity.io/images/b9gj9gnh/production/e4107a53793e3056a35678387962fdfb14307d1f-5197x2234.png?w=800&h=344&fit=crop 800w,
https://cdn.sanity.io/images/b9gj9gnh/production/e4107a53793e3056a35678387962fdfb14307d1f-5197x2234.png?w=1200&h=516&fit=crop 1200w,
https://cdn.sanity.io/images/b9gj9gnh/production/e4107a53793e3056a35678387962fdfb14307d1f-5197x2234.png?w=1600&h=688&fit=crop 1600w,
https://cdn.sanity.io/images/b9gj9gnh/production/e4107a53793e3056a35678387962fdfb14307d1f-5197x2234.png?w=2400&h=1032&fit=crop 2400w" sizes="(max-width: 800px) 100vw, 800px" /><img loading="lazy" sizes="(max-width: 800px) 100vw, 800px" srcset="https://cdn.sanity.io/images/b9gj9gnh/production/e4107a53793e3056a35678387962fdfb14307d1f-5197x2234.png?w=200&h=86&fit=crop 200w,
https://cdn.sanity.io/images/b9gj9gnh/production/e4107a53793e3056a35678387962fdfb14307d1f-5197x2234.png?w=400&h=172&fit=crop 400w,
https://cdn.sanity.io/images/b9gj9gnh/production/e4107a53793e3056a35678387962fdfb14307d1f-5197x2234.png?w=800&h=344&fit=crop 800w,
https://cdn.sanity.io/images/b9gj9gnh/production/e4107a53793e3056a35678387962fdfb14307d1f-5197x2234.png?w=1200&h=516&fit=crop 1200w,
https://cdn.sanity.io/images/b9gj9gnh/production/e4107a53793e3056a35678387962fdfb14307d1f-5197x2234.png?w=1600&h=688&fit=crop 1600w,
https://cdn.sanity.io/images/b9gj9gnh/production/e4107a53793e3056a35678387962fdfb14307d1f-5197x2234.png?w=2400&h=1032&fit=crop 2400w" src="https://cdn.sanity.io/images/b9gj9gnh/production/e4107a53793e3056a35678387962fdfb14307d1f-5197x2234.png?w=800&h=344&fit=crop" alt="An illustration of many small draw taking more time than one big draw call because of preparation time." style="position:absolute;top:0;left:0;opacity:1;width:100%;height:100%;object-fit:cover;object-position:center"/></picture></noscript></div><figcaption class="text-lowWhite mx-auto text-center font-display text-sm">The amount of work is the same. The setup time adds up in the long run.</figcaption></figure></div><h3 class="w-full max-w-3xl xl:max-w-4xl mx-auto text-3xl xl:text-3xl2 font-display leading-none  text-normal mb-3 mt-7" id="Reducing-draw-calls-by-Merging-Geometries">Reducing draw calls by Merging Geometries <!-- --> <a class="inline-flex" href="#Reducing-draw-calls-by-Merging-Geometries"><svg version="1.1" id="Capa_1" xmlns="http://www.w3.org/2000/svg" x="0px" y="0px" viewBox="0 0 54.971 54.971" style="enable-background:new 0 0 54.971 54.971" class="title-link" xml:space="preserve"><g><path d="M51.173,3.801c-5.068-5.068-13.315-5.066-18.384,0l-9.192,9.192c-0.781,0.781-0.781,2.047,0,2.828 c0.781,0.781,2.047,0.781,2.828,0l9.192-9.192c1.691-1.69,3.951-2.622,6.363-2.622c2.413,0,4.673,0.932,6.364,2.623 s2.623,3.951,2.623,6.364c0,2.412-0.932,4.672-2.623,6.363L36.325,31.379c-3.51,3.508-9.219,3.508-12.729,0 c-0.781-0.781-2.047-0.781-2.828,0s-0.781,2.048,0,2.828c2.534,2.534,5.863,3.801,9.192,3.801s6.658-1.267,9.192-3.801 l12.021-12.021c2.447-2.446,3.795-5.711,3.795-9.192C54.968,9.512,53.62,6.248,51.173,3.801z"></path><path d="M27.132,40.57l-7.778,7.778c-1.691,1.691-3.951,2.623-6.364,2.623c-2.412,0-4.673-0.932-6.364-2.623 c-3.509-3.509-3.509-9.219,0-12.728L17.94,24.306c1.691-1.69,3.951-2.622,6.364-2.622c2.412,0,4.672,0.932,6.363,2.622 c0.781,0.781,2.047,0.781,2.828,0s0.781-2.047,0-2.828c-5.067-5.067-13.314-5.068-18.384,0L3.797,32.793 c-2.446,2.446-3.794,5.711-3.794,9.192c0,3.48,1.348,6.745,3.795,9.191c2.446,2.447,5.711,3.795,9.191,3.795 c3.481,0,6.746-1.348,9.192-3.795l7.778-7.778c0.781-0.781,0.781-2.047,0-2.828S27.913,39.789,27.132,40.57z"></path></g></svg></a></h3><p class="w-full max-w-3xl xl:max-w-4xl mx-auto sm:text-lg leading-extra-relaxed font-light mb-4  text-bodyWhite">As <a href="https://codeburst.io/improve-your-threejs-performances-with-buffergeometryutils-8f97c072c14b" target="_blank" class=" border-b-1 border-gray-200 text-white font-display tracking-tiny">Renaud points in his optimization article</a>, <strong class=" font-light tracking-normal text-white font-feature-2 font-semibold">we can reduce draw calls is to merging all 7,000 geometries into a single geometry</strong>. Then, instead of having 7,000 small draw calls, we have 1 big draw call. Rendering is going to be a lot faster.</p><div class="w-full max-w-3xl xl:max-w-4xl mx-auto  mx-auto my-7"><div class="-ml-5 sm:-ml-3  w-full-bleed-2 sm:w-full-bleed "><pre class="prism-code language-javascript py-5 overflow-x-auto" style="color:#d6deeb;background-color:#1d2132"><div class="token-line relative whitespace-no-wrap" style="color:#d6deeb"><span class="  px-5"><span class="token keyword whitespace-pre" style="color:rgb(199, 146, 234);font-style:italic">let</span><span class="token plain whitespace-pre"> baseGeometry </span><span class="token operator whitespace-pre" style="color:rgb(127, 219, 202)">=</span><span class="token plain whitespace-pre"> </span><span class="token keyword whitespace-pre" style="color:rgb(199, 146, 234);font-style:italic">new</span><span class="token plain whitespace-pre"> </span><span class="token class-name whitespace-pre" style="color:rgb(255, 203, 139)">THREE</span><span class="token class-name punctuation whitespace-pre" style="color:rgb(199, 146, 234);font-style:italic">.</span><span class="token class-name whitespace-pre" style="color:rgb(255, 203, 139)">SphereBufferGeometry</span><span class="token punctuation whitespace-pre" style="color:rgb(199, 146, 234);font-style:italic">(</span><span class="token number whitespace-pre" style="color:rgb(247, 140, 108)">1</span><span class="token punctuation whitespace-pre" style="color:rgb(199, 146, 234);font-style:italic">,</span><span class="token plain whitespace-pre"> </span><span class="token number whitespace-pre" style="color:rgb(247, 140, 108)">12</span><span class="token punctuation whitespace-pre" style="color:rgb(199, 146, 234);font-style:italic">,</span><span class="token plain whitespace-pre"> </span><span class="token number whitespace-pre" style="color:rgb(247, 140, 108)">12</span><span class="token punctuation whitespace-pre" style="color:rgb(199, 146, 234);font-style:italic">)</span><span class="token punctuation whitespace-pre" style="color:rgb(199, 146, 234);font-style:italic">;</span><span class="token plain whitespace-pre"></span></span></div><div class="token-line relative whitespace-no-wrap" style="color:#d6deeb"><span class="  px-5"><span class="token plain whitespace-pre"></span><span class="token keyword whitespace-pre" style="color:rgb(199, 146, 234);font-style:italic">let</span><span class="token plain whitespace-pre"> spheres </span><span class="token operator whitespace-pre" style="color:rgb(127, 219, 202)">=</span><span class="token plain whitespace-pre"> </span><span class="token punctuation whitespace-pre" style="color:rgb(199, 146, 234);font-style:italic">[</span><span class="token punctuation whitespace-pre" style="color:rgb(199, 146, 234);font-style:italic">]</span><span class="token punctuation whitespace-pre" style="color:rgb(199, 146, 234);font-style:italic">;</span><span class="token plain whitespace-pre"></span></span></div><div class="token-line relative whitespace-no-wrap" style="color:#d6deeb"><span class="  px-5"><span class="token plain whitespace-pre"></span><span class="token keyword whitespace-pre" style="color:rgb(199, 146, 234);font-style:italic">let</span><span class="token plain whitespace-pre"> colors </span><span class="token operator whitespace-pre" style="color:rgb(127, 219, 202)">=</span><span class="token plain whitespace-pre"> </span><span class="token punctuation whitespace-pre" style="color:rgb(199, 146, 234);font-style:italic">[</span><span class="token number whitespace-pre" style="color:rgb(247, 140, 108)">0xfafafa</span><span class="token punctuation whitespace-pre" style="color:rgb(199, 146, 234);font-style:italic">,</span><span class="token plain whitespace-pre"> </span><span class="token number whitespace-pre" style="color:rgb(247, 140, 108)">0xff0000</span><span class="token punctuation whitespace-pre" style="color:rgb(199, 146, 234);font-style:italic">]</span><span class="token punctuation whitespace-pre" style="color:rgb(199, 146, 234);font-style:italic">;</span><span class="token plain whitespace-pre"></span></span></div><div class="token-line relative whitespace-no-wrap" style="color:#d6deeb"><span class="  px-5"><span class="token plain whitespace-pre"></span><span class="token keyword whitespace-pre" style="color:rgb(199, 146, 234);font-style:italic">for</span><span class="token plain whitespace-pre"> </span><span class="token punctuation whitespace-pre" style="color:rgb(199, 146, 234);font-style:italic">(</span><span class="token keyword whitespace-pre" style="color:rgb(199, 146, 234);font-style:italic">let</span><span class="token plain whitespace-pre"> i </span><span class="token operator whitespace-pre" style="color:rgb(127, 219, 202)">=</span><span class="token plain whitespace-pre"> </span><span class="token number whitespace-pre" style="color:rgb(247, 140, 108)">0</span><span class="token punctuation whitespace-pre" style="color:rgb(199, 146, 234);font-style:italic">;</span><span class="token plain whitespace-pre"> i </span><span class="token operator whitespace-pre" style="color:rgb(127, 219, 202)">&lt;</span><span class="token plain whitespace-pre"> </span><span class="token number whitespace-pre" style="color:rgb(247, 140, 108)">7000</span><span class="token punctuation whitespace-pre" style="color:rgb(199, 146, 234);font-style:italic">;</span><span class="token plain whitespace-pre"> i</span><span class="token operator whitespace-pre" style="color:rgb(127, 219, 202)">++</span><span class="token punctuation whitespace-pre" style="color:rgb(199, 146, 234);font-style:italic">)</span><span class="token plain whitespace-pre"> </span><span class="token punctuation whitespace-pre" style="color:rgb(199, 146, 234);font-style:italic">{</span><span class="token plain whitespace-pre"></span></span></div><div class="token-line relative whitespace-no-wrap" style="color:#d6deeb"><span class="  px-5"><span class="token plain whitespace-pre">  </span><span class="token keyword whitespace-pre" style="color:rgb(199, 146, 234);font-style:italic">let</span><span class="token plain whitespace-pre"> geometry </span><span class="token operator whitespace-pre" style="color:rgb(127, 219, 202)">=</span><span class="token plain whitespace-pre"> baseGeometry</span><span class="token punctuation whitespace-pre" style="color:rgb(199, 146, 234);font-style:italic">.</span><span class="token method function property-access whitespace-pre" style="color:rgb(199, 146, 234);font-style:italic">clone</span><span class="token punctuation whitespace-pre" style="color:rgb(199, 146, 234);font-style:italic">(</span><span class="token punctuation whitespace-pre" style="color:rgb(199, 146, 234);font-style:italic">)</span><span class="token punctuation whitespace-pre" style="color:rgb(199, 146, 234);font-style:italic">;</span><span class="token plain whitespace-pre"></span></span></div><div class="token-line relative whitespace-no-wrap" style="color:#d6deeb"><span class="  px-5"><span class="token plain whitespace-pre">  spheres</span><span class="token punctuation whitespace-pre" style="color:rgb(199, 146, 234);font-style:italic">.</span><span class="token method function property-access whitespace-pre" style="color:rgb(199, 146, 234);font-style:italic">push</span><span class="token punctuation whitespace-pre" style="color:rgb(199, 146, 234);font-style:italic">(</span><span class="token plain whitespace-pre">geometry</span><span class="token punctuation whitespace-pre" style="color:rgb(199, 146, 234);font-style:italic">)</span><span class="token plain whitespace-pre"></span></span></div><div class="token-line relative whitespace-no-wrap" style="color:#d6deeb"><span class="  px-5"><span class="token plain whitespace-pre"></span><span class="token punctuation whitespace-pre" style="color:rgb(199, 146, 234);font-style:italic">}</span><span class="token plain whitespace-pre"></span></span></div><div class="token-line relative whitespace-no-wrap" style="color:#d6deeb"><span class="  px-5"><span class="token plain whitespace-pre"></span><span class="token keyword whitespace-pre" style="color:rgb(199, 146, 234);font-style:italic">let</span><span class="token plain whitespace-pre"> material </span><span class="token operator whitespace-pre" style="color:rgb(127, 219, 202)">=</span><span class="token plain whitespace-pre"> </span><span class="token keyword whitespace-pre" style="color:rgb(199, 146, 234);font-style:italic">new</span><span class="token plain whitespace-pre"> </span><span class="token class-name whitespace-pre" style="color:rgb(255, 203, 139)">THREE</span><span class="token class-name punctuation whitespace-pre" style="color:rgb(199, 146, 234);font-style:italic">.</span><span class="token class-name whitespace-pre" style="color:rgb(255, 203, 139)">MeshBasicMaterial</span><span class="token punctuation whitespace-pre" style="color:rgb(199, 146, 234);font-style:italic">(</span><span class="token punctuation whitespace-pre" style="color:rgb(199, 146, 234);font-style:italic">)</span><span class="token punctuation whitespace-pre" style="color:rgb(199, 146, 234);font-style:italic">;</span><span class="token plain whitespace-pre"></span></span></div><div class="token-line relative whitespace-no-wrap" style="color:#d6deeb"><span class="  px-5"><span class="token plain whitespace-pre" style="display:inline-block"></span></span></div><div class="token-line relative whitespace-no-wrap" style="color:#d6deeb"><span class="  px-5"><span class="token plain whitespace-pre"></span><span class="token keyword whitespace-pre" style="color:rgb(199, 146, 234);font-style:italic">var</span><span class="token plain whitespace-pre"> mergedSphereGeometries </span><span class="token operator whitespace-pre" style="color:rgb(127, 219, 202)">=</span><span class="token plain whitespace-pre"> </span><span class="token constant whitespace-pre" style="color:rgb(130, 170, 255)">THREE</span><span class="token punctuation whitespace-pre" style="color:rgb(199, 146, 234);font-style:italic">.</span><span class="token property-access maybe-class-name whitespace-pre">BufferGeometryUtils</span><span class="token punctuation whitespace-pre" style="color:rgb(199, 146, 234);font-style:italic">.</span><span class="token method function property-access whitespace-pre" style="color:rgb(199, 146, 234);font-style:italic">mergeBufferGeometries</span><span class="token punctuation whitespace-pre" style="color:rgb(199, 146, 234);font-style:italic">(</span><span class="token plain whitespace-pre">spheres</span><span class="token punctuation whitespace-pre" style="color:rgb(199, 146, 234);font-style:italic">)</span><span class="token punctuation whitespace-pre" style="color:rgb(199, 146, 234);font-style:italic">;</span><span class="token plain whitespace-pre"></span></span></div><div class="token-line relative whitespace-no-wrap" style="color:#d6deeb"><span class="  px-5"><span class="token plain whitespace-pre"></span><span class="token keyword whitespace-pre" style="color:rgb(199, 146, 234);font-style:italic">let</span><span class="token plain whitespace-pre"> mesh </span><span class="token operator whitespace-pre" style="color:rgb(127, 219, 202)">=</span><span class="token plain whitespace-pre"> </span><span class="token keyword whitespace-pre" style="color:rgb(199, 146, 234);font-style:italic">new</span><span class="token plain whitespace-pre"> </span><span class="token class-name whitespace-pre" style="color:rgb(255, 203, 139)">THREE</span><span class="token class-name punctuation whitespace-pre" style="color:rgb(199, 146, 234);font-style:italic">.</span><span class="token class-name whitespace-pre" style="color:rgb(255, 203, 139)">Mesh</span><span class="token punctuation whitespace-pre" style="color:rgb(199, 146, 234);font-style:italic">(</span><span class="token plain whitespace-pre">mergedSphereGeometries</span><span class="token punctuation whitespace-pre" style="color:rgb(199, 146, 234);font-style:italic">,</span><span class="token plain whitespace-pre"> material</span><span class="token punctuation whitespace-pre" style="color:rgb(199, 146, 234);font-style:italic">)</span><span class="token punctuation whitespace-pre" style="color:rgb(199, 146, 234);font-style:italic">;</span><span class="token plain whitespace-pre"></span></span></div><div class="token-line relative whitespace-no-wrap" style="color:#d6deeb"><span class="  px-5"><span class="token plain whitespace-pre">scene</span><span class="token punctuation whitespace-pre" style="color:rgb(199, 146, 234);font-style:italic">.</span><span class="token method function property-access whitespace-pre" style="color:rgb(199, 146, 234);font-style:italic">add</span><span class="token punctuation whitespace-pre" style="color:rgb(199, 146, 234);font-style:italic">(</span><span class="token plain whitespace-pre">mesh</span><span class="token punctuation whitespace-pre" style="color:rgb(199, 146, 234);font-style:italic">)</span><span class="token punctuation whitespace-pre" style="color:rgb(199, 146, 234);font-style:italic">;</span></span></div></pre></div></div><p class="w-full max-w-3xl xl:max-w-4xl mx-auto sm:text-lg leading-extra-relaxed font-light mb-4  text-bodyWhite">The drawback of merging the geometries is that it only moves the processing time. Instead of having a slow render, we have a slow startup. <strong class=" font-light tracking-normal text-white font-feature-2 font-semibold">Merging 7,000 geometries into a single geometry straight-up takes a lot of time</strong>. The more geometries you want to merge the more overhead your app is going to have.</p><p class="w-full max-w-3xl xl:max-w-4xl mx-auto sm:text-lg leading-extra-relaxed font-light mb-4  text-bodyWhite">And in our case specifically, all our spheres have the same geometry. We creating have 7,000 <em>copies of the same </em><span class="bg-gray-800 px-2 py-1/2 font-code text-white tracking-wide" style="font-size:0.8em">SphereBufferGeometry</span>  and merging them. That&#x27;s a lot of memory wasted on the same thing and also that&#x27;s a lot of repeated data we&#x27;re sending to the GPU.</p><p class="w-full max-w-3xl xl:max-w-4xl mx-auto sm:text-lg leading-extra-relaxed font-light mb-4  text-bodyWhite">Merging geometries is a great optimization technique. But not quite what we&#x27;re looking for.</p><h3 class="w-full max-w-3xl xl:max-w-4xl mx-auto text-3xl xl:text-3xl2 font-display leading-none  text-normal mb-3 mt-7" id="Reducing-draw-calls-by-Instancing-Geometries">Reducing draw calls by Instancing Geometries<!-- --> <a class="inline-flex" href="#Reducing-draw-calls-by-Instancing-Geometries"><svg version="1.1" id="Capa_1" xmlns="http://www.w3.org/2000/svg" x="0px" y="0px" viewBox="0 0 54.971 54.971" style="enable-background:new 0 0 54.971 54.971" class="title-link" xml:space="preserve"><g><path d="M51.173,3.801c-5.068-5.068-13.315-5.066-18.384,0l-9.192,9.192c-0.781,0.781-0.781,2.047,0,2.828 c0.781,0.781,2.047,0.781,2.828,0l9.192-9.192c1.691-1.69,3.951-2.622,6.363-2.622c2.413,0,4.673,0.932,6.364,2.623 s2.623,3.951,2.623,6.364c0,2.412-0.932,4.672-2.623,6.363L36.325,31.379c-3.51,3.508-9.219,3.508-12.729,0 c-0.781-0.781-2.047-0.781-2.828,0s-0.781,2.048,0,2.828c2.534,2.534,5.863,3.801,9.192,3.801s6.658-1.267,9.192-3.801 l12.021-12.021c2.447-2.446,3.795-5.711,3.795-9.192C54.968,9.512,53.62,6.248,51.173,3.801z"></path><path d="M27.132,40.57l-7.778,7.778c-1.691,1.691-3.951,2.623-6.364,2.623c-2.412,0-4.673-0.932-6.364-2.623 c-3.509-3.509-3.509-9.219,0-12.728L17.94,24.306c1.691-1.69,3.951-2.622,6.364-2.622c2.412,0,4.672,0.932,6.363,2.622 c0.781,0.781,2.047,0.781,2.828,0s0.781-2.047,0-2.828c-5.067-5.067-13.314-5.068-18.384,0L3.797,32.793 c-2.446,2.446-3.794,5.711-3.794,9.192c0,3.48,1.348,6.745,3.795,9.191c2.446,2.447,5.711,3.795,9.191,3.795 c3.481,0,6.746-1.348,9.192-3.795l7.778-7.778c0.781-0.781,0.781-2.047,0-2.828S27.913,39.789,27.132,40.57z"></path></g></svg></a></h3><p class="w-full max-w-3xl xl:max-w-4xl mx-auto sm:text-lg leading-extra-relaxed font-light mb-4  text-bodyWhite"><strong class=" font-light tracking-normal text-white font-feature-2 font-semibold">Instancing</strong> is a technique that allows us to <strong class=" font-light tracking-normal text-white font-feature-2 font-semibold">send the geometry data to the GPU once</strong>. Then, using that same data, the <strong class=" font-light tracking-normal text-white font-feature-2 font-semibold">GPU takes care of repeating drawing</strong> how many times we want.</p><p class="w-full max-w-3xl xl:max-w-4xl mx-auto sm:text-lg leading-extra-relaxed font-light mb-4  text-bodyWhite">This is <em>perfect when you want to render the same geometry a lot of times</em>. Which is what we&#x27;re looking for.</p><p class="w-full max-w-3xl xl:max-w-4xl mx-auto sm:text-lg leading-extra-relaxed font-light mb-4  text-bodyWhite">It sending the data once, communicates once, and repeats the draw in the GPU. Letting the GPU go as fast as it&#x27;s able to. </p><p class="w-full max-w-3xl xl:max-w-4xl mx-auto sm:text-lg leading-extra-relaxed font-light mb-4  text-bodyWhite">This means we&#x27;re only making <strong class=" font-light tracking-normal text-white font-feature-2 font-semibold">one draw call</strong>, there&#x27;s <strong class=" font-light tracking-normal text-white font-feature-2 font-semibold">no CPU overhead</strong> and <strong class=" font-light tracking-normal text-white font-feature-2 font-semibold">the GPU takes care of repeating the draw blazing fast.</strong></p><div class="w-full max-w-3xl xl:max-w-4xl mx-auto my-7"><figure class="-ml-5 sm:-ml-3  w-full-bleed-2 sm:w-full-bleed "><div class="mb-1 gatsby-image-wrapper" style="position:relative;overflow:hidden"><div style="width:100%;padding-bottom:53.165396088829965%"></div><noscript><picture><source type='image/webp' srcset="https://cdn.sanity.io/images/b9gj9gnh/production/8112d8c299c2a2aa0b7d2051da6d44bf2bbe1df3-3017x1604.png?w=200&h=106&fit=crop&fm=webp 200w,
https://cdn.sanity.io/images/b9gj9gnh/production/8112d8c299c2a2aa0b7d2051da6d44bf2bbe1df3-3017x1604.png?w=400&h=213&fit=crop&fm=webp 400w,
https://cdn.sanity.io/images/b9gj9gnh/production/8112d8c299c2a2aa0b7d2051da6d44bf2bbe1df3-3017x1604.png?w=800&h=425&fit=crop&fm=webp 800w,
https://cdn.sanity.io/images/b9gj9gnh/production/8112d8c299c2a2aa0b7d2051da6d44bf2bbe1df3-3017x1604.png?w=1200&h=638&fit=crop&fm=webp 1200w,
https://cdn.sanity.io/images/b9gj9gnh/production/8112d8c299c2a2aa0b7d2051da6d44bf2bbe1df3-3017x1604.png?w=1600&h=851&fit=crop&fm=webp 1600w,
https://cdn.sanity.io/images/b9gj9gnh/production/8112d8c299c2a2aa0b7d2051da6d44bf2bbe1df3-3017x1604.png?w=2400&h=1276&fit=crop&fm=webp 2400w" sizes="(max-width: 800px) 100vw, 800px" /><source srcset="https://cdn.sanity.io/images/b9gj9gnh/production/8112d8c299c2a2aa0b7d2051da6d44bf2bbe1df3-3017x1604.png?w=200&h=106&fit=crop 200w,
https://cdn.sanity.io/images/b9gj9gnh/production/8112d8c299c2a2aa0b7d2051da6d44bf2bbe1df3-3017x1604.png?w=400&h=213&fit=crop 400w,
https://cdn.sanity.io/images/b9gj9gnh/production/8112d8c299c2a2aa0b7d2051da6d44bf2bbe1df3-3017x1604.png?w=800&h=425&fit=crop 800w,
https://cdn.sanity.io/images/b9gj9gnh/production/8112d8c299c2a2aa0b7d2051da6d44bf2bbe1df3-3017x1604.png?w=1200&h=638&fit=crop 1200w,
https://cdn.sanity.io/images/b9gj9gnh/production/8112d8c299c2a2aa0b7d2051da6d44bf2bbe1df3-3017x1604.png?w=1600&h=851&fit=crop 1600w,
https://cdn.sanity.io/images/b9gj9gnh/production/8112d8c299c2a2aa0b7d2051da6d44bf2bbe1df3-3017x1604.png?w=2400&h=1276&fit=crop 2400w" sizes="(max-width: 800px) 100vw, 800px" /><img loading="lazy" sizes="(max-width: 800px) 100vw, 800px" srcset="https://cdn.sanity.io/images/b9gj9gnh/production/8112d8c299c2a2aa0b7d2051da6d44bf2bbe1df3-3017x1604.png?w=200&h=106&fit=crop 200w,
https://cdn.sanity.io/images/b9gj9gnh/production/8112d8c299c2a2aa0b7d2051da6d44bf2bbe1df3-3017x1604.png?w=400&h=213&fit=crop 400w,
https://cdn.sanity.io/images/b9gj9gnh/production/8112d8c299c2a2aa0b7d2051da6d44bf2bbe1df3-3017x1604.png?w=800&h=425&fit=crop 800w,
https://cdn.sanity.io/images/b9gj9gnh/production/8112d8c299c2a2aa0b7d2051da6d44bf2bbe1df3-3017x1604.png?w=1200&h=638&fit=crop 1200w,
https://cdn.sanity.io/images/b9gj9gnh/production/8112d8c299c2a2aa0b7d2051da6d44bf2bbe1df3-3017x1604.png?w=1600&h=851&fit=crop 1600w,
https://cdn.sanity.io/images/b9gj9gnh/production/8112d8c299c2a2aa0b7d2051da6d44bf2bbe1df3-3017x1604.png?w=2400&h=1276&fit=crop 2400w" src="https://cdn.sanity.io/images/b9gj9gnh/production/8112d8c299c2a2aa0b7d2051da6d44bf2bbe1df3-3017x1604.png?w=800&h=425&fit=crop" alt="Ilustration of Instanced geometries helping with bottlenecking issue by batching draw calls." style="position:absolute;top:0;left:0;opacity:1;width:100%;height:100%;object-fit:cover;object-position:center"/></picture></noscript></div><figcaption class="text-lowWhite mx-auto text-center font-display text-sm">Faster comunication by batching all the same drawing into a single draw call</figcaption></figure></div><p class="w-full max-w-3xl xl:max-w-4xl mx-auto sm:text-lg leading-extra-relaxed font-light mb-4  text-bodyWhite">The more work you can move to the GPU, and the fewer interruptions you make. The better performance your gonna get!</p><h4 class="w-full max-w-3xl xl:max-w-4xl mx-auto sm:text-lg font-bold tracking-widest uppercase leading-none  text-normal mb-3 mt-7" id="Creating-an-Instanced-Geometry">Creating an Instanced Geometry<!-- --> <a class="inline-flex" href="#Creating-an-Instanced-Geometry"><svg version="1.1" id="Capa_1" xmlns="http://www.w3.org/2000/svg" x="0px" y="0px" viewBox="0 0 54.971 54.971" style="enable-background:new 0 0 54.971 54.971" class="title-link" xml:space="preserve"><g><path d="M51.173,3.801c-5.068-5.068-13.315-5.066-18.384,0l-9.192,9.192c-0.781,0.781-0.781,2.047,0,2.828 c0.781,0.781,2.047,0.781,2.828,0l9.192-9.192c1.691-1.69,3.951-2.622,6.363-2.622c2.413,0,4.673,0.932,6.364,2.623 s2.623,3.951,2.623,6.364c0,2.412-0.932,4.672-2.623,6.363L36.325,31.379c-3.51,3.508-9.219,3.508-12.729,0 c-0.781-0.781-2.047-0.781-2.828,0s-0.781,2.048,0,2.828c2.534,2.534,5.863,3.801,9.192,3.801s6.658-1.267,9.192-3.801 l12.021-12.021c2.447-2.446,3.795-5.711,3.795-9.192C54.968,9.512,53.62,6.248,51.173,3.801z"></path><path d="M27.132,40.57l-7.778,7.778c-1.691,1.691-3.951,2.623-6.364,2.623c-2.412,0-4.673-0.932-6.364-2.623 c-3.509-3.509-3.509-9.219,0-12.728L17.94,24.306c1.691-1.69,3.951-2.622,6.364-2.622c2.412,0,4.672,0.932,6.363,2.622 c0.781,0.781,2.047,0.781,2.828,0s0.781-2.047,0-2.828c-5.067-5.067-13.314-5.068-18.384,0L3.797,32.793 c-2.446,2.446-3.794,5.711-3.794,9.192c0,3.48,1.348,6.745,3.795,9.191c2.446,2.447,5.711,3.795,9.191,3.795 c3.481,0,6.746-1.348,9.192-3.795l7.778-7.778c0.781-0.781,0.781-2.047,0-2.828S27.913,39.789,27.132,40.57z"></path></g></svg></a></h4><p class="w-full max-w-3xl xl:max-w-4xl mx-auto sm:text-lg leading-extra-relaxed font-light mb-4  text-bodyWhite">To instantiate a geometry, we first need to create our <span class="bg-gray-800 px-2 py-1/2 font-code text-white tracking-wide" style="font-size:0.8em">baseGeometry</span>. Then, create an empty <span class="bg-gray-800 px-2 py-1/2 font-code text-white tracking-wide" style="font-size:0.8em">InstancedBufferGeometry</span> and <span class="bg-gray-800 px-2 py-1/2 font-code text-white tracking-wide" style="font-size:0.8em">.copy</span> our geometry over. </p><p class="w-full max-w-3xl xl:max-w-4xl mx-auto sm:text-lg leading-extra-relaxed font-light mb-4  text-bodyWhite">Then, we tell <span class="bg-gray-800 px-2 py-1/2 font-code text-white tracking-wide" style="font-size:0.8em">instancedGeometry.maxInstanceCount</span> how much instances we want to render:</p><div class="w-full max-w-3xl xl:max-w-4xl mx-auto  mx-auto my-7"><div class="-ml-5 sm:-ml-3  w-full-bleed-2 sm:w-full-bleed "><pre class="prism-code language-javascript py-5 overflow-x-auto" style="color:#d6deeb;background-color:#1d2132"><div class="token-line relative whitespace-no-wrap" style="color:#d6deeb"><span class="  px-5"><span class="token keyword whitespace-pre" style="color:rgb(199, 146, 234);font-style:italic">let</span><span class="token plain whitespace-pre"> baseGeometry </span><span class="token operator whitespace-pre" style="color:rgb(127, 219, 202)">=</span><span class="token plain whitespace-pre"> </span><span class="token keyword whitespace-pre" style="color:rgb(199, 146, 234);font-style:italic">new</span><span class="token plain whitespace-pre"> </span><span class="token class-name whitespace-pre" style="color:rgb(255, 203, 139)">THREE</span><span class="token class-name punctuation whitespace-pre" style="color:rgb(199, 146, 234);font-style:italic">.</span><span class="token class-name whitespace-pre" style="color:rgb(255, 203, 139)">SphereBufferGeometry</span><span class="token punctuation whitespace-pre" style="color:rgb(199, 146, 234);font-style:italic">(</span><span class="token number whitespace-pre" style="color:rgb(247, 140, 108)">3</span><span class="token punctuation whitespace-pre" style="color:rgb(199, 146, 234);font-style:italic">)</span><span class="token punctuation whitespace-pre" style="color:rgb(199, 146, 234);font-style:italic">;</span><span class="token plain whitespace-pre"></span></span></div><div class="token-line relative whitespace-no-wrap" style="color:#d6deeb"><span class="  px-5"><span class="token plain whitespace-pre" style="display:inline-block"></span></span></div><div class="token-line relative whitespace-no-wrap" style="color:#d6deeb"><span class="  px-5"><span class="token plain whitespace-pre"></span><span class="token keyword whitespace-pre" style="color:rgb(199, 146, 234);font-style:italic">let</span><span class="token plain whitespace-pre"> instancedGeometry </span><span class="token operator whitespace-pre" style="color:rgb(127, 219, 202)">=</span><span class="token plain whitespace-pre"> </span><span class="token keyword whitespace-pre" style="color:rgb(199, 146, 234);font-style:italic">new</span><span class="token plain whitespace-pre"> </span><span class="token class-name whitespace-pre" style="color:rgb(255, 203, 139)">THREE</span><span class="token class-name punctuation whitespace-pre" style="color:rgb(199, 146, 234);font-style:italic">.</span><span class="token class-name whitespace-pre" style="color:rgb(255, 203, 139)">InstancedBufferGeometry</span><span class="token punctuation whitespace-pre" style="color:rgb(199, 146, 234);font-style:italic">(</span><span class="token punctuation whitespace-pre" style="color:rgb(199, 146, 234);font-style:italic">)</span><span class="token punctuation whitespace-pre" style="color:rgb(199, 146, 234);font-style:italic">.</span><span class="token method function property-access whitespace-pre" style="color:rgb(199, 146, 234);font-style:italic">copy</span><span class="token punctuation whitespace-pre" style="color:rgb(199, 146, 234);font-style:italic">(</span><span class="token plain whitespace-pre">baseGeometry</span><span class="token punctuation whitespace-pre" style="color:rgb(199, 146, 234);font-style:italic">)</span><span class="token punctuation whitespace-pre" style="color:rgb(199, 146, 234);font-style:italic">;</span><span class="token plain whitespace-pre"></span></span></div><div class="token-line relative whitespace-no-wrap" style="color:#d6deeb"><span class="  px-5"><span class="token plain whitespace-pre"></span><span class="token keyword whitespace-pre" style="color:rgb(199, 146, 234);font-style:italic">let</span><span class="token plain whitespace-pre"> instanceCount </span><span class="token operator whitespace-pre" style="color:rgb(127, 219, 202)">=</span><span class="token plain whitespace-pre"> </span><span class="token number whitespace-pre" style="color:rgb(247, 140, 108)">7000</span><span class="token punctuation whitespace-pre" style="color:rgb(199, 146, 234);font-style:italic">;</span><span class="token plain whitespace-pre"></span></span></div><div class="token-line relative whitespace-no-wrap" style="color:#d6deeb"><span class="  px-5"><span class="token plain whitespace-pre">instancedGeometry</span><span class="token punctuation whitespace-pre" style="color:rgb(199, 146, 234);font-style:italic">.</span><span class="token property-access whitespace-pre">maxInstancedCount</span><span class="token plain whitespace-pre"> </span><span class="token operator whitespace-pre" style="color:rgb(127, 219, 202)">=</span><span class="token plain whitespace-pre"> instanceCount</span><span class="token punctuation whitespace-pre" style="color:rgb(199, 146, 234);font-style:italic">;</span><span class="token plain whitespace-pre"></span></span></div><div class="token-line relative whitespace-no-wrap" style="color:#d6deeb"><span class="  px-5"><span class="token plain whitespace-pre" style="display:inline-block"></span></span></div><div class="token-line relative whitespace-no-wrap" style="color:#d6deeb"><span class="  px-5"><span class="token plain whitespace-pre"></span><span class="token keyword whitespace-pre" style="color:rgb(199, 146, 234);font-style:italic">let</span><span class="token plain whitespace-pre"> material </span><span class="token operator whitespace-pre" style="color:rgb(127, 219, 202)">=</span><span class="token plain whitespace-pre"> </span><span class="token keyword whitespace-pre" style="color:rgb(199, 146, 234);font-style:italic">new</span><span class="token plain whitespace-pre"> </span><span class="token class-name whitespace-pre" style="color:rgb(255, 203, 139)">THREE</span><span class="token class-name punctuation whitespace-pre" style="color:rgb(199, 146, 234);font-style:italic">.</span><span class="token class-name whitespace-pre" style="color:rgb(255, 203, 139)">ShaderMaterial</span><span class="token punctuation whitespace-pre" style="color:rgb(199, 146, 234);font-style:italic">(</span><span class="token punctuation whitespace-pre" style="color:rgb(199, 146, 234);font-style:italic">)</span><span class="token punctuation whitespace-pre" style="color:rgb(199, 146, 234);font-style:italic">;</span><span class="token plain whitespace-pre"></span></span></div><div class="token-line relative whitespace-no-wrap" style="color:#d6deeb"><span class="  px-5"><span class="token plain whitespace-pre"></span><span class="token keyword whitespace-pre" style="color:rgb(199, 146, 234);font-style:italic">let</span><span class="token plain whitespace-pre"> mesh </span><span class="token operator whitespace-pre" style="color:rgb(127, 219, 202)">=</span><span class="token plain whitespace-pre"> </span><span class="token keyword whitespace-pre" style="color:rgb(199, 146, 234);font-style:italic">new</span><span class="token plain whitespace-pre"> </span><span class="token class-name whitespace-pre" style="color:rgb(255, 203, 139)">THREE</span><span class="token class-name punctuation whitespace-pre" style="color:rgb(199, 146, 234);font-style:italic">.</span><span class="token class-name whitespace-pre" style="color:rgb(255, 203, 139)">Mesh</span><span class="token punctuation whitespace-pre" style="color:rgb(199, 146, 234);font-style:italic">(</span><span class="token plain whitespace-pre">instancedGeometry</span><span class="token punctuation whitespace-pre" style="color:rgb(199, 146, 234);font-style:italic">,</span><span class="token plain whitespace-pre"> material</span><span class="token punctuation whitespace-pre" style="color:rgb(199, 146, 234);font-style:italic">)</span><span class="token punctuation whitespace-pre" style="color:rgb(199, 146, 234);font-style:italic">;</span></span></div></pre></div></div><div class="w-full max-w-3xl xl:max-w-4xl mx-auto mb-4">

<p class="text-lowWhite mx-auto text-center font-display text-sm">You can find me in this <a href="https://codesandbox.io/s/instanced-geometry-no-positioning-excy3" target="_blank" class=" border-b-1 border-gray-200 text-white font-display tracking-tiny">CodeSandbox</a>!</p></div><p class="w-full max-w-3xl xl:max-w-4xl mx-auto sm:text-lg leading-extra-relaxed font-light mb-4  text-bodyWhite">Okay, there&#x27;s only one sphere there...</p><p class="w-full max-w-3xl xl:max-w-4xl mx-auto sm:text-lg leading-extra-relaxed font-light mb-4  text-bodyWhite">No worries, the demo isn&#x27;t broken. All the 7,000 spheres are there, but they&#x27;re rendered in the same position.</p><p class="w-full max-w-3xl xl:max-w-4xl mx-auto sm:text-lg leading-extra-relaxed font-light mb-4  text-bodyWhite">With regular meshes, we would change the <span class="bg-gray-800 px-2 py-1/2 font-code text-white tracking-wide" style="font-size:0.8em">Mesh.position</span> to move each sphere. But now we have a single mesh with an instanced geometry. </p><p class="w-full max-w-3xl xl:max-w-4xl mx-auto sm:text-lg leading-extra-relaxed font-light mb-4  text-bodyWhite">Since the instances are repeated in the GPU, we also have to position them in the GPU. This means GLSL, <em>the vertex shader.</em></p><p class="w-full max-w-3xl xl:max-w-4xl mx-auto sm:text-lg leading-extra-relaxed font-light mb-4  text-bodyWhite">We&#x27;re going to move our positioning logic over to the vertex shader. But first, we need to give the shaders the data needed to calculate the position of each instance. </p><p class="w-full max-w-3xl xl:max-w-4xl mx-auto mt-2 mb-4 relative border-1 px-5 py-4 font-display text-normal"><span class=" font-body font-bold text-xs bg-white text-darkBlue absolute top-0 uppercase tracking-widest leading-relaxed px-3 py-1/2" style="transform:translateY(-70%);left:20px">note</span>You could also use the recently added <a href="https://threejs.org/docs/#api/en/objects/InstancedMesh" target="_blank" class=" border-b-1 border-gray-200 text-white font-display tracking-tiny">InstancedMesh</a> for this. Which is a bit <a href="https://github.com/mrdoob/three.js/pull/16161" target="_blank" class=" border-b-1 border-gray-200 text-white font-display tracking-tiny">easier to use</a>.</p><h3 class="w-full max-w-3xl xl:max-w-4xl mx-auto text-3xl xl:text-3xl2 font-display leading-none  text-normal mb-3 mt-7" id="Instanced-Buffer-Attributes">Instanced Buffer Attributes<!-- --> <a class="inline-flex" href="#Instanced-Buffer-Attributes"><svg version="1.1" id="Capa_1" xmlns="http://www.w3.org/2000/svg" x="0px" y="0px" viewBox="0 0 54.971 54.971" style="enable-background:new 0 0 54.971 54.971" class="title-link" xml:space="preserve"><g><path d="M51.173,3.801c-5.068-5.068-13.315-5.066-18.384,0l-9.192,9.192c-0.781,0.781-0.781,2.047,0,2.828 c0.781,0.781,2.047,0.781,2.828,0l9.192-9.192c1.691-1.69,3.951-2.622,6.363-2.622c2.413,0,4.673,0.932,6.364,2.623 s2.623,3.951,2.623,6.364c0,2.412-0.932,4.672-2.623,6.363L36.325,31.379c-3.51,3.508-9.219,3.508-12.729,0 c-0.781-0.781-2.047-0.781-2.828,0s-0.781,2.048,0,2.828c2.534,2.534,5.863,3.801,9.192,3.801s6.658-1.267,9.192-3.801 l12.021-12.021c2.447-2.446,3.795-5.711,3.795-9.192C54.968,9.512,53.62,6.248,51.173,3.801z"></path><path d="M27.132,40.57l-7.778,7.778c-1.691,1.691-3.951,2.623-6.364,2.623c-2.412,0-4.673-0.932-6.364-2.623 c-3.509-3.509-3.509-9.219,0-12.728L17.94,24.306c1.691-1.69,3.951-2.622,6.364-2.622c2.412,0,4.672,0.932,6.363,2.622 c0.781,0.781,2.047,0.781,2.828,0s0.781-2.047,0-2.828c-5.067-5.067-13.314-5.068-18.384,0L3.797,32.793 c-2.446,2.446-3.794,5.711-3.794,9.192c0,3.48,1.348,6.745,3.795,9.191c2.446,2.447,5.711,3.795,9.191,3.795 c3.481,0,6.746-1.348,9.192-3.795l7.778-7.778c0.781-0.781,0.781-2.047,0-2.828S27.913,39.789,27.132,40.57z"></path></g></svg></a></h3><p class="w-full max-w-3xl xl:max-w-4xl mx-auto sm:text-lg leading-extra-relaxed font-light mb-4  text-bodyWhite">A <strong class=" font-light tracking-normal text-white font-feature-2 font-semibold">Buffer Attribute</strong> is an array with a bunch of values describing properties of each vertex in a geometry.</p><p class="w-full max-w-3xl xl:max-w-4xl mx-auto sm:text-lg leading-extra-relaxed font-light mb-4  text-bodyWhite">Imagine a square geometry with 4 vertices, one at each corner. Each corner/vertex has it&#x27;s own position, normal, and UVs values. Those are all properties of the vertices. Those are built-in attributes of our imaginary square geometry.</p><p class="w-full max-w-3xl xl:max-w-4xl mx-auto sm:text-lg leading-extra-relaxed font-light mb-4  text-bodyWhite"><a href="https://webglfundamentals.org/webgl/lessons/webgl-how-it-works.html" target="_blank" class=" border-b-1 border-gray-200 text-white font-display tracking-tiny">When the GPU is rendering each vertex</a>. It&#x27;s going to pass the corresponding attributes of each vertex to the shaders.</p><div class="w-full max-w-3xl xl:max-w-4xl mx-auto my-7"><figure class="-ml-5 sm:-ml-3  w-full-bleed-2 sm:w-full-bleed "><div class="mb-1 gatsby-image-wrapper" style="position:relative;overflow:hidden"><div style="width:100%;padding-bottom:80.55207026348808%"></div><noscript><picture><source type='image/webp' srcset="https://cdn.sanity.io/images/b9gj9gnh/production/416a72adae79f2c6e9759a85d76b2d1bd1bd079f-3188x2568.png?w=200&h=161&fit=crop&fm=webp 200w,
https://cdn.sanity.io/images/b9gj9gnh/production/416a72adae79f2c6e9759a85d76b2d1bd1bd079f-3188x2568.png?w=400&h=322&fit=crop&fm=webp 400w,
https://cdn.sanity.io/images/b9gj9gnh/production/416a72adae79f2c6e9759a85d76b2d1bd1bd079f-3188x2568.png?w=800&h=644&fit=crop&fm=webp 800w,
https://cdn.sanity.io/images/b9gj9gnh/production/416a72adae79f2c6e9759a85d76b2d1bd1bd079f-3188x2568.png?w=1200&h=967&fit=crop&fm=webp 1200w,
https://cdn.sanity.io/images/b9gj9gnh/production/416a72adae79f2c6e9759a85d76b2d1bd1bd079f-3188x2568.png?w=1600&h=1289&fit=crop&fm=webp 1600w,
https://cdn.sanity.io/images/b9gj9gnh/production/416a72adae79f2c6e9759a85d76b2d1bd1bd079f-3188x2568.png?w=2400&h=1933&fit=crop&fm=webp 2400w" sizes="(max-width: 800px) 100vw, 800px" /><source srcset="https://cdn.sanity.io/images/b9gj9gnh/production/416a72adae79f2c6e9759a85d76b2d1bd1bd079f-3188x2568.png?w=200&h=161&fit=crop 200w,
https://cdn.sanity.io/images/b9gj9gnh/production/416a72adae79f2c6e9759a85d76b2d1bd1bd079f-3188x2568.png?w=400&h=322&fit=crop 400w,
https://cdn.sanity.io/images/b9gj9gnh/production/416a72adae79f2c6e9759a85d76b2d1bd1bd079f-3188x2568.png?w=800&h=644&fit=crop 800w,
https://cdn.sanity.io/images/b9gj9gnh/production/416a72adae79f2c6e9759a85d76b2d1bd1bd079f-3188x2568.png?w=1200&h=967&fit=crop 1200w,
https://cdn.sanity.io/images/b9gj9gnh/production/416a72adae79f2c6e9759a85d76b2d1bd1bd079f-3188x2568.png?w=1600&h=1289&fit=crop 1600w,
https://cdn.sanity.io/images/b9gj9gnh/production/416a72adae79f2c6e9759a85d76b2d1bd1bd079f-3188x2568.png?w=2400&h=1933&fit=crop 2400w" sizes="(max-width: 800px) 100vw, 800px" /><img loading="lazy" sizes="(max-width: 800px) 100vw, 800px" srcset="https://cdn.sanity.io/images/b9gj9gnh/production/416a72adae79f2c6e9759a85d76b2d1bd1bd079f-3188x2568.png?w=200&h=161&fit=crop 200w,
https://cdn.sanity.io/images/b9gj9gnh/production/416a72adae79f2c6e9759a85d76b2d1bd1bd079f-3188x2568.png?w=400&h=322&fit=crop 400w,
https://cdn.sanity.io/images/b9gj9gnh/production/416a72adae79f2c6e9759a85d76b2d1bd1bd079f-3188x2568.png?w=800&h=644&fit=crop 800w,
https://cdn.sanity.io/images/b9gj9gnh/production/416a72adae79f2c6e9759a85d76b2d1bd1bd079f-3188x2568.png?w=1200&h=967&fit=crop 1200w,
https://cdn.sanity.io/images/b9gj9gnh/production/416a72adae79f2c6e9759a85d76b2d1bd1bd079f-3188x2568.png?w=1600&h=1289&fit=crop 1600w,
https://cdn.sanity.io/images/b9gj9gnh/production/416a72adae79f2c6e9759a85d76b2d1bd1bd079f-3188x2568.png?w=2400&h=1933&fit=crop 2400w" src="https://cdn.sanity.io/images/b9gj9gnh/production/416a72adae79f2c6e9759a85d76b2d1bd1bd079f-3188x2568.png?w=800&h=644&fit=crop" alt="Buffer attributes in the vertex shader. One per vertex" style="position:absolute;top:0;left:0;opacity:1;width:100%;height:100%;object-fit:cover;object-position:center"/></picture></noscript></div><figcaption class="text-lowWhite mx-auto text-center font-display text-sm">Buffer attributes have one value(or vector) per vertex. The shader uses them to render</figcaption></figure></div><p class="w-full max-w-3xl xl:max-w-4xl mx-auto sm:text-lg leading-extra-relaxed font-light mb-4  text-bodyWhite">On the other hand, we have <strong class=" font-light tracking-normal text-white font-feature-2 font-semibold">Instanced buffer attributes</strong>. Also an array with a bunch of values, but they are <strong class=" font-light tracking-normal text-white font-feature-2 font-semibold">properties of each instance</strong> instead. <em>All vertices of the same instance share the same instanced value.</em></p><p class="w-full max-w-3xl xl:max-w-4xl mx-auto sm:text-lg leading-extra-relaxed font-light mb-4  text-bodyWhite">When the GPU is rendering each instance. It&#x27;s going to use the corresponding <strong class=" font-light tracking-normal text-white font-feature-2 font-semibold">instanced</strong> value of each instance for all its vertices. Allowing us to render each instance slightly different.</p><div class="w-full max-w-3xl xl:max-w-4xl mx-auto my-7"><figure class="-ml-5 sm:-ml-3  w-full-bleed-2 sm:w-full-bleed "><div class="mb-1 gatsby-image-wrapper" style="position:relative;overflow:hidden"><div style="width:100%;padding-bottom:70.54354178842782%"></div><noscript><picture><source type='image/webp' srcset="https://cdn.sanity.io/images/b9gj9gnh/production/f44e45000c48f6b703a88676a8a65f3f923e5cb2-3422x2414.png?w=200&h=141&fit=crop&fm=webp 200w,
https://cdn.sanity.io/images/b9gj9gnh/production/f44e45000c48f6b703a88676a8a65f3f923e5cb2-3422x2414.png?w=400&h=282&fit=crop&fm=webp 400w,
https://cdn.sanity.io/images/b9gj9gnh/production/f44e45000c48f6b703a88676a8a65f3f923e5cb2-3422x2414.png?w=800&h=564&fit=crop&fm=webp 800w,
https://cdn.sanity.io/images/b9gj9gnh/production/f44e45000c48f6b703a88676a8a65f3f923e5cb2-3422x2414.png?w=1200&h=847&fit=crop&fm=webp 1200w,
https://cdn.sanity.io/images/b9gj9gnh/production/f44e45000c48f6b703a88676a8a65f3f923e5cb2-3422x2414.png?w=1600&h=1129&fit=crop&fm=webp 1600w,
https://cdn.sanity.io/images/b9gj9gnh/production/f44e45000c48f6b703a88676a8a65f3f923e5cb2-3422x2414.png?w=2400&h=1693&fit=crop&fm=webp 2400w" sizes="(max-width: 800px) 100vw, 800px" /><source srcset="https://cdn.sanity.io/images/b9gj9gnh/production/f44e45000c48f6b703a88676a8a65f3f923e5cb2-3422x2414.png?w=200&h=141&fit=crop 200w,
https://cdn.sanity.io/images/b9gj9gnh/production/f44e45000c48f6b703a88676a8a65f3f923e5cb2-3422x2414.png?w=400&h=282&fit=crop 400w,
https://cdn.sanity.io/images/b9gj9gnh/production/f44e45000c48f6b703a88676a8a65f3f923e5cb2-3422x2414.png?w=800&h=564&fit=crop 800w,
https://cdn.sanity.io/images/b9gj9gnh/production/f44e45000c48f6b703a88676a8a65f3f923e5cb2-3422x2414.png?w=1200&h=847&fit=crop 1200w,
https://cdn.sanity.io/images/b9gj9gnh/production/f44e45000c48f6b703a88676a8a65f3f923e5cb2-3422x2414.png?w=1600&h=1129&fit=crop 1600w,
https://cdn.sanity.io/images/b9gj9gnh/production/f44e45000c48f6b703a88676a8a65f3f923e5cb2-3422x2414.png?w=2400&h=1693&fit=crop 2400w" sizes="(max-width: 800px) 100vw, 800px" /><img loading="lazy" sizes="(max-width: 800px) 100vw, 800px" srcset="https://cdn.sanity.io/images/b9gj9gnh/production/f44e45000c48f6b703a88676a8a65f3f923e5cb2-3422x2414.png?w=200&h=141&fit=crop 200w,
https://cdn.sanity.io/images/b9gj9gnh/production/f44e45000c48f6b703a88676a8a65f3f923e5cb2-3422x2414.png?w=400&h=282&fit=crop 400w,
https://cdn.sanity.io/images/b9gj9gnh/production/f44e45000c48f6b703a88676a8a65f3f923e5cb2-3422x2414.png?w=800&h=564&fit=crop 800w,
https://cdn.sanity.io/images/b9gj9gnh/production/f44e45000c48f6b703a88676a8a65f3f923e5cb2-3422x2414.png?w=1200&h=847&fit=crop 1200w,
https://cdn.sanity.io/images/b9gj9gnh/production/f44e45000c48f6b703a88676a8a65f3f923e5cb2-3422x2414.png?w=1600&h=1129&fit=crop 1600w,
https://cdn.sanity.io/images/b9gj9gnh/production/f44e45000c48f6b703a88676a8a65f3f923e5cb2-3422x2414.png?w=2400&h=1693&fit=crop 2400w" src="https://cdn.sanity.io/images/b9gj9gnh/production/f44e45000c48f6b703a88676a8a65f3f923e5cb2-3422x2414.png?w=800&h=564&fit=crop" alt="How Instanced buffer attributes affect instanced" style="position:absolute;top:0;left:0;opacity:1;width:100%;height:100%;object-fit:cover;object-position:center"/></picture></noscript></div><figcaption class="text-lowWhite mx-auto text-center font-display text-sm">How Instanced buffer attributes affect instanced</figcaption></figure></div><h4 class="w-full max-w-3xl xl:max-w-4xl mx-auto sm:text-lg font-bold tracking-widest uppercase leading-none  text-normal mb-3 mt-7" id="Creating-Instanced-Buffer-Attributes">Creating Instanced Buffer Attributes<!-- --> <a class="inline-flex" href="#Creating-Instanced-Buffer-Attributes"><svg version="1.1" id="Capa_1" xmlns="http://www.w3.org/2000/svg" x="0px" y="0px" viewBox="0 0 54.971 54.971" style="enable-background:new 0 0 54.971 54.971" class="title-link" xml:space="preserve"><g><path d="M51.173,3.801c-5.068-5.068-13.315-5.066-18.384,0l-9.192,9.192c-0.781,0.781-0.781,2.047,0,2.828 c0.781,0.781,2.047,0.781,2.828,0l9.192-9.192c1.691-1.69,3.951-2.622,6.363-2.622c2.413,0,4.673,0.932,6.364,2.623 s2.623,3.951,2.623,6.364c0,2.412-0.932,4.672-2.623,6.363L36.325,31.379c-3.51,3.508-9.219,3.508-12.729,0 c-0.781-0.781-2.047-0.781-2.828,0s-0.781,2.048,0,2.828c2.534,2.534,5.863,3.801,9.192,3.801s6.658-1.267,9.192-3.801 l12.021-12.021c2.447-2.446,3.795-5.711,3.795-9.192C54.968,9.512,53.62,6.248,51.173,3.801z"></path><path d="M27.132,40.57l-7.778,7.778c-1.691,1.691-3.951,2.623-6.364,2.623c-2.412,0-4.673-0.932-6.364-2.623 c-3.509-3.509-3.509-9.219,0-12.728L17.94,24.306c1.691-1.69,3.951-2.622,6.364-2.622c2.412,0,4.672,0.932,6.363,2.622 c0.781,0.781,2.047,0.781,2.828,0s0.781-2.047,0-2.828c-5.067-5.067-13.314-5.068-18.384,0L3.797,32.793 c-2.446,2.446-3.794,5.711-3.794,9.192c0,3.48,1.348,6.745,3.795,9.191c2.446,2.447,5.711,3.795,9.191,3.795 c3.481,0,6.746-1.348,9.192-3.795l7.778-7.778c0.781-0.781,0.781-2.047,0-2.828S27.913,39.789,27.132,40.57z"></path></g></svg></a></h4><p class="w-full max-w-3xl xl:max-w-4xl mx-auto sm:text-lg leading-extra-relaxed font-light mb-4  text-bodyWhite">Creating an <span class="bg-gray-800 px-2 py-1/2 font-code text-white tracking-wide" style="font-size:0.8em">InstancedBufferAttribute</span> is the same as creating regular <span class="bg-gray-800 px-2 py-1/2 font-code text-white tracking-wide" style="font-size:0.8em">bufferAttributes</span>. But your geometry needs to be an <span class="bg-gray-800 px-2 py-1/2 font-code text-white tracking-wide" style="font-size:0.8em">InstancedBufferGeometry</span></p><p class="w-full max-w-3xl xl:max-w-4xl mx-auto sm:text-lg leading-extra-relaxed font-light mb-4  text-bodyWhite">Let&#x27;s give each instance it&#x27;s own color instanced Attribute:</p><ol class="w-full max-w-3xl xl:max-w-4xl mx-auto list-inside mb-4 xl:text-2lg leading-relaxed pl-1"><li class="mb-1 pl-4 relative sm:text-lg leading-relaxed font-light text-bodyWhite"><span class="absolute left-0 top-0 font-bold text-white text-sm inline-block" style="line-height:1.9rem">0<!-- -->.</span>Create an array with values for all instances. In our case, we&#x27;ll get a random color and add the RGB to the array</li><li class="mb-1 pl-4 relative sm:text-lg leading-relaxed font-light text-bodyWhite"><span class="absolute left-0 top-0 font-bold text-white text-sm inline-block" style="line-height:1.9rem">1<!-- -->.</span>Transform the array to a <span class="bg-gray-800 px-2 py-1/2 font-code text-white tracking-wide" style="font-size:0.8em">Float32Array</span></li><li class="mb-1 pl-4 relative sm:text-lg leading-relaxed font-light text-bodyWhite"><span class="absolute left-0 top-0 font-bold text-white text-sm inline-block" style="line-height:1.9rem">2<!-- -->.</span>Create the <span class="bg-gray-800 px-2 py-1/2 font-code text-white tracking-wide" style="font-size:0.8em">InstancedBufferAttribute</span> of and add it to our instanced geometry. We&#x27;ll use the three RGB components of the color, so the buffer attribute is going to be size <span class="bg-gray-800 px-2 py-1/2 font-code text-white tracking-wide" style="font-size:0.8em">3</span>.</li></ol><div class="w-full max-w-3xl xl:max-w-4xl mx-auto  mx-auto my-7"><div class="-ml-5 sm:-ml-3  w-full-bleed-2 sm:w-full-bleed "><pre class="prism-code language-javascript py-5 overflow-x-auto" style="color:#d6deeb;background-color:#1d2132"><div class="token-line relative whitespace-no-wrap" style="color:#d6deeb"><span class="  px-5"><span class="token comment whitespace-pre" style="color:rgb(99, 119, 119);font-style:italic">// 1. Create the values for each instance</span><span class="token plain whitespace-pre"></span></span></div><div class="token-line relative whitespace-no-wrap" style="color:#d6deeb"><span class="  px-5"><span class="token plain whitespace-pre"></span><span class="token keyword whitespace-pre" style="color:rgb(199, 146, 234);font-style:italic">let</span><span class="token plain whitespace-pre"> aColor </span><span class="token operator whitespace-pre" style="color:rgb(127, 219, 202)">=</span><span class="token plain whitespace-pre"> </span><span class="token punctuation whitespace-pre" style="color:rgb(199, 146, 234);font-style:italic">[</span><span class="token punctuation whitespace-pre" style="color:rgb(199, 146, 234);font-style:italic">]</span><span class="token punctuation whitespace-pre" style="color:rgb(199, 146, 234);font-style:italic">;</span><span class="token plain whitespace-pre"></span></span></div><div class="token-line relative whitespace-no-wrap" style="color:#d6deeb"><span class="  px-5"><span class="token plain whitespace-pre"></span><span class="token keyword whitespace-pre" style="color:rgb(199, 146, 234);font-style:italic">let</span><span class="token plain whitespace-pre"> colors </span><span class="token operator whitespace-pre" style="color:rgb(127, 219, 202)">=</span><span class="token plain whitespace-pre"> </span><span class="token punctuation whitespace-pre" style="color:rgb(199, 146, 234);font-style:italic">[</span><span class="token plain whitespace-pre"> </span><span class="token keyword whitespace-pre" style="color:rgb(199, 146, 234);font-style:italic">new</span><span class="token plain whitespace-pre"> </span><span class="token class-name whitespace-pre" style="color:rgb(255, 203, 139)">THREE</span><span class="token class-name punctuation whitespace-pre" style="color:rgb(199, 146, 234);font-style:italic">.</span><span class="token class-name whitespace-pre" style="color:rgb(255, 203, 139)">Color</span><span class="token punctuation whitespace-pre" style="color:rgb(199, 146, 234);font-style:italic">(</span><span class="token string whitespace-pre" style="color:rgb(173, 219, 103)">&quot;#ff3030&quot;</span><span class="token punctuation whitespace-pre" style="color:rgb(199, 146, 234);font-style:italic">)</span><span class="token punctuation whitespace-pre" style="color:rgb(199, 146, 234);font-style:italic">,</span><span class="token plain whitespace-pre"> </span><span class="token keyword whitespace-pre" style="color:rgb(199, 146, 234);font-style:italic">new</span><span class="token plain whitespace-pre"> </span><span class="token class-name whitespace-pre" style="color:rgb(255, 203, 139)">THREE</span><span class="token class-name punctuation whitespace-pre" style="color:rgb(199, 146, 234);font-style:italic">.</span><span class="token class-name whitespace-pre" style="color:rgb(255, 203, 139)">Color</span><span class="token punctuation whitespace-pre" style="color:rgb(199, 146, 234);font-style:italic">(</span><span class="token string whitespace-pre" style="color:rgb(173, 219, 103)">&quot;#121214&quot;</span><span class="token punctuation whitespace-pre" style="color:rgb(199, 146, 234);font-style:italic">)</span><span class="token punctuation whitespace-pre" style="color:rgb(199, 146, 234);font-style:italic">]</span><span class="token punctuation whitespace-pre" style="color:rgb(199, 146, 234);font-style:italic">;</span><span class="token plain whitespace-pre"></span></span></div><div class="token-line relative whitespace-no-wrap" style="color:#d6deeb"><span class="  px-5"><span class="token plain whitespace-pre" style="display:inline-block"></span></span></div><div class="token-line relative whitespace-no-wrap" style="color:#d6deeb"><span class="  px-5"><span class="token plain whitespace-pre"></span><span class="token keyword whitespace-pre" style="color:rgb(199, 146, 234);font-style:italic">for</span><span class="token plain whitespace-pre"> </span><span class="token punctuation whitespace-pre" style="color:rgb(199, 146, 234);font-style:italic">(</span><span class="token keyword whitespace-pre" style="color:rgb(199, 146, 234);font-style:italic">let</span><span class="token plain whitespace-pre"> i </span><span class="token operator whitespace-pre" style="color:rgb(127, 219, 202)">=</span><span class="token plain whitespace-pre"> </span><span class="token number whitespace-pre" style="color:rgb(247, 140, 108)">0</span><span class="token punctuation whitespace-pre" style="color:rgb(199, 146, 234);font-style:italic">;</span><span class="token plain whitespace-pre"> i </span><span class="token operator whitespace-pre" style="color:rgb(127, 219, 202)">&lt;</span><span class="token plain whitespace-pre"> instanceCount</span><span class="token punctuation whitespace-pre" style="color:rgb(199, 146, 234);font-style:italic">;</span><span class="token plain whitespace-pre"> i</span><span class="token operator whitespace-pre" style="color:rgb(127, 219, 202)">++</span><span class="token punctuation whitespace-pre" style="color:rgb(199, 146, 234);font-style:italic">)</span><span class="token plain whitespace-pre"> </span><span class="token punctuation whitespace-pre" style="color:rgb(199, 146, 234);font-style:italic">{</span><span class="token plain whitespace-pre"></span></span></div><div class="token-line relative whitespace-no-wrap" style="color:#d6deeb"><span class="  px-5"><span class="token plain whitespace-pre">  </span><span class="token keyword whitespace-pre" style="color:rgb(199, 146, 234);font-style:italic">let</span><span class="token plain whitespace-pre"> color </span><span class="token operator whitespace-pre" style="color:rgb(127, 219, 202)">=</span><span class="token plain whitespace-pre"> colors</span><span class="token punctuation whitespace-pre" style="color:rgb(199, 146, 234);font-style:italic">[</span><span class="token plain whitespace-pre">random</span><span class="token punctuation whitespace-pre" style="color:rgb(199, 146, 234);font-style:italic">.</span><span class="token method function property-access whitespace-pre" style="color:rgb(199, 146, 234);font-style:italic">int</span><span class="token punctuation whitespace-pre" style="color:rgb(199, 146, 234);font-style:italic">(</span><span class="token number whitespace-pre" style="color:rgb(247, 140, 108)">0</span><span class="token punctuation whitespace-pre" style="color:rgb(199, 146, 234);font-style:italic">,</span><span class="token plain whitespace-pre"> colors</span><span class="token punctuation whitespace-pre" style="color:rgb(199, 146, 234);font-style:italic">.</span><span class="token property-access whitespace-pre">length</span><span class="token operator whitespace-pre" style="color:rgb(127, 219, 202)">-</span><span class="token number whitespace-pre" style="color:rgb(247, 140, 108)">1</span><span class="token punctuation whitespace-pre" style="color:rgb(199, 146, 234);font-style:italic">)</span><span class="token punctuation whitespace-pre" style="color:rgb(199, 146, 234);font-style:italic">]</span><span class="token punctuation whitespace-pre" style="color:rgb(199, 146, 234);font-style:italic">;</span><span class="token plain whitespace-pre"></span></span></div><div class="token-line relative whitespace-no-wrap" style="color:#d6deeb"><span class="  px-5"><span class="token plain whitespace-pre">  aColor</span><span class="token punctuation whitespace-pre" style="color:rgb(199, 146, 234);font-style:italic">.</span><span class="token method function property-access whitespace-pre" style="color:rgb(199, 146, 234);font-style:italic">push</span><span class="token punctuation whitespace-pre" style="color:rgb(199, 146, 234);font-style:italic">(</span><span class="token plain whitespace-pre">color</span><span class="token punctuation whitespace-pre" style="color:rgb(199, 146, 234);font-style:italic">.</span><span class="token property-access whitespace-pre">r</span><span class="token punctuation whitespace-pre" style="color:rgb(199, 146, 234);font-style:italic">,</span><span class="token plain whitespace-pre"> color</span><span class="token punctuation whitespace-pre" style="color:rgb(199, 146, 234);font-style:italic">.</span><span class="token property-access whitespace-pre">g</span><span class="token punctuation whitespace-pre" style="color:rgb(199, 146, 234);font-style:italic">,</span><span class="token plain whitespace-pre"> color</span><span class="token punctuation whitespace-pre" style="color:rgb(199, 146, 234);font-style:italic">.</span><span class="token property-access whitespace-pre">b</span><span class="token punctuation whitespace-pre" style="color:rgb(199, 146, 234);font-style:italic">)</span><span class="token punctuation whitespace-pre" style="color:rgb(199, 146, 234);font-style:italic">;</span><span class="token plain whitespace-pre"></span></span></div><div class="token-line relative whitespace-no-wrap" style="color:#d6deeb"><span class="  px-5"><span class="token plain whitespace-pre"></span><span class="token punctuation whitespace-pre" style="color:rgb(199, 146, 234);font-style:italic">}</span><span class="token plain whitespace-pre"></span></span></div><div class="token-line relative whitespace-no-wrap" style="color:#d6deeb"><span class="  px-5"><span class="token plain whitespace-pre" style="display:inline-block"></span></span></div><div class="token-line relative whitespace-no-wrap" style="color:#d6deeb"><span class="  px-5"><span class="token plain whitespace-pre"></span><span class="token comment whitespace-pre" style="color:rgb(99, 119, 119);font-style:italic">// 2. Transform the array to float32</span><span class="token plain whitespace-pre"></span></span></div><div class="token-line relative whitespace-no-wrap" style="color:#d6deeb"><span class="  px-5"><span class="token plain whitespace-pre"></span><span class="token keyword whitespace-pre" style="color:rgb(199, 146, 234);font-style:italic">let</span><span class="token plain whitespace-pre"> aColorFloat32 </span><span class="token operator whitespace-pre" style="color:rgb(127, 219, 202)">=</span><span class="token plain whitespace-pre"> </span><span class="token keyword whitespace-pre" style="color:rgb(199, 146, 234);font-style:italic">new</span><span class="token plain whitespace-pre"> </span><span class="token class-name whitespace-pre" style="color:rgb(255, 203, 139)">Float32Array</span><span class="token punctuation whitespace-pre" style="color:rgb(199, 146, 234);font-style:italic">(</span><span class="token plain whitespace-pre">aColor</span><span class="token punctuation whitespace-pre" style="color:rgb(199, 146, 234);font-style:italic">)</span><span class="token punctuation whitespace-pre" style="color:rgb(199, 146, 234);font-style:italic">;</span><span class="token plain whitespace-pre"></span></span></div><div class="token-line relative whitespace-no-wrap" style="color:#d6deeb"><span class="  px-5"><span class="token plain whitespace-pre" style="display:inline-block"></span></span></div><div class="token-line relative whitespace-no-wrap" style="color:#d6deeb"><span class="  px-5"><span class="token plain whitespace-pre"></span><span class="token comment whitespace-pre" style="color:rgb(99, 119, 119);font-style:italic">// 3. Create te instanced Buffer Attribute of size three</span><span class="token plain whitespace-pre"></span></span></div><div class="token-line relative whitespace-no-wrap" style="color:#d6deeb"><span class="  px-5"><span class="token plain whitespace-pre">instancedGeometry</span><span class="token punctuation whitespace-pre" style="color:rgb(199, 146, 234);font-style:italic">.</span><span class="token method function property-access whitespace-pre" style="color:rgb(199, 146, 234);font-style:italic">addAttribute</span><span class="token punctuation whitespace-pre" style="color:rgb(199, 146, 234);font-style:italic">(</span><span class="token string whitespace-pre" style="color:rgb(173, 219, 103)">&quot;aColor&quot;</span><span class="token punctuation whitespace-pre" style="color:rgb(199, 146, 234);font-style:italic">,</span><span class="token plain whitespace-pre"> </span></span></div><div class="token-line relative whitespace-no-wrap" style="color:#d6deeb"><span class="  px-5"><span class="token plain whitespace-pre">  </span><span class="token keyword whitespace-pre" style="color:rgb(199, 146, 234);font-style:italic">new</span><span class="token plain whitespace-pre"> </span><span class="token class-name whitespace-pre" style="color:rgb(255, 203, 139)">THREE</span><span class="token class-name punctuation whitespace-pre" style="color:rgb(199, 146, 234);font-style:italic">.</span><span class="token class-name whitespace-pre" style="color:rgb(255, 203, 139)">InstancedBufferAttribute</span><span class="token punctuation whitespace-pre" style="color:rgb(199, 146, 234);font-style:italic">(</span><span class="token plain whitespace-pre">aColorFloat32</span><span class="token punctuation whitespace-pre" style="color:rgb(199, 146, 234);font-style:italic">,</span><span class="token plain whitespace-pre"> </span><span class="token number whitespace-pre" style="color:rgb(247, 140, 108)">3</span><span class="token punctuation whitespace-pre" style="color:rgb(199, 146, 234);font-style:italic">,</span><span class="token plain whitespace-pre"> </span><span class="token boolean whitespace-pre" style="color:rgb(255, 88, 116)">false</span><span class="token punctuation whitespace-pre" style="color:rgb(199, 146, 234);font-style:italic">)</span><span class="token plain whitespace-pre"></span></span></div><div class="token-line relative whitespace-no-wrap" style="color:#d6deeb"><span class="  px-5"><span class="token plain whitespace-pre"></span><span class="token punctuation whitespace-pre" style="color:rgb(199, 146, 234);font-style:italic">)</span><span class="token punctuation whitespace-pre" style="color:rgb(199, 146, 234);font-style:italic">;</span></span></div></pre></div></div><p class="w-full max-w-3xl xl:max-w-4xl mx-auto sm:text-lg leading-extra-relaxed font-light mb-4  text-bodyWhite">To calculate our sphere&#x27;s curve position, we&#x27;re going to need a few different values:</p><ul class="w-full max-w-3xl xl:max-w-4xl mx-auto list-inside mb-4 xl:text-2lg leading-relaxed pl-1"><li class="mb-1 pl-4 relative sm:text-lg leading-relaxed font-light text-bodyWhite"><span class="absolute left-0 top-0 font-bold text-white text-sm inline-block" style="line-height:1.9rem">0<!-- -->.</span>The X and Y <span class="bg-gray-800 px-2 py-1/2 font-code text-white tracking-wide" style="font-size:0.8em">Radius</span> of the curve</li><li class="mb-1 pl-4 relative sm:text-lg leading-relaxed font-light text-bodyWhite"><span class="absolute left-0 top-0 font-bold text-white text-sm inline-block" style="line-height:1.9rem">1<!-- -->.</span>The z <span class="bg-gray-800 px-2 py-1/2 font-code text-white tracking-wide" style="font-size:0.8em">curve offset</span> to give it a bit of thickness instead of having it flat.</li><li class="mb-1 pl-4 relative sm:text-lg leading-relaxed font-light text-bodyWhite"><span class="absolute left-0 top-0 font-bold text-white text-sm inline-block" style="line-height:1.9rem">2<!-- -->.</span>The <span class="bg-gray-800 px-2 py-1/2 font-code text-white tracking-wide" style="font-size:0.8em">progress</span> of the sphere through the curve.</li><li class="mb-1 pl-4 relative sm:text-lg leading-relaxed font-light text-bodyWhite"><span class="absolute left-0 top-0 font-bold text-white text-sm inline-block" style="line-height:1.9rem">3<!-- -->.</span>Travel <span class="bg-gray-800 px-2 py-1/2 font-code text-white tracking-wide" style="font-size:0.8em">speed</span> of the sphere.</li></ul><p class="w-full max-w-3xl xl:max-w-4xl mx-auto sm:text-lg leading-extra-relaxed font-light mb-4  text-bodyWhite">That&#x27;s quite a few parameters! We could create one <span class="bg-gray-800 px-2 py-1/2 font-code text-white tracking-wide" style="font-size:0.8em">instancedBufferAttribute</span> for each value. But each attribute is going to create a webGL call, that&#x27;s 4 webGL calls in total.  Just like draw calls, all other webGL calls are also CPU-to-GPU communication. <br/><br/>Instead, we&#x27;re going to create a single <span class="bg-gray-800 px-2 py-1/2 font-code text-white tracking-wide" style="font-size:0.8em">InstancedBufferAttribute</span> of vector size 4, <span class="bg-gray-800 px-2 py-1/2 font-code text-white tracking-wide" style="font-size:0.8em">aCurve</span> and batch all our properties in there. Leaving us with only one webGL call!</p><blockquote class="w-full max-w-3xl xl:max-w-4xl mx-auto py-2 pl-4 border-l-4 border-white ">Any time you can reduce the amount of JS code that gets executed and ESPECIALLY limit the number of calls JavaScript makes into the WebGL context, the better. <a href="https://github.com/manthrax" target="_blank" class=" border-b-1 border-gray-200 text-white font-display tracking-tiny">@thrax</a></blockquote><div class="w-full max-w-3xl xl:max-w-4xl mx-auto  mx-auto my-7"><div class="-ml-5 sm:-ml-3  w-full-bleed-2 sm:w-full-bleed "><pre class="prism-code language-javascript py-5 overflow-x-auto" style="color:#d6deeb;background-color:#1d2132"><div class="token-line relative whitespace-no-wrap" style="color:#d6deeb"><span class="  px-5"><span class="token keyword whitespace-pre" style="color:rgb(199, 146, 234);font-style:italic">let</span><span class="token plain whitespace-pre"> aColor </span><span class="token operator whitespace-pre" style="color:rgb(127, 219, 202)">=</span><span class="token plain whitespace-pre"> </span><span class="token punctuation whitespace-pre" style="color:rgb(199, 146, 234);font-style:italic">[</span><span class="token punctuation whitespace-pre" style="color:rgb(199, 146, 234);font-style:italic">]</span><span class="token punctuation whitespace-pre" style="color:rgb(199, 146, 234);font-style:italic">;</span><span class="token plain whitespace-pre"></span></span></div><div class="token-line relative whitespace-no-wrap" style="color:#d6deeb"><span class="  px-5"><span class="token plain whitespace-pre"></span><span class="token keyword whitespace-pre" style="color:rgb(199, 146, 234);font-style:italic">let</span><span class="token plain whitespace-pre"> aCurve </span><span class="token operator whitespace-pre" style="color:rgb(127, 219, 202)">=</span><span class="token plain whitespace-pre"> </span><span class="token punctuation whitespace-pre" style="color:rgb(199, 146, 234);font-style:italic">[</span><span class="token punctuation whitespace-pre" style="color:rgb(199, 146, 234);font-style:italic">]</span><span class="token punctuation whitespace-pre" style="color:rgb(199, 146, 234);font-style:italic">;</span><span class="token plain whitespace-pre"></span></span></div><div class="token-line relative whitespace-no-wrap" style="color:#d6deeb"><span class="  px-5"><span class="token plain whitespace-pre"></span><span class="token keyword whitespace-pre" style="color:rgb(199, 146, 234);font-style:italic">let</span><span class="token plain whitespace-pre"> colors </span><span class="token operator whitespace-pre" style="color:rgb(127, 219, 202)">=</span><span class="token plain whitespace-pre"> </span><span class="token punctuation whitespace-pre" style="color:rgb(199, 146, 234);font-style:italic">[</span><span class="token plain whitespace-pre"> </span><span class="token keyword whitespace-pre" style="color:rgb(199, 146, 234);font-style:italic">new</span><span class="token plain whitespace-pre"> </span><span class="token class-name whitespace-pre" style="color:rgb(255, 203, 139)">THREE</span><span class="token class-name punctuation whitespace-pre" style="color:rgb(199, 146, 234);font-style:italic">.</span><span class="token class-name whitespace-pre" style="color:rgb(255, 203, 139)">Color</span><span class="token punctuation whitespace-pre" style="color:rgb(199, 146, 234);font-style:italic">(</span><span class="token string whitespace-pre" style="color:rgb(173, 219, 103)">&quot;#ff3030&quot;</span><span class="token punctuation whitespace-pre" style="color:rgb(199, 146, 234);font-style:italic">)</span><span class="token punctuation whitespace-pre" style="color:rgb(199, 146, 234);font-style:italic">,</span><span class="token plain whitespace-pre"> </span><span class="token keyword whitespace-pre" style="color:rgb(199, 146, 234);font-style:italic">new</span><span class="token plain whitespace-pre"> </span><span class="token class-name whitespace-pre" style="color:rgb(255, 203, 139)">THREE</span><span class="token class-name punctuation whitespace-pre" style="color:rgb(199, 146, 234);font-style:italic">.</span><span class="token class-name whitespace-pre" style="color:rgb(255, 203, 139)">Color</span><span class="token punctuation whitespace-pre" style="color:rgb(199, 146, 234);font-style:italic">(</span><span class="token string whitespace-pre" style="color:rgb(173, 219, 103)">&quot;#121214&quot;</span><span class="token punctuation whitespace-pre" style="color:rgb(199, 146, 234);font-style:italic">)</span><span class="token punctuation whitespace-pre" style="color:rgb(199, 146, 234);font-style:italic">]</span><span class="token punctuation whitespace-pre" style="color:rgb(199, 146, 234);font-style:italic">;</span><span class="token plain whitespace-pre"></span></span></div><div class="token-line relative whitespace-no-wrap" style="color:#d6deeb"><span class="  px-5"><span class="token plain whitespace-pre" style="display:inline-block"></span></span></div><div class="token-line relative whitespace-no-wrap" style="color:#d6deeb"><span class="  px-5"><span class="token plain whitespace-pre"></span><span class="token keyword whitespace-pre" style="color:rgb(199, 146, 234);font-style:italic">for</span><span class="token plain whitespace-pre"> </span><span class="token punctuation whitespace-pre" style="color:rgb(199, 146, 234);font-style:italic">(</span><span class="token keyword whitespace-pre" style="color:rgb(199, 146, 234);font-style:italic">let</span><span class="token plain whitespace-pre"> i </span><span class="token operator whitespace-pre" style="color:rgb(127, 219, 202)">=</span><span class="token plain whitespace-pre"> </span><span class="token number whitespace-pre" style="color:rgb(247, 140, 108)">0</span><span class="token punctuation whitespace-pre" style="color:rgb(199, 146, 234);font-style:italic">;</span><span class="token plain whitespace-pre"> i </span><span class="token operator whitespace-pre" style="color:rgb(127, 219, 202)">&lt;</span><span class="token plain whitespace-pre"> instanceCount</span><span class="token punctuation whitespace-pre" style="color:rgb(199, 146, 234);font-style:italic">;</span><span class="token plain whitespace-pre"> i</span><span class="token operator whitespace-pre" style="color:rgb(127, 219, 202)">++</span><span class="token punctuation whitespace-pre" style="color:rgb(199, 146, 234);font-style:italic">)</span><span class="token plain whitespace-pre"> </span><span class="token punctuation whitespace-pre" style="color:rgb(199, 146, 234);font-style:italic">{</span><span class="token plain whitespace-pre"></span></span></div><div class="token-line relative whitespace-no-wrap" style="color:#d6deeb"><span class="  px-5"><span class="token plain whitespace-pre">  </span><span class="token keyword whitespace-pre" style="color:rgb(199, 146, 234);font-style:italic">let</span><span class="token plain whitespace-pre"> radius </span><span class="token operator whitespace-pre" style="color:rgb(127, 219, 202)">=</span><span class="token plain whitespace-pre"> random</span><span class="token punctuation whitespace-pre" style="color:rgb(199, 146, 234);font-style:italic">.</span><span class="token method function property-access whitespace-pre" style="color:rgb(199, 146, 234);font-style:italic">float</span><span class="token punctuation whitespace-pre" style="color:rgb(199, 146, 234);font-style:italic">(</span><span class="token number whitespace-pre" style="color:rgb(247, 140, 108)">30</span><span class="token punctuation whitespace-pre" style="color:rgb(199, 146, 234);font-style:italic">,</span><span class="token plain whitespace-pre"> </span><span class="token number whitespace-pre" style="color:rgb(247, 140, 108)">40</span><span class="token punctuation whitespace-pre" style="color:rgb(199, 146, 234);font-style:italic">)</span><span class="token punctuation whitespace-pre" style="color:rgb(199, 146, 234);font-style:italic">;</span><span class="token plain whitespace-pre"></span></span></div><div class="token-line relative whitespace-no-wrap" style="color:#d6deeb"><span class="  px-5"><span class="token plain whitespace-pre">  </span><span class="token keyword whitespace-pre" style="color:rgb(199, 146, 234);font-style:italic">let</span><span class="token plain whitespace-pre"> zOffset </span><span class="token operator whitespace-pre" style="color:rgb(127, 219, 202)">=</span><span class="token plain whitespace-pre"> random</span><span class="token punctuation whitespace-pre" style="color:rgb(199, 146, 234);font-style:italic">.</span><span class="token method function property-access whitespace-pre" style="color:rgb(199, 146, 234);font-style:italic">float</span><span class="token punctuation whitespace-pre" style="color:rgb(199, 146, 234);font-style:italic">(</span><span class="token operator whitespace-pre" style="color:rgb(127, 219, 202)">-</span><span class="token number whitespace-pre" style="color:rgb(247, 140, 108)">5</span><span class="token punctuation whitespace-pre" style="color:rgb(199, 146, 234);font-style:italic">,</span><span class="token plain whitespace-pre"> </span><span class="token number whitespace-pre" style="color:rgb(247, 140, 108)">5</span><span class="token punctuation whitespace-pre" style="color:rgb(199, 146, 234);font-style:italic">)</span><span class="token punctuation whitespace-pre" style="color:rgb(199, 146, 234);font-style:italic">;</span><span class="token plain whitespace-pre"></span></span></div><div class="token-line relative whitespace-no-wrap" style="color:#d6deeb"><span class="  px-5"><span class="token plain whitespace-pre">  </span><span class="token keyword whitespace-pre" style="color:rgb(199, 146, 234);font-style:italic">let</span><span class="token plain whitespace-pre"> progress </span><span class="token operator whitespace-pre" style="color:rgb(127, 219, 202)">=</span><span class="token plain whitespace-pre"> random</span><span class="token punctuation whitespace-pre" style="color:rgb(199, 146, 234);font-style:italic">.</span><span class="token method function property-access whitespace-pre" style="color:rgb(199, 146, 234);font-style:italic">float</span><span class="token punctuation whitespace-pre" style="color:rgb(199, 146, 234);font-style:italic">(</span><span class="token punctuation whitespace-pre" style="color:rgb(199, 146, 234);font-style:italic">)</span><span class="token punctuation whitespace-pre" style="color:rgb(199, 146, 234);font-style:italic">;</span><span class="token plain whitespace-pre"></span></span></div><div class="token-line relative whitespace-no-wrap" style="color:#d6deeb"><span class="  px-5"><span class="token plain whitespace-pre">  </span><span class="token keyword whitespace-pre" style="color:rgb(199, 146, 234);font-style:italic">let</span><span class="token plain whitespace-pre"> speed </span><span class="token operator whitespace-pre" style="color:rgb(127, 219, 202)">=</span><span class="token plain whitespace-pre"> random</span><span class="token punctuation whitespace-pre" style="color:rgb(199, 146, 234);font-style:italic">.</span><span class="token method function property-access whitespace-pre" style="color:rgb(199, 146, 234);font-style:italic">float</span><span class="token punctuation whitespace-pre" style="color:rgb(199, 146, 234);font-style:italic">(</span><span class="token number whitespace-pre" style="color:rgb(247, 140, 108)">0.02</span><span class="token punctuation whitespace-pre" style="color:rgb(199, 146, 234);font-style:italic">,</span><span class="token plain whitespace-pre"> </span><span class="token number whitespace-pre" style="color:rgb(247, 140, 108)">0.07</span><span class="token punctuation whitespace-pre" style="color:rgb(199, 146, 234);font-style:italic">)</span><span class="token punctuation whitespace-pre" style="color:rgb(199, 146, 234);font-style:italic">;</span><span class="token plain whitespace-pre"></span></span></div><div class="token-line relative whitespace-no-wrap" style="color:#d6deeb"><span class="  px-5"><span class="token plain whitespace-pre">  aCurve</span><span class="token punctuation whitespace-pre" style="color:rgb(199, 146, 234);font-style:italic">.</span><span class="token method function property-access whitespace-pre" style="color:rgb(199, 146, 234);font-style:italic">push</span><span class="token punctuation whitespace-pre" style="color:rgb(199, 146, 234);font-style:italic">(</span><span class="token plain whitespace-pre">radius</span><span class="token punctuation whitespace-pre" style="color:rgb(199, 146, 234);font-style:italic">,</span><span class="token plain whitespace-pre"> progress</span><span class="token punctuation whitespace-pre" style="color:rgb(199, 146, 234);font-style:italic">,</span><span class="token plain whitespace-pre"> zOffset</span><span class="token punctuation whitespace-pre" style="color:rgb(199, 146, 234);font-style:italic">,</span><span class="token plain whitespace-pre"> speed</span><span class="token punctuation whitespace-pre" style="color:rgb(199, 146, 234);font-style:italic">)</span><span class="token punctuation whitespace-pre" style="color:rgb(199, 146, 234);font-style:italic">;</span><span class="token plain whitespace-pre"></span></span></div><div class="token-line relative whitespace-no-wrap" style="color:#d6deeb"><span class="  px-5"><span class="token plain whitespace-pre">  </span></span></div><div class="token-line relative whitespace-no-wrap" style="color:#d6deeb"><span class="  px-5"><span class="token plain whitespace-pre">  </span><span class="token keyword whitespace-pre" style="color:rgb(199, 146, 234);font-style:italic">let</span><span class="token plain whitespace-pre"> color </span><span class="token operator whitespace-pre" style="color:rgb(127, 219, 202)">=</span><span class="token plain whitespace-pre"> colors</span><span class="token punctuation whitespace-pre" style="color:rgb(199, 146, 234);font-style:italic">[</span><span class="token plain whitespace-pre">random</span><span class="token punctuation whitespace-pre" style="color:rgb(199, 146, 234);font-style:italic">.</span><span class="token method function property-access whitespace-pre" style="color:rgb(199, 146, 234);font-style:italic">int</span><span class="token punctuation whitespace-pre" style="color:rgb(199, 146, 234);font-style:italic">(</span><span class="token number whitespace-pre" style="color:rgb(247, 140, 108)">0</span><span class="token punctuation whitespace-pre" style="color:rgb(199, 146, 234);font-style:italic">,</span><span class="token plain whitespace-pre"> colors</span><span class="token punctuation whitespace-pre" style="color:rgb(199, 146, 234);font-style:italic">.</span><span class="token property-access whitespace-pre">length</span><span class="token operator whitespace-pre" style="color:rgb(127, 219, 202)">-</span><span class="token number whitespace-pre" style="color:rgb(247, 140, 108)">1</span><span class="token punctuation whitespace-pre" style="color:rgb(199, 146, 234);font-style:italic">)</span><span class="token punctuation whitespace-pre" style="color:rgb(199, 146, 234);font-style:italic">]</span><span class="token punctuation whitespace-pre" style="color:rgb(199, 146, 234);font-style:italic">;</span><span class="token plain whitespace-pre"></span></span></div><div class="token-line relative whitespace-no-wrap" style="color:#d6deeb"><span class="  px-5"><span class="token plain whitespace-pre">  aColor</span><span class="token punctuation whitespace-pre" style="color:rgb(199, 146, 234);font-style:italic">.</span><span class="token method function property-access whitespace-pre" style="color:rgb(199, 146, 234);font-style:italic">push</span><span class="token punctuation whitespace-pre" style="color:rgb(199, 146, 234);font-style:italic">(</span><span class="token plain whitespace-pre">color</span><span class="token punctuation whitespace-pre" style="color:rgb(199, 146, 234);font-style:italic">.</span><span class="token property-access whitespace-pre">r</span><span class="token punctuation whitespace-pre" style="color:rgb(199, 146, 234);font-style:italic">,</span><span class="token plain whitespace-pre"> color</span><span class="token punctuation whitespace-pre" style="color:rgb(199, 146, 234);font-style:italic">.</span><span class="token property-access whitespace-pre">g</span><span class="token punctuation whitespace-pre" style="color:rgb(199, 146, 234);font-style:italic">,</span><span class="token plain whitespace-pre"> color</span><span class="token punctuation whitespace-pre" style="color:rgb(199, 146, 234);font-style:italic">.</span><span class="token property-access whitespace-pre">b</span><span class="token punctuation whitespace-pre" style="color:rgb(199, 146, 234);font-style:italic">)</span><span class="token punctuation whitespace-pre" style="color:rgb(199, 146, 234);font-style:italic">;</span><span class="token plain whitespace-pre"></span></span></div><div class="token-line relative whitespace-no-wrap" style="color:#d6deeb"><span class="  px-5"><span class="token plain whitespace-pre"></span><span class="token punctuation whitespace-pre" style="color:rgb(199, 146, 234);font-style:italic">}</span><span class="token plain whitespace-pre"></span></span></div><div class="token-line relative whitespace-no-wrap" style="color:#d6deeb"><span class="  px-5"><span class="token plain whitespace-pre"></span><span class="token keyword whitespace-pre" style="color:rgb(199, 146, 234);font-style:italic">let</span><span class="token plain whitespace-pre"> aCurveFloat32 </span><span class="token operator whitespace-pre" style="color:rgb(127, 219, 202)">=</span><span class="token plain whitespace-pre"> </span><span class="token keyword whitespace-pre" style="color:rgb(199, 146, 234);font-style:italic">new</span><span class="token plain whitespace-pre"> </span><span class="token class-name whitespace-pre" style="color:rgb(255, 203, 139)">Float32Array</span><span class="token punctuation whitespace-pre" style="color:rgb(199, 146, 234);font-style:italic">(</span><span class="token plain whitespace-pre">aCurve</span><span class="token punctuation whitespace-pre" style="color:rgb(199, 146, 234);font-style:italic">)</span><span class="token punctuation whitespace-pre" style="color:rgb(199, 146, 234);font-style:italic">;</span><span class="token plain whitespace-pre"></span></span></div><div class="token-line relative whitespace-no-wrap" style="color:#d6deeb"><span class="  px-5"><span class="token plain whitespace-pre">instancedGeometry</span><span class="token punctuation whitespace-pre" style="color:rgb(199, 146, 234);font-style:italic">.</span><span class="token method function property-access whitespace-pre" style="color:rgb(199, 146, 234);font-style:italic">addAttribute</span><span class="token punctuation whitespace-pre" style="color:rgb(199, 146, 234);font-style:italic">(</span><span class="token plain whitespace-pre"></span></span></div><div class="token-line relative whitespace-no-wrap" style="color:#d6deeb"><span class="  px-5"><span class="token plain whitespace-pre">  </span><span class="token string whitespace-pre" style="color:rgb(173, 219, 103)">&quot;aCurve&quot;</span><span class="token punctuation whitespace-pre" style="color:rgb(199, 146, 234);font-style:italic">,</span><span class="token plain whitespace-pre"></span></span></div><div class="token-line relative whitespace-no-wrap" style="color:#d6deeb"><span class="  px-5"><span class="token plain whitespace-pre">  </span><span class="token keyword whitespace-pre" style="color:rgb(199, 146, 234);font-style:italic">new</span><span class="token plain whitespace-pre"> </span><span class="token class-name whitespace-pre" style="color:rgb(255, 203, 139)">THREE</span><span class="token class-name punctuation whitespace-pre" style="color:rgb(199, 146, 234);font-style:italic">.</span><span class="token class-name whitespace-pre" style="color:rgb(255, 203, 139)">InstancedBufferAttribute</span><span class="token punctuation whitespace-pre" style="color:rgb(199, 146, 234);font-style:italic">(</span><span class="token plain whitespace-pre">aCurveFloat32</span><span class="token punctuation whitespace-pre" style="color:rgb(199, 146, 234);font-style:italic">,</span><span class="token plain whitespace-pre"> </span><span class="token number whitespace-pre" style="color:rgb(247, 140, 108)">4</span><span class="token punctuation whitespace-pre" style="color:rgb(199, 146, 234);font-style:italic">,</span><span class="token plain whitespace-pre"> </span><span class="token boolean whitespace-pre" style="color:rgb(255, 88, 116)">false</span><span class="token punctuation whitespace-pre" style="color:rgb(199, 146, 234);font-style:italic">)</span><span class="token plain whitespace-pre"></span></span></div><div class="token-line relative whitespace-no-wrap" style="color:#d6deeb"><span class="  px-5"><span class="token plain whitespace-pre"></span><span class="token punctuation whitespace-pre" style="color:rgb(199, 146, 234);font-style:italic">)</span><span class="token punctuation whitespace-pre" style="color:rgb(199, 146, 234);font-style:italic">;</span><span class="token plain whitespace-pre"></span></span></div><div class="token-line relative whitespace-no-wrap" style="color:#d6deeb"><span class="  px-5"><span class="token plain whitespace-pre" style="display:inline-block"></span></span></div><div class="token-line relative whitespace-no-wrap" style="color:#d6deeb"><span class="  px-5"><span class="token plain whitespace-pre"></span><span class="token keyword whitespace-pre" style="color:rgb(199, 146, 234);font-style:italic">let</span><span class="token plain whitespace-pre"> aColorFloat32 </span><span class="token operator whitespace-pre" style="color:rgb(127, 219, 202)">=</span><span class="token plain whitespace-pre"> </span><span class="token keyword whitespace-pre" style="color:rgb(199, 146, 234);font-style:italic">new</span><span class="token plain whitespace-pre"> </span><span class="token class-name whitespace-pre" style="color:rgb(255, 203, 139)">Float32Array</span><span class="token punctuation whitespace-pre" style="color:rgb(199, 146, 234);font-style:italic">(</span><span class="token plain whitespace-pre">aColor</span><span class="token punctuation whitespace-pre" style="color:rgb(199, 146, 234);font-style:italic">)</span><span class="token punctuation whitespace-pre" style="color:rgb(199, 146, 234);font-style:italic">;</span><span class="token plain whitespace-pre"></span></span></div><div class="token-line relative whitespace-no-wrap" style="color:#d6deeb"><span class="  px-5"><span class="token plain whitespace-pre">instancedGeometry</span><span class="token punctuation whitespace-pre" style="color:rgb(199, 146, 234);font-style:italic">.</span><span class="token method function property-access whitespace-pre" style="color:rgb(199, 146, 234);font-style:italic">addAttribute</span><span class="token punctuation whitespace-pre" style="color:rgb(199, 146, 234);font-style:italic">(</span><span class="token plain whitespace-pre"></span></span></div><div class="token-line relative whitespace-no-wrap" style="color:#d6deeb"><span class="  px-5"><span class="token plain whitespace-pre">  </span><span class="token string whitespace-pre" style="color:rgb(173, 219, 103)">&quot;aColor&quot;</span><span class="token punctuation whitespace-pre" style="color:rgb(199, 146, 234);font-style:italic">,</span><span class="token plain whitespace-pre"></span></span></div><div class="token-line relative whitespace-no-wrap" style="color:#d6deeb"><span class="  px-5"><span class="token plain whitespace-pre">  </span><span class="token keyword whitespace-pre" style="color:rgb(199, 146, 234);font-style:italic">new</span><span class="token plain whitespace-pre"> </span><span class="token class-name whitespace-pre" style="color:rgb(255, 203, 139)">THREE</span><span class="token class-name punctuation whitespace-pre" style="color:rgb(199, 146, 234);font-style:italic">.</span><span class="token class-name whitespace-pre" style="color:rgb(255, 203, 139)">InstancedBufferAttribute</span><span class="token punctuation whitespace-pre" style="color:rgb(199, 146, 234);font-style:italic">(</span><span class="token plain whitespace-pre">aColorFloat32</span><span class="token punctuation whitespace-pre" style="color:rgb(199, 146, 234);font-style:italic">,</span><span class="token plain whitespace-pre"> </span><span class="token number whitespace-pre" style="color:rgb(247, 140, 108)">3</span><span class="token punctuation whitespace-pre" style="color:rgb(199, 146, 234);font-style:italic">,</span><span class="token plain whitespace-pre"> </span><span class="token boolean whitespace-pre" style="color:rgb(255, 88, 116)">false</span><span class="token punctuation whitespace-pre" style="color:rgb(199, 146, 234);font-style:italic">)</span><span class="token plain whitespace-pre"></span></span></div><div class="token-line relative whitespace-no-wrap" style="color:#d6deeb"><span class="  px-5"><span class="token plain whitespace-pre"></span><span class="token punctuation whitespace-pre" style="color:rgb(199, 146, 234);font-style:italic">)</span><span class="token punctuation whitespace-pre" style="color:rgb(199, 146, 234);font-style:italic">;</span></span></div></pre></div></div><p class="w-full max-w-3xl xl:max-w-4xl mx-auto mt-2 mb-4 relative border-1 px-5 py-4 font-display text-normal"><span class=" font-body font-bold text-xs bg-white text-darkBlue absolute top-0 uppercase tracking-widest leading-relaxed px-3 py-1/2" style="transform:translateY(-70%);left:20px">note</span>Adding the lowercase &quot;a&quot; to my variables helps me identify buffer attributes easier.</p><p class="w-full max-w-3xl xl:max-w-4xl mx-auto sm:text-lg leading-extra-relaxed font-light mb-4  text-bodyWhite">By themselves, these <span class="bg-gray-800 px-2 py-1/2 font-code text-white tracking-wide" style="font-size:0.8em">BufferAttributes</span> only store data in the GPU. If the shaders don&#x27;t make use of the attributes, they don&#x27;t do anything. We need to add our custom positioning logic to the shaders and make use of the attributes.</p><h4 class="w-full max-w-3xl xl:max-w-4xl mx-auto sm:text-lg font-bold tracking-widest uppercase leading-none  text-normal mb-3 mt-7" id="Animating-in-the-Shaders">Animating in the Shaders<!-- --> <a class="inline-flex" href="#Animating-in-the-Shaders"><svg version="1.1" id="Capa_1" xmlns="http://www.w3.org/2000/svg" x="0px" y="0px" viewBox="0 0 54.971 54.971" style="enable-background:new 0 0 54.971 54.971" class="title-link" xml:space="preserve"><g><path d="M51.173,3.801c-5.068-5.068-13.315-5.066-18.384,0l-9.192,9.192c-0.781,0.781-0.781,2.047,0,2.828 c0.781,0.781,2.047,0.781,2.828,0l9.192-9.192c1.691-1.69,3.951-2.622,6.363-2.622c2.413,0,4.673,0.932,6.364,2.623 s2.623,3.951,2.623,6.364c0,2.412-0.932,4.672-2.623,6.363L36.325,31.379c-3.51,3.508-9.219,3.508-12.729,0 c-0.781-0.781-2.047-0.781-2.828,0s-0.781,2.048,0,2.828c2.534,2.534,5.863,3.801,9.192,3.801s6.658-1.267,9.192-3.801 l12.021-12.021c2.447-2.446,3.795-5.711,3.795-9.192C54.968,9.512,53.62,6.248,51.173,3.801z"></path><path d="M27.132,40.57l-7.778,7.778c-1.691,1.691-3.951,2.623-6.364,2.623c-2.412,0-4.673-0.932-6.364-2.623 c-3.509-3.509-3.509-9.219,0-12.728L17.94,24.306c1.691-1.69,3.951-2.622,6.364-2.622c2.412,0,4.672,0.932,6.363,2.622 c0.781,0.781,2.047,0.781,2.828,0s0.781-2.047,0-2.828c-5.067-5.067-13.314-5.068-18.384,0L3.797,32.793 c-2.446,2.446-3.794,5.711-3.794,9.192c0,3.48,1.348,6.745,3.795,9.191c2.446,2.447,5.711,3.795,9.191,3.795 c3.481,0,6.746-1.348,9.192-3.795l7.778-7.778c0.781-0.781,0.781-2.047,0-2.828S27.913,39.789,27.132,40.57z"></path></g></svg></a></h4><p class="w-full max-w-3xl xl:max-w-4xl mx-auto sm:text-lg leading-extra-relaxed font-light mb-4  text-bodyWhite">Calculating the position animation in the shader is not only going to be needed to move our instances but it&#x27;ll also be more performant. <br/><br/>When animating <span class="bg-gray-800 px-2 py-1/2 font-code text-white tracking-wide" style="font-size:0.8em">Mesh.position</span> on every tick, the GPU updates the new transformation matrix to the GPU. Causing more a lot of CPU-to-GPU communication, and GPU-Bottlenecking our application.<br/><br/>If we give the GPU(shaders) the tools to calculate the animation. There&#x27;s no need for such heavy communication, and our GPU can run at full speed. This is the principle for libraries like <a href="https://github.com/zadvorsky/three.bas" target="_blank" class=" border-b-1 border-gray-200 text-white font-display tracking-tiny">Three.Bas</a>.</p><p class="w-full max-w-3xl xl:max-w-4xl mx-auto sm:text-lg leading-extra-relaxed font-light mb-4  text-bodyWhite">Let&#x27;s go ahead and animate the instances in the shaders using our new <span class="bg-gray-800 px-2 py-1/2 font-code text-white tracking-wide" style="font-size:0.8em">aCurve </span>attribute:</p><ol class="w-full max-w-3xl xl:max-w-4xl mx-auto list-inside mb-4 xl:text-2lg leading-relaxed pl-1"><li class="mb-1 pl-4 relative sm:text-lg leading-relaxed font-light text-bodyWhite"><span class="absolute left-0 top-0 font-bold text-white text-sm inline-block" style="line-height:1.9rem">0<!-- -->.</span>Define the <span class="bg-gray-800 px-2 py-1/2 font-code text-white tracking-wide" style="font-size:0.8em">aCurve</span> attribute at the top</li><li class="mb-1 pl-4 relative sm:text-lg leading-relaxed font-light text-bodyWhite"><span class="absolute left-0 top-0 font-bold text-white text-sm inline-block" style="line-height:1.9rem">1<!-- -->.</span>(optional) Extract values into separate variables to make easier to read</li><li class="mb-1 pl-4 relative sm:text-lg leading-relaxed font-light text-bodyWhite"><span class="absolute left-0 top-0 font-bold text-white text-sm inline-block" style="line-height:1.9rem">2<!-- -->.</span>Calculate the <span class="bg-gray-800 px-2 py-1/2 font-code text-white tracking-wide" style="font-size:0.8em">CurvePosition</span> and add it to the final position.</li></ol><div class="w-full max-w-3xl xl:max-w-4xl mx-auto  mx-auto my-7"><div class="-ml-5 sm:-ml-3  w-full-bleed-2 sm:w-full-bleed "><pre class="prism-code language-glsl py-5 overflow-x-auto" style="color:#d6deeb;background-color:#1d2132"><div class="token-line relative whitespace-no-wrap" style="color:#d6deeb"><span class="  px-5"><span class="token comment whitespace-pre" style="color:rgb(99, 119, 119);font-style:italic">// 1. Define the attributes</span><span class="token plain whitespace-pre"></span></span></div><div class="token-line relative whitespace-no-wrap" style="color:#d6deeb"><span class="  px-5"><span class="token plain whitespace-pre"></span><span class="token keyword whitespace-pre" style="color:rgb(199, 146, 234);font-style:italic">attribute</span><span class="token plain whitespace-pre"> </span><span class="token keyword whitespace-pre" style="color:rgb(199, 146, 234);font-style:italic">vec4</span><span class="token plain whitespace-pre"> aCurve</span><span class="token punctuation whitespace-pre" style="color:rgb(199, 146, 234);font-style:italic">;</span><span class="token plain whitespace-pre"></span></span></div><div class="token-line relative whitespace-no-wrap" style="color:#d6deeb"><span class="  px-5"><span class="token plain whitespace-pre" style="display:inline-block"></span></span></div><div class="token-line relative whitespace-no-wrap" style="color:#d6deeb"><span class="  px-5"><span class="token plain whitespace-pre"></span><span class="token comment whitespace-pre" style="color:rgb(99, 119, 119);font-style:italic">// Sphere positioning logic</span><span class="token plain whitespace-pre"></span></span></div><div class="token-line relative whitespace-no-wrap" style="color:#d6deeb"><span class="  px-5"><span class="token plain whitespace-pre"></span><span class="token keyword whitespace-pre" style="color:rgb(199, 146, 234);font-style:italic">vec3</span><span class="token plain whitespace-pre"> </span><span class="token function whitespace-pre" style="color:rgb(199, 146, 234);font-style:italic">getCurvePosition</span><span class="token punctuation whitespace-pre" style="color:rgb(199, 146, 234);font-style:italic">(</span><span class="token keyword whitespace-pre" style="color:rgb(199, 146, 234);font-style:italic">float</span><span class="token plain whitespace-pre"> progress</span><span class="token punctuation whitespace-pre" style="color:rgb(199, 146, 234);font-style:italic">,</span><span class="token plain whitespace-pre"> </span><span class="token keyword whitespace-pre" style="color:rgb(199, 146, 234);font-style:italic">float</span><span class="token plain whitespace-pre"> radius</span><span class="token punctuation whitespace-pre" style="color:rgb(199, 146, 234);font-style:italic">,</span><span class="token plain whitespace-pre"> </span><span class="token keyword whitespace-pre" style="color:rgb(199, 146, 234);font-style:italic">float</span><span class="token plain whitespace-pre"> offset</span><span class="token punctuation whitespace-pre" style="color:rgb(199, 146, 234);font-style:italic">)</span><span class="token punctuation whitespace-pre" style="color:rgb(199, 146, 234);font-style:italic">{</span><span class="token plain whitespace-pre"></span></span></div><div class="token-line relative whitespace-no-wrap" style="color:#d6deeb"><span class="  px-5"><span class="token plain whitespace-pre">  </span></span></div><div class="token-line relative whitespace-no-wrap" style="color:#d6deeb"><span class="  px-5"><span class="token plain whitespace-pre">  </span><span class="token keyword whitespace-pre" style="color:rgb(199, 146, 234);font-style:italic">vec3</span><span class="token plain whitespace-pre"> pos </span><span class="token operator whitespace-pre" style="color:rgb(127, 219, 202)">=</span><span class="token plain whitespace-pre"> </span><span class="token keyword whitespace-pre" style="color:rgb(199, 146, 234);font-style:italic">vec3</span><span class="token punctuation whitespace-pre" style="color:rgb(199, 146, 234);font-style:italic">(</span><span class="token number whitespace-pre" style="color:rgb(247, 140, 108)">0.</span><span class="token punctuation whitespace-pre" style="color:rgb(199, 146, 234);font-style:italic">)</span><span class="token punctuation whitespace-pre" style="color:rgb(199, 146, 234);font-style:italic">;</span><span class="token plain whitespace-pre"></span></span></div><div class="token-line relative whitespace-no-wrap" style="color:#d6deeb"><span class="  px-5"><span class="token plain whitespace-pre">  pos</span><span class="token punctuation whitespace-pre" style="color:rgb(199, 146, 234);font-style:italic">.</span><span class="token plain whitespace-pre">x </span><span class="token operator whitespace-pre" style="color:rgb(127, 219, 202)">+</span><span class="token operator whitespace-pre" style="color:rgb(127, 219, 202)">=</span><span class="token plain whitespace-pre"> </span><span class="token function whitespace-pre" style="color:rgb(199, 146, 234);font-style:italic">cos</span><span class="token punctuation whitespace-pre" style="color:rgb(199, 146, 234);font-style:italic">(</span><span class="token plain whitespace-pre">progress </span><span class="token operator whitespace-pre" style="color:rgb(127, 219, 202)">*</span><span class="token plain whitespace-pre">PI </span><span class="token operator whitespace-pre" style="color:rgb(127, 219, 202)">*</span><span class="token number whitespace-pre" style="color:rgb(247, 140, 108)">8.</span><span class="token plain whitespace-pre"> </span><span class="token punctuation whitespace-pre" style="color:rgb(199, 146, 234);font-style:italic">)</span><span class="token plain whitespace-pre"> </span><span class="token operator whitespace-pre" style="color:rgb(127, 219, 202)">*</span><span class="token plain whitespace-pre"> radius </span><span class="token punctuation whitespace-pre" style="color:rgb(199, 146, 234);font-style:italic">;</span><span class="token plain whitespace-pre"></span></span></div><div class="token-line relative whitespace-no-wrap" style="color:#d6deeb"><span class="  px-5"><span class="token plain whitespace-pre">  pos</span><span class="token punctuation whitespace-pre" style="color:rgb(199, 146, 234);font-style:italic">.</span><span class="token plain whitespace-pre">y </span><span class="token operator whitespace-pre" style="color:rgb(127, 219, 202)">+</span><span class="token operator whitespace-pre" style="color:rgb(127, 219, 202)">=</span><span class="token plain whitespace-pre"> </span><span class="token function whitespace-pre" style="color:rgb(199, 146, 234);font-style:italic">sin</span><span class="token punctuation whitespace-pre" style="color:rgb(199, 146, 234);font-style:italic">(</span><span class="token plain whitespace-pre">progress </span><span class="token operator whitespace-pre" style="color:rgb(127, 219, 202)">*</span><span class="token plain whitespace-pre">PI</span><span class="token operator whitespace-pre" style="color:rgb(127, 219, 202)">*</span><span class="token number whitespace-pre" style="color:rgb(247, 140, 108)">8.</span><span class="token punctuation whitespace-pre" style="color:rgb(199, 146, 234);font-style:italic">)</span><span class="token plain whitespace-pre"> </span><span class="token operator whitespace-pre" style="color:rgb(127, 219, 202)">*</span><span class="token plain whitespace-pre"> radius </span><span class="token operator whitespace-pre" style="color:rgb(127, 219, 202)">+</span><span class="token plain whitespace-pre"> </span><span class="token function whitespace-pre" style="color:rgb(199, 146, 234);font-style:italic">sin</span><span class="token punctuation whitespace-pre" style="color:rgb(199, 146, 234);font-style:italic">(</span><span class="token plain whitespace-pre">progress </span><span class="token operator whitespace-pre" style="color:rgb(127, 219, 202)">*</span><span class="token plain whitespace-pre"> PI </span><span class="token operator whitespace-pre" style="color:rgb(127, 219, 202)">*</span><span class="token number whitespace-pre" style="color:rgb(247, 140, 108)">2.</span><span class="token punctuation whitespace-pre" style="color:rgb(199, 146, 234);font-style:italic">)</span><span class="token plain whitespace-pre"> </span><span class="token operator whitespace-pre" style="color:rgb(127, 219, 202)">*</span><span class="token plain whitespace-pre"> </span><span class="token number whitespace-pre" style="color:rgb(247, 140, 108)">30.</span><span class="token punctuation whitespace-pre" style="color:rgb(199, 146, 234);font-style:italic">;</span><span class="token plain whitespace-pre"></span></span></div><div class="token-line relative whitespace-no-wrap" style="color:#d6deeb"><span class="  px-5"><span class="token plain whitespace-pre">  pos</span><span class="token punctuation whitespace-pre" style="color:rgb(199, 146, 234);font-style:italic">.</span><span class="token plain whitespace-pre">z </span><span class="token operator whitespace-pre" style="color:rgb(127, 219, 202)">+</span><span class="token operator whitespace-pre" style="color:rgb(127, 219, 202)">=</span><span class="token plain whitespace-pre"> progress </span><span class="token operator whitespace-pre" style="color:rgb(127, 219, 202)">*</span><span class="token number whitespace-pre" style="color:rgb(247, 140, 108)">200.</span><span class="token plain whitespace-pre"> </span><span class="token operator whitespace-pre" style="color:rgb(127, 219, 202)">-</span><span class="token plain whitespace-pre"> </span><span class="token number whitespace-pre" style="color:rgb(247, 140, 108)">200.</span><span class="token operator whitespace-pre" style="color:rgb(127, 219, 202)">/</span><span class="token number whitespace-pre" style="color:rgb(247, 140, 108)">2.</span><span class="token plain whitespace-pre"> </span><span class="token operator whitespace-pre" style="color:rgb(127, 219, 202)">+</span><span class="token plain whitespace-pre"> offset</span><span class="token punctuation whitespace-pre" style="color:rgb(199, 146, 234);font-style:italic">;</span><span class="token plain whitespace-pre"></span></span></div><div class="token-line relative whitespace-no-wrap" style="color:#d6deeb"><span class="  px-5"><span class="token plain whitespace-pre">  </span></span></div><div class="token-line relative whitespace-no-wrap" style="color:#d6deeb"><span class="  px-5"><span class="token plain whitespace-pre">  </span><span class="token keyword whitespace-pre" style="color:rgb(199, 146, 234);font-style:italic">return</span><span class="token plain whitespace-pre"> pos</span><span class="token punctuation whitespace-pre" style="color:rgb(199, 146, 234);font-style:italic">;</span><span class="token plain whitespace-pre"></span></span></div><div class="token-line relative whitespace-no-wrap" style="color:#d6deeb"><span class="  px-5"><span class="token plain whitespace-pre"></span><span class="token punctuation whitespace-pre" style="color:rgb(199, 146, 234);font-style:italic">}</span><span class="token plain whitespace-pre"></span></span></div><div class="token-line relative whitespace-no-wrap" style="color:#d6deeb"><span class="  px-5"><span class="token plain whitespace-pre"></span><span class="token keyword whitespace-pre" style="color:rgb(199, 146, 234);font-style:italic">void</span><span class="token plain whitespace-pre"> </span><span class="token function whitespace-pre" style="color:rgb(199, 146, 234);font-style:italic">main</span><span class="token punctuation whitespace-pre" style="color:rgb(199, 146, 234);font-style:italic">(</span><span class="token punctuation whitespace-pre" style="color:rgb(199, 146, 234);font-style:italic">)</span><span class="token punctuation whitespace-pre" style="color:rgb(199, 146, 234);font-style:italic">{</span><span class="token plain whitespace-pre"></span></span></div><div class="token-line relative whitespace-no-wrap" style="color:#d6deeb"><span class="  px-5"><span class="token plain whitespace-pre">  </span><span class="token keyword whitespace-pre" style="color:rgb(199, 146, 234);font-style:italic">vec3</span><span class="token plain whitespace-pre"> transformed </span><span class="token operator whitespace-pre" style="color:rgb(127, 219, 202)">=</span><span class="token plain whitespace-pre"> position</span><span class="token punctuation whitespace-pre" style="color:rgb(199, 146, 234);font-style:italic">;</span><span class="token plain whitespace-pre"></span></span></div><div class="token-line relative whitespace-no-wrap" style="color:#d6deeb"><span class="  px-5"><span class="token plain whitespace-pre">  </span></span></div><div class="token-line relative whitespace-no-wrap" style="color:#d6deeb"><span class="  px-5"><span class="token plain whitespace-pre">  </span><span class="token comment whitespace-pre" style="color:rgb(99, 119, 119);font-style:italic">// 2. Extract values from attribute</span><span class="token plain whitespace-pre"></span></span></div><div class="token-line relative whitespace-no-wrap" style="color:#d6deeb"><span class="  px-5"><span class="token plain whitespace-pre">  </span><span class="token keyword whitespace-pre" style="color:rgb(199, 146, 234);font-style:italic">float</span><span class="token plain whitespace-pre"> aRadius </span><span class="token operator whitespace-pre" style="color:rgb(127, 219, 202)">=</span><span class="token plain whitespace-pre"> aCurve</span><span class="token punctuation whitespace-pre" style="color:rgb(199, 146, 234);font-style:italic">.</span><span class="token plain whitespace-pre">x</span><span class="token punctuation whitespace-pre" style="color:rgb(199, 146, 234);font-style:italic">;</span><span class="token plain whitespace-pre"></span></span></div><div class="token-line relative whitespace-no-wrap" style="color:#d6deeb"><span class="  px-5"><span class="token plain whitespace-pre">  </span><span class="token keyword whitespace-pre" style="color:rgb(199, 146, 234);font-style:italic">float</span><span class="token plain whitespace-pre"> aZOffset </span><span class="token operator whitespace-pre" style="color:rgb(127, 219, 202)">=</span><span class="token plain whitespace-pre"> aCurve</span><span class="token punctuation whitespace-pre" style="color:rgb(199, 146, 234);font-style:italic">.</span><span class="token plain whitespace-pre">z</span><span class="token punctuation whitespace-pre" style="color:rgb(199, 146, 234);font-style:italic">;</span><span class="token plain whitespace-pre"></span></span></div><div class="token-line relative whitespace-no-wrap" style="color:#d6deeb"><span class="  px-5"><span class="token plain whitespace-pre">  </span><span class="token keyword whitespace-pre" style="color:rgb(199, 146, 234);font-style:italic">float</span><span class="token plain whitespace-pre"> aSpeed </span><span class="token operator whitespace-pre" style="color:rgb(127, 219, 202)">=</span><span class="token plain whitespace-pre"> aCurve</span><span class="token punctuation whitespace-pre" style="color:rgb(199, 146, 234);font-style:italic">.</span><span class="token plain whitespace-pre">w</span><span class="token punctuation whitespace-pre" style="color:rgb(199, 146, 234);font-style:italic">;</span><span class="token plain whitespace-pre"></span></span></div><div class="token-line relative whitespace-no-wrap" style="color:#d6deeb"><span class="  px-5"><span class="token plain whitespace-pre">  </span><span class="token keyword whitespace-pre" style="color:rgb(199, 146, 234);font-style:italic">float</span><span class="token plain whitespace-pre"> aProgress </span><span class="token operator whitespace-pre" style="color:rgb(127, 219, 202)">=</span><span class="token plain whitespace-pre"> aCurve</span><span class="token punctuation whitespace-pre" style="color:rgb(199, 146, 234);font-style:italic">.</span><span class="token plain whitespace-pre">y</span><span class="token punctuation whitespace-pre" style="color:rgb(199, 146, 234);font-style:italic">;</span><span class="token plain whitespace-pre"></span></span></div><div class="token-line relative whitespace-no-wrap" style="color:#d6deeb"><span class="  px-5"><span class="token plain whitespace-pre">  </span></span></div><div class="token-line relative whitespace-no-wrap" style="color:#d6deeb"><span class="  px-5"><span class="token plain whitespace-pre">  </span><span class="token comment whitespace-pre" style="color:rgb(99, 119, 119);font-style:italic">// 3. Get position and add it to the final position</span><span class="token plain whitespace-pre"></span></span></div><div class="token-line relative whitespace-no-wrap" style="color:#d6deeb"><span class="  px-5"><span class="token plain whitespace-pre">  </span><span class="token keyword whitespace-pre" style="color:rgb(199, 146, 234);font-style:italic">vec3</span><span class="token plain whitespace-pre"> curvePosition </span><span class="token operator whitespace-pre" style="color:rgb(127, 219, 202)">=</span><span class="token plain whitespace-pre"> </span><span class="token function whitespace-pre" style="color:rgb(199, 146, 234);font-style:italic">getCurvePosition</span><span class="token punctuation whitespace-pre" style="color:rgb(199, 146, 234);font-style:italic">(</span><span class="token plain whitespace-pre">aProgress</span><span class="token punctuation whitespace-pre" style="color:rgb(199, 146, 234);font-style:italic">,</span><span class="token plain whitespace-pre"> aRadius</span><span class="token punctuation whitespace-pre" style="color:rgb(199, 146, 234);font-style:italic">,</span><span class="token plain whitespace-pre"> aZOffset</span><span class="token punctuation whitespace-pre" style="color:rgb(199, 146, 234);font-style:italic">)</span><span class="token punctuation whitespace-pre" style="color:rgb(199, 146, 234);font-style:italic">;</span><span class="token plain whitespace-pre"></span></span></div><div class="token-line relative whitespace-no-wrap" style="color:#d6deeb"><span class="  px-5"><span class="token plain whitespace-pre">  transformed </span><span class="token operator whitespace-pre" style="color:rgb(127, 219, 202)">+</span><span class="token operator whitespace-pre" style="color:rgb(127, 219, 202)">=</span><span class="token plain whitespace-pre"> curvePosition</span><span class="token punctuation whitespace-pre" style="color:rgb(199, 146, 234);font-style:italic">;</span><span class="token plain whitespace-pre"></span></span></div><div class="token-line relative whitespace-no-wrap" style="color:#d6deeb"><span class="  px-5"><span class="token plain whitespace-pre">  </span></span></div><div class="token-line relative whitespace-no-wrap" style="color:#d6deeb"><span class="  px-5"><span class="token plain whitespace-pre">  gl_Position </span><span class="token operator whitespace-pre" style="color:rgb(127, 219, 202)">=</span><span class="token plain whitespace-pre"> projectionMatrix </span><span class="token operator whitespace-pre" style="color:rgb(127, 219, 202)">*</span><span class="token plain whitespace-pre"> modelViewMatrix </span><span class="token operator whitespace-pre" style="color:rgb(127, 219, 202)">*</span><span class="token plain whitespace-pre"> </span><span class="token keyword whitespace-pre" style="color:rgb(199, 146, 234);font-style:italic">vec4</span><span class="token punctuation whitespace-pre" style="color:rgb(199, 146, 234);font-style:italic">(</span><span class="token plain whitespace-pre">transformed</span><span class="token punctuation whitespace-pre" style="color:rgb(199, 146, 234);font-style:italic">,</span><span class="token plain whitespace-pre"> </span><span class="token number whitespace-pre" style="color:rgb(247, 140, 108)">1.</span><span class="token punctuation whitespace-pre" style="color:rgb(199, 146, 234);font-style:italic">)</span><span class="token punctuation whitespace-pre" style="color:rgb(199, 146, 234);font-style:italic">;</span><span class="token plain whitespace-pre"></span></span></div><div class="token-line relative whitespace-no-wrap" style="color:#d6deeb"><span class="  px-5"><span class="token plain whitespace-pre"></span><span class="token punctuation whitespace-pre" style="color:rgb(199, 146, 234);font-style:italic">}</span></span></div></pre></div></div><p class="w-full max-w-3xl xl:max-w-4xl mx-auto sm:text-lg leading-extra-relaxed font-light mb-4  text-bodyWhite">Let&#x27;s also add the <span class="bg-gray-800 px-2 py-1/2 font-code text-white tracking-wide" style="font-size:0.8em">aColor</span> attribute to give color the sphere. Since the fragment shader can&#x27;t read attributes. We&#x27;ll need to send aColor from the vertex shader to the fragment shader using a varying <span class="bg-gray-800 px-2 py-1/2 font-code text-white tracking-wide" style="font-size:0.8em">vColor</span>.</p><div class="w-full max-w-3xl xl:max-w-4xl mx-auto  mx-auto my-7"><div class="-ml-5 sm:-ml-3  w-full-bleed-2 sm:w-full-bleed "><pre class="prism-code language-glsl py-5 overflow-x-auto" style="color:#d6deeb;background-color:#1d2132"><div class="token-line relative whitespace-no-wrap" style="color:#d6deeb"><span class="  px-5"><span class="token keyword whitespace-pre" style="color:rgb(199, 146, 234);font-style:italic">attribute</span><span class="token plain whitespace-pre"> </span><span class="token keyword whitespace-pre" style="color:rgb(199, 146, 234);font-style:italic">vec3</span><span class="token plain whitespace-pre"> aColor</span><span class="token punctuation whitespace-pre" style="color:rgb(199, 146, 234);font-style:italic">;</span><span class="token plain whitespace-pre"></span></span></div><div class="token-line relative whitespace-no-wrap" style="color:#d6deeb"><span class="  px-5"><span class="token plain whitespace-pre"></span><span class="token keyword whitespace-pre" style="color:rgb(199, 146, 234);font-style:italic">varying</span><span class="token plain whitespace-pre"> </span><span class="token keyword whitespace-pre" style="color:rgb(199, 146, 234);font-style:italic">vec3</span><span class="token plain whitespace-pre"> vColor</span><span class="token punctuation whitespace-pre" style="color:rgb(199, 146, 234);font-style:italic">;</span><span class="token plain whitespace-pre"></span></span></div><div class="token-line relative whitespace-no-wrap" style="color:#d6deeb"><span class="  px-5"><span class="token plain whitespace-pre"></span><span class="token keyword whitespace-pre" style="color:rgb(199, 146, 234);font-style:italic">void</span><span class="token plain whitespace-pre"> </span><span class="token function whitespace-pre" style="color:rgb(199, 146, 234);font-style:italic">main</span><span class="token punctuation whitespace-pre" style="color:rgb(199, 146, 234);font-style:italic">(</span><span class="token punctuation whitespace-pre" style="color:rgb(199, 146, 234);font-style:italic">)</span><span class="token punctuation whitespace-pre" style="color:rgb(199, 146, 234);font-style:italic">{</span><span class="token plain whitespace-pre"></span></span></div><div class="token-line relative whitespace-no-wrap" style="color:#d6deeb"><span class="  px-5"><span class="token plain whitespace-pre">  </span><span class="token comment whitespace-pre" style="color:rgb(99, 119, 119);font-style:italic">// ...</span><span class="token plain whitespace-pre"></span></span></div><div class="token-line relative whitespace-no-wrap" style="color:#d6deeb"><span class="  px-5"><span class="token plain whitespace-pre">  vColor </span><span class="token operator whitespace-pre" style="color:rgb(127, 219, 202)">=</span><span class="token plain whitespace-pre"> aColor</span><span class="token punctuation whitespace-pre" style="color:rgb(199, 146, 234);font-style:italic">;</span><span class="token plain whitespace-pre"></span></span></div><div class="token-line relative whitespace-no-wrap" style="color:#d6deeb"><span class="  px-5"><span class="token plain whitespace-pre"></span><span class="token punctuation whitespace-pre" style="color:rgb(199, 146, 234);font-style:italic">}</span></span></div></pre></div></div><p class="w-full max-w-3xl xl:max-w-4xl mx-auto sm:text-lg leading-extra-relaxed font-light mb-4  text-bodyWhite">Then, we can actually use it in the fragment shader:</p><div class="w-full max-w-3xl xl:max-w-4xl mx-auto  mx-auto my-7"><div class="-ml-5 sm:-ml-3  w-full-bleed-2 sm:w-full-bleed "><pre class="prism-code language-glsl py-5 overflow-x-auto" style="color:#d6deeb;background-color:#1d2132"><div class="token-line relative whitespace-no-wrap" style="color:#d6deeb"><span class="  px-5"><span class="token keyword whitespace-pre" style="color:rgb(199, 146, 234);font-style:italic">varying</span><span class="token plain whitespace-pre"> </span><span class="token keyword whitespace-pre" style="color:rgb(199, 146, 234);font-style:italic">vec3</span><span class="token plain whitespace-pre"> vColor</span><span class="token punctuation whitespace-pre" style="color:rgb(199, 146, 234);font-style:italic">;</span><span class="token plain whitespace-pre"></span></span></div><div class="token-line relative whitespace-no-wrap" style="color:#d6deeb"><span class="  px-5"><span class="token plain whitespace-pre"></span><span class="token keyword whitespace-pre" style="color:rgb(199, 146, 234);font-style:italic">void</span><span class="token plain whitespace-pre"> </span><span class="token function whitespace-pre" style="color:rgb(199, 146, 234);font-style:italic">main</span><span class="token punctuation whitespace-pre" style="color:rgb(199, 146, 234);font-style:italic">(</span><span class="token punctuation whitespace-pre" style="color:rgb(199, 146, 234);font-style:italic">)</span><span class="token punctuation whitespace-pre" style="color:rgb(199, 146, 234);font-style:italic">{</span><span class="token plain whitespace-pre"></span></span></div><div class="token-line relative whitespace-no-wrap" style="color:#d6deeb"><span class="  px-5"><span class="token plain whitespace-pre">  gl_FragColor </span><span class="token operator whitespace-pre" style="color:rgb(127, 219, 202)">=</span><span class="token plain whitespace-pre"> </span><span class="token keyword whitespace-pre" style="color:rgb(199, 146, 234);font-style:italic">vec4</span><span class="token punctuation whitespace-pre" style="color:rgb(199, 146, 234);font-style:italic">(</span><span class="token plain whitespace-pre">vColor</span><span class="token punctuation whitespace-pre" style="color:rgb(199, 146, 234);font-style:italic">,</span><span class="token plain whitespace-pre"> </span><span class="token number whitespace-pre" style="color:rgb(247, 140, 108)">1.</span><span class="token punctuation whitespace-pre" style="color:rgb(199, 146, 234);font-style:italic">)</span><span class="token punctuation whitespace-pre" style="color:rgb(199, 146, 234);font-style:italic">;</span><span class="token plain whitespace-pre"></span></span></div><div class="token-line relative whitespace-no-wrap" style="color:#d6deeb"><span class="  px-5"><span class="token plain whitespace-pre"></span><span class="token punctuation whitespace-pre" style="color:rgb(199, 146, 234);font-style:italic">}</span></span></div></pre></div></div><p class="w-full max-w-3xl xl:max-w-4xl mx-auto sm:text-lg leading-extra-relaxed font-light mb-4  text-bodyWhite">Let&#x27;s add these new shaders to our <span class="bg-gray-800 px-2 py-1/2 font-code text-white tracking-wide" style="font-size:0.8em">ShaderMaterial</span> and see how it looks:</p><div class="w-full max-w-3xl xl:max-w-4xl mx-auto  mx-auto my-7"><div class="-ml-5 sm:-ml-3  w-full-bleed-2 sm:w-full-bleed "><pre class="prism-code language-javascript py-5 overflow-x-auto" style="color:#d6deeb;background-color:#1d2132"><div class="token-line relative whitespace-no-wrap" style="color:#d6deeb"><span class="  px-5"><span class="token keyword whitespace-pre" style="color:rgb(199, 146, 234);font-style:italic">let</span><span class="token plain whitespace-pre"> material </span><span class="token operator whitespace-pre" style="color:rgb(127, 219, 202)">=</span><span class="token plain whitespace-pre"> </span><span class="token keyword whitespace-pre" style="color:rgb(199, 146, 234);font-style:italic">new</span><span class="token plain whitespace-pre"> </span><span class="token class-name whitespace-pre" style="color:rgb(255, 203, 139)">THREE</span><span class="token class-name punctuation whitespace-pre" style="color:rgb(199, 146, 234);font-style:italic">.</span><span class="token class-name whitespace-pre" style="color:rgb(255, 203, 139)">ShaderMaterial</span><span class="token punctuation whitespace-pre" style="color:rgb(199, 146, 234);font-style:italic">(</span><span class="token punctuation whitespace-pre" style="color:rgb(199, 146, 234);font-style:italic">{</span><span class="token plain whitespace-pre"></span></span></div><div class="token-line relative whitespace-no-wrap" style="color:#d6deeb"><span class="  px-5"><span class="token plain whitespace-pre">  fragmentShader</span><span class="token punctuation whitespace-pre" style="color:rgb(199, 146, 234);font-style:italic">:</span><span class="token plain whitespace-pre"> fragmentShader</span><span class="token punctuation whitespace-pre" style="color:rgb(199, 146, 234);font-style:italic">,</span><span class="token plain whitespace-pre"></span></span></div><div class="token-line relative whitespace-no-wrap" style="color:#d6deeb"><span class="  px-5"><span class="token plain whitespace-pre">  vertexShader</span><span class="token punctuation whitespace-pre" style="color:rgb(199, 146, 234);font-style:italic">:</span><span class="token plain whitespace-pre"> vertexShader</span></span></div><div class="token-line relative whitespace-no-wrap" style="color:#d6deeb"><span class="  px-5"><span class="token plain whitespace-pre"></span><span class="token punctuation whitespace-pre" style="color:rgb(199, 146, 234);font-style:italic">}</span><span class="token punctuation whitespace-pre" style="color:rgb(199, 146, 234);font-style:italic">)</span></span></div></pre></div></div><p class="w-full max-w-3xl xl:max-w-4xl mx-auto mt-2 mb-4 relative border-1 px-5 py-4 font-display text-normal"><span class=" font-body font-bold text-xs bg-white text-darkBlue absolute top-0 uppercase tracking-widest leading-relaxed px-3 py-1/2" style="transform:translateY(-70%);left:20px">note</span>In this demo we&#x27;re doing very simple things with our attributes. We&#x27;re only calculating position and color. You can do pretty much anything you want with them. Like using attributes to give each instance different easings.</p><p class="w-full max-w-3xl xl:max-w-4xl mx-auto sm:text-lg leading-extra-relaxed font-light mb-4  text-bodyWhite">Let&#x27;s fire up that demo again, but this time starting at <em>40k spheres.</em></p><div class="w-full max-w-3xl xl:max-w-4xl mx-auto mb-4">

<p class="text-lowWhite mx-auto text-center font-display text-sm">Yet another demo with a <a href="https://codesandbox.io/s/instanced-geometry-no-animation-8312p" target="_blank" class=" border-b-1 border-gray-200 text-white font-display tracking-tiny">Codesandbox</a>! </p></div><p class="w-full max-w-3xl xl:max-w-4xl mx-auto sm:text-lg leading-extra-relaxed font-light mb-4  text-bodyWhite">Not bad at all! In my desktop, <strong class=" font-light tracking-normal text-white font-feature-2 font-semibold">I can go up to 100k particles without dropping frames.</strong></p><p class="w-full max-w-3xl xl:max-w-4xl mx-auto sm:text-lg leading-extra-relaxed font-light mb-4  text-bodyWhite">And now that the position logic is over in the shaders. We can control the animation with a handful of uniforms. Let&#x27;s add <span class="bg-gray-800 px-2 py-1/2 font-code text-white tracking-wide" style="font-size:0.8em">uTime</span> and make the spheres move through the curve in the vertex shader:</p><div class="w-full max-w-3xl xl:max-w-4xl mx-auto  mx-auto my-7"><div class="-ml-5 sm:-ml-3  w-full-bleed-2 sm:w-full-bleed "><pre class="prism-code language-javascript py-5 overflow-x-auto" style="color:#d6deeb;background-color:#1d2132"><div class="token-line relative whitespace-no-wrap" style="color:#d6deeb"><span class="  px-5"><span class="token keyword whitespace-pre" style="color:rgb(199, 146, 234);font-style:italic">let</span><span class="token plain whitespace-pre"> material </span><span class="token operator whitespace-pre" style="color:rgb(127, 219, 202)">=</span><span class="token plain whitespace-pre"> </span><span class="token keyword whitespace-pre" style="color:rgb(199, 146, 234);font-style:italic">new</span><span class="token plain whitespace-pre"> </span><span class="token class-name whitespace-pre" style="color:rgb(255, 203, 139)">THREE</span><span class="token class-name punctuation whitespace-pre" style="color:rgb(199, 146, 234);font-style:italic">.</span><span class="token class-name whitespace-pre" style="color:rgb(255, 203, 139)">ShaderMaterial</span><span class="token punctuation whitespace-pre" style="color:rgb(199, 146, 234);font-style:italic">(</span><span class="token punctuation whitespace-pre" style="color:rgb(199, 146, 234);font-style:italic">{</span><span class="token plain whitespace-pre"></span></span></div><div class="token-line relative whitespace-no-wrap" style="color:#d6deeb"><span class="  px-5"><span class="token plain whitespace-pre">  fragmentShader</span><span class="token punctuation whitespace-pre" style="color:rgb(199, 146, 234);font-style:italic">:</span><span class="token plain whitespace-pre"> fragmentShader</span><span class="token punctuation whitespace-pre" style="color:rgb(199, 146, 234);font-style:italic">,</span><span class="token plain whitespace-pre"></span></span></div><div class="token-line relative whitespace-no-wrap" style="color:#d6deeb"><span class="  px-5"><span class="token plain whitespace-pre">  vertexShader</span><span class="token punctuation whitespace-pre" style="color:rgb(199, 146, 234);font-style:italic">:</span><span class="token plain whitespace-pre"> vertexShader</span><span class="token punctuation whitespace-pre" style="color:rgb(199, 146, 234);font-style:italic">,</span><span class="token plain whitespace-pre"></span></span></div><div class="token-line relative whitespace-no-wrap" style="color:#d6deeb"><span class="  px-5"><span class="token plain whitespace-pre">  uniforms</span><span class="token punctuation whitespace-pre" style="color:rgb(199, 146, 234);font-style:italic">:</span><span class="token plain whitespace-pre"> </span><span class="token punctuation whitespace-pre" style="color:rgb(199, 146, 234);font-style:italic">{</span><span class="token plain whitespace-pre"></span></span></div><div class="token-line relative whitespace-no-wrap" style="color:#d6deeb"><span class="  px-5"><span class="token plain whitespace-pre">    uTime</span><span class="token punctuation whitespace-pre" style="color:rgb(199, 146, 234);font-style:italic">:</span><span class="token plain whitespace-pre"> </span><span class="token keyword whitespace-pre" style="color:rgb(199, 146, 234);font-style:italic">new</span><span class="token plain whitespace-pre"> </span><span class="token class-name whitespace-pre" style="color:rgb(255, 203, 139)">THREE</span><span class="token class-name punctuation whitespace-pre" style="color:rgb(199, 146, 234);font-style:italic">.</span><span class="token class-name whitespace-pre" style="color:rgb(255, 203, 139)">Uniform</span><span class="token punctuation whitespace-pre" style="color:rgb(199, 146, 234);font-style:italic">(</span><span class="token number whitespace-pre" style="color:rgb(247, 140, 108)">0</span><span class="token punctuation whitespace-pre" style="color:rgb(199, 146, 234);font-style:italic">)</span><span class="token plain whitespace-pre"></span></span></div><div class="token-line relative whitespace-no-wrap" style="color:#d6deeb"><span class="  px-5"><span class="token plain whitespace-pre">  </span><span class="token punctuation whitespace-pre" style="color:rgb(199, 146, 234);font-style:italic">}</span><span class="token plain whitespace-pre"></span></span></div><div class="token-line relative whitespace-no-wrap" style="color:#d6deeb"><span class="  px-5"><span class="token plain whitespace-pre"></span><span class="token punctuation whitespace-pre" style="color:rgb(199, 146, 234);font-style:italic">}</span><span class="token punctuation whitespace-pre" style="color:rgb(199, 146, 234);font-style:italic">)</span></span></div></pre></div></div><div class="w-full max-w-3xl xl:max-w-4xl mx-auto  mx-auto my-7"><div class="-ml-5 sm:-ml-3  w-full-bleed-2 sm:w-full-bleed "><pre class="prism-code language-glsl py-5 overflow-x-auto" style="color:#d6deeb;background-color:#1d2132"><div class="token-line relative whitespace-no-wrap" style="color:#d6deeb"><span class="  px-5"><span class="token keyword whitespace-pre" style="color:rgb(199, 146, 234);font-style:italic">uniform</span><span class="token plain whitespace-pre"> </span><span class="token keyword whitespace-pre" style="color:rgb(199, 146, 234);font-style:italic">float</span><span class="token plain whitespace-pre"> uTime</span><span class="token punctuation whitespace-pre" style="color:rgb(199, 146, 234);font-style:italic">;</span><span class="token plain whitespace-pre"></span></span></div><div class="token-line relative whitespace-no-wrap" style="color:#d6deeb"><span class="  px-5"><span class="token plain whitespace-pre"></span><span class="token keyword whitespace-pre" style="color:rgb(199, 146, 234);font-style:italic">attribute</span><span class="token plain whitespace-pre"> </span><span class="token keyword whitespace-pre" style="color:rgb(199, 146, 234);font-style:italic">vec4</span><span class="token plain whitespace-pre"> aCurve</span><span class="token punctuation whitespace-pre" style="color:rgb(199, 146, 234);font-style:italic">;</span><span class="token plain whitespace-pre"></span></span></div><div class="token-line relative whitespace-no-wrap" style="color:#d6deeb"><span class="  px-5"><span class="token plain whitespace-pre"></span><span class="token keyword whitespace-pre" style="color:rgb(199, 146, 234);font-style:italic">attribute</span><span class="token plain whitespace-pre"> </span><span class="token keyword whitespace-pre" style="color:rgb(199, 146, 234);font-style:italic">vec3</span><span class="token plain whitespace-pre"> aColor</span><span class="token punctuation whitespace-pre" style="color:rgb(199, 146, 234);font-style:italic">;</span><span class="token plain whitespace-pre"></span></span></div><div class="token-line relative whitespace-no-wrap" style="color:#d6deeb"><span class="  px-5"><span class="token plain whitespace-pre"></span><span class="token keyword whitespace-pre" style="color:rgb(199, 146, 234);font-style:italic">varying</span><span class="token plain whitespace-pre"> </span><span class="token keyword whitespace-pre" style="color:rgb(199, 146, 234);font-style:italic">vec3</span><span class="token plain whitespace-pre"> vColor</span><span class="token punctuation whitespace-pre" style="color:rgb(199, 146, 234);font-style:italic">;</span><span class="token plain whitespace-pre"></span></span></div><div class="token-line relative whitespace-no-wrap" style="color:#d6deeb"><span class="  px-5"><span class="token plain whitespace-pre" style="display:inline-block"></span></span></div><div class="token-line relative whitespace-no-wrap" style="color:#d6deeb"><span class="  px-5"><span class="token plain whitespace-pre"></span><span class="token keyword whitespace-pre" style="color:rgb(199, 146, 234);font-style:italic">vec3</span><span class="token plain whitespace-pre"> </span><span class="token function whitespace-pre" style="color:rgb(199, 146, 234);font-style:italic">getCurvePosition</span><span class="token punctuation whitespace-pre" style="color:rgb(199, 146, 234);font-style:italic">(</span><span class="token keyword whitespace-pre" style="color:rgb(199, 146, 234);font-style:italic">float</span><span class="token plain whitespace-pre"> progress</span><span class="token punctuation whitespace-pre" style="color:rgb(199, 146, 234);font-style:italic">,</span><span class="token plain whitespace-pre"> </span><span class="token keyword whitespace-pre" style="color:rgb(199, 146, 234);font-style:italic">float</span><span class="token plain whitespace-pre"> radius</span><span class="token punctuation whitespace-pre" style="color:rgb(199, 146, 234);font-style:italic">,</span><span class="token plain whitespace-pre"> </span><span class="token keyword whitespace-pre" style="color:rgb(199, 146, 234);font-style:italic">float</span><span class="token plain whitespace-pre"> offset</span><span class="token punctuation whitespace-pre" style="color:rgb(199, 146, 234);font-style:italic">)</span><span class="token punctuation whitespace-pre" style="color:rgb(199, 146, 234);font-style:italic">{</span><span class="token plain whitespace-pre"></span></span></div><div class="token-line relative whitespace-no-wrap" style="color:#d6deeb"><span class="  px-5"><span class="token plain whitespace-pre">	</span><span class="token comment whitespace-pre" style="color:rgb(99, 119, 119);font-style:italic">// ...</span><span class="token plain whitespace-pre"></span></span></div><div class="token-line relative whitespace-no-wrap" style="color:#d6deeb"><span class="  px-5"><span class="token plain whitespace-pre"></span><span class="token punctuation whitespace-pre" style="color:rgb(199, 146, 234);font-style:italic">}</span><span class="token plain whitespace-pre"></span></span></div><div class="token-line relative whitespace-no-wrap" style="color:#d6deeb"><span class="  px-5"><span class="token plain whitespace-pre" style="display:inline-block"></span></span></div><div class="token-line relative whitespace-no-wrap" style="color:#d6deeb"><span class="  px-5"><span class="token plain whitespace-pre"></span><span class="token keyword whitespace-pre" style="color:rgb(199, 146, 234);font-style:italic">void</span><span class="token plain whitespace-pre"> </span><span class="token function whitespace-pre" style="color:rgb(199, 146, 234);font-style:italic">main</span><span class="token punctuation whitespace-pre" style="color:rgb(199, 146, 234);font-style:italic">(</span><span class="token punctuation whitespace-pre" style="color:rgb(199, 146, 234);font-style:italic">)</span><span class="token punctuation whitespace-pre" style="color:rgb(199, 146, 234);font-style:italic">{</span><span class="token plain whitespace-pre"></span></span></div><div class="token-line relative whitespace-no-wrap" style="color:#d6deeb"><span class="  px-5"><span class="token plain whitespace-pre">  </span><span class="token keyword whitespace-pre" style="color:rgb(199, 146, 234);font-style:italic">vec3</span><span class="token plain whitespace-pre"> transformed </span><span class="token operator whitespace-pre" style="color:rgb(127, 219, 202)">=</span><span class="token plain whitespace-pre"> position</span><span class="token punctuation whitespace-pre" style="color:rgb(199, 146, 234);font-style:italic">;</span><span class="token plain whitespace-pre"></span></span></div><div class="token-line relative whitespace-no-wrap" style="color:#d6deeb"><span class="  px-5"><span class="token plain whitespace-pre" style="display:inline-block"></span></span></div><div class="token-line relative whitespace-no-wrap" style="color:#d6deeb"><span class="  px-5"><span class="token plain whitespace-pre">  </span><span class="token keyword whitespace-pre" style="color:rgb(199, 146, 234);font-style:italic">float</span><span class="token plain whitespace-pre"> aRadius </span><span class="token operator whitespace-pre" style="color:rgb(127, 219, 202)">=</span><span class="token plain whitespace-pre"> aCurve</span><span class="token punctuation whitespace-pre" style="color:rgb(199, 146, 234);font-style:italic">.</span><span class="token plain whitespace-pre">x</span><span class="token punctuation whitespace-pre" style="color:rgb(199, 146, 234);font-style:italic">;</span><span class="token plain whitespace-pre"></span></span></div><div class="token-line relative whitespace-no-wrap" style="color:#d6deeb"><span class="  px-5"><span class="token plain whitespace-pre">  </span><span class="token keyword whitespace-pre" style="color:rgb(199, 146, 234);font-style:italic">float</span><span class="token plain whitespace-pre"> aZOffset </span><span class="token operator whitespace-pre" style="color:rgb(127, 219, 202)">=</span><span class="token plain whitespace-pre"> aCurve</span><span class="token punctuation whitespace-pre" style="color:rgb(199, 146, 234);font-style:italic">.</span><span class="token plain whitespace-pre">z</span><span class="token punctuation whitespace-pre" style="color:rgb(199, 146, 234);font-style:italic">;</span><span class="token plain whitespace-pre"></span></span></div><div class="token-line relative whitespace-no-wrap" style="color:#d6deeb"><span class="  px-5"><span class="token plain whitespace-pre">  </span><span class="token keyword whitespace-pre" style="color:rgb(199, 146, 234);font-style:italic">float</span><span class="token plain whitespace-pre"> aSpeed </span><span class="token operator whitespace-pre" style="color:rgb(127, 219, 202)">=</span><span class="token plain whitespace-pre"> aCurve</span><span class="token punctuation whitespace-pre" style="color:rgb(199, 146, 234);font-style:italic">.</span><span class="token plain whitespace-pre">w</span><span class="token punctuation whitespace-pre" style="color:rgb(199, 146, 234);font-style:italic">;</span><span class="token plain whitespace-pre"></span></span></div><div class="token-line relative whitespace-no-wrap" style="color:#d6deeb"><span class="  px-5"><span class="token plain whitespace-pre">  </span><span class="token keyword whitespace-pre" style="color:rgb(199, 146, 234);font-style:italic">float</span><span class="token plain whitespace-pre"> aProgress </span><span class="token operator whitespace-pre" style="color:rgb(127, 219, 202)">=</span><span class="token plain whitespace-pre"> </span><span class="token function whitespace-pre" style="color:rgb(199, 146, 234);font-style:italic">mod</span><span class="token punctuation whitespace-pre" style="color:rgb(199, 146, 234);font-style:italic">(</span><span class="token plain whitespace-pre">aCurve</span><span class="token punctuation whitespace-pre" style="color:rgb(199, 146, 234);font-style:italic">.</span><span class="token plain whitespace-pre">y </span><span class="token operator whitespace-pre" style="color:rgb(127, 219, 202)">+</span><span class="token plain whitespace-pre"> uTime </span><span class="token operator whitespace-pre" style="color:rgb(127, 219, 202)">*</span><span class="token plain whitespace-pre"> aSpeed</span><span class="token punctuation whitespace-pre" style="color:rgb(199, 146, 234);font-style:italic">,</span><span class="token plain whitespace-pre"> </span><span class="token number whitespace-pre" style="color:rgb(247, 140, 108)">1.</span><span class="token punctuation whitespace-pre" style="color:rgb(199, 146, 234);font-style:italic">)</span><span class="token punctuation whitespace-pre" style="color:rgb(199, 146, 234);font-style:italic">;</span><span class="token plain whitespace-pre"> </span><span class="token comment whitespace-pre" style="color:rgb(99, 119, 119);font-style:italic">// </span><span class="token plain whitespace-pre"></span></span></div><div class="token-line relative whitespace-no-wrap" style="color:#d6deeb"><span class="  px-5"><span class="token plain whitespace-pre">  </span></span></div><div class="token-line relative whitespace-no-wrap" style="color:#d6deeb"><span class="  px-5"><span class="token plain whitespace-pre">  </span><span class="token keyword whitespace-pre" style="color:rgb(199, 146, 234);font-style:italic">vec3</span><span class="token plain whitespace-pre"> curvePosition </span><span class="token operator whitespace-pre" style="color:rgb(127, 219, 202)">=</span><span class="token plain whitespace-pre"> </span><span class="token function whitespace-pre" style="color:rgb(199, 146, 234);font-style:italic">getCurvePosition</span><span class="token punctuation whitespace-pre" style="color:rgb(199, 146, 234);font-style:italic">(</span><span class="token plain whitespace-pre">aProgress</span><span class="token punctuation whitespace-pre" style="color:rgb(199, 146, 234);font-style:italic">,</span><span class="token plain whitespace-pre"> aRadius</span><span class="token punctuation whitespace-pre" style="color:rgb(199, 146, 234);font-style:italic">,</span><span class="token plain whitespace-pre"> aZOffset</span><span class="token punctuation whitespace-pre" style="color:rgb(199, 146, 234);font-style:italic">)</span><span class="token punctuation whitespace-pre" style="color:rgb(199, 146, 234);font-style:italic">;</span><span class="token plain whitespace-pre"></span></span></div><div class="token-line relative whitespace-no-wrap" style="color:#d6deeb"><span class="  px-5"><span class="token plain whitespace-pre">  transformed </span><span class="token operator whitespace-pre" style="color:rgb(127, 219, 202)">+</span><span class="token operator whitespace-pre" style="color:rgb(127, 219, 202)">=</span><span class="token plain whitespace-pre"> curvePosition</span><span class="token punctuation whitespace-pre" style="color:rgb(199, 146, 234);font-style:italic">;</span><span class="token plain whitespace-pre"></span></span></div><div class="token-line relative whitespace-no-wrap" style="color:#d6deeb"><span class="  px-5"><span class="token plain whitespace-pre">    </span></span></div><div class="token-line relative whitespace-no-wrap" style="color:#d6deeb"><span class="  px-5"><span class="token plain whitespace-pre">  gl_Position </span><span class="token operator whitespace-pre" style="color:rgb(127, 219, 202)">=</span><span class="token plain whitespace-pre"> projectionMatrix </span><span class="token operator whitespace-pre" style="color:rgb(127, 219, 202)">*</span><span class="token plain whitespace-pre"> modelViewMatrix </span><span class="token operator whitespace-pre" style="color:rgb(127, 219, 202)">*</span><span class="token plain whitespace-pre"> </span><span class="token keyword whitespace-pre" style="color:rgb(199, 146, 234);font-style:italic">vec4</span><span class="token punctuation whitespace-pre" style="color:rgb(199, 146, 234);font-style:italic">(</span><span class="token plain whitespace-pre">transformed</span><span class="token punctuation whitespace-pre" style="color:rgb(199, 146, 234);font-style:italic">,</span><span class="token plain whitespace-pre"> </span><span class="token number whitespace-pre" style="color:rgb(247, 140, 108)">1.</span><span class="token punctuation whitespace-pre" style="color:rgb(199, 146, 234);font-style:italic">)</span><span class="token punctuation whitespace-pre" style="color:rgb(199, 146, 234);font-style:italic">;</span><span class="token plain whitespace-pre"></span></span></div><div class="token-line relative whitespace-no-wrap" style="color:#d6deeb"><span class="  px-5"><span class="token plain whitespace-pre">  vColor </span><span class="token operator whitespace-pre" style="color:rgb(127, 219, 202)">=</span><span class="token plain whitespace-pre"> aColor</span><span class="token punctuation whitespace-pre" style="color:rgb(199, 146, 234);font-style:italic">;</span><span class="token plain whitespace-pre"></span></span></div><div class="token-line relative whitespace-no-wrap" style="color:#d6deeb"><span class="  px-5"><span class="token plain whitespace-pre"></span><span class="token punctuation whitespace-pre" style="color:rgb(199, 146, 234);font-style:italic">}</span></span></div></pre></div></div><div class="w-full max-w-3xl xl:max-w-4xl mx-auto mb-4">

<p class="text-lowWhite mx-auto text-center font-display text-sm">The final <a href="https://codesandbox.io/s/github/Anemolo/100k-objects-with-Instanced-Geometries" target="_blank" class=" border-b-1 border-gray-200 text-white font-display tracking-tiny">Codesanbox</a> of the article! And also the <a href="https://github.com/Anemolo/100k-objects-with-Instanced-Geometries" target="_blank" class=" border-b-1 border-gray-200 text-white font-display tracking-tiny">github</a>.</p></div><p class="w-full max-w-3xl xl:max-w-4xl mx-auto sm:text-lg leading-extra-relaxed font-light mb-4  text-bodyWhite">And there we go! We&#x27;re rendering 100k animated spheres!  Our demo is done!</p><p class="w-full max-w-3xl xl:max-w-4xl mx-auto sm:text-lg leading-extra-relaxed font-light mb-4  text-bodyWhite">If you are interested in doing more complex animations. Using the things we learned in this article, I added some extra effects in the demo for you to explore.</p><h3 class="w-full max-w-3xl xl:max-w-4xl mx-auto text-3xl xl:text-3xl2 font-display leading-none  text-normal mb-3 mt-7" id="Recap-&amp;-Closing-Thoughts">Recap &amp; Closing Thoughts<!-- --> <a class="inline-flex" href="#Recap-&amp;-Closing-Thoughts"><svg version="1.1" id="Capa_1" xmlns="http://www.w3.org/2000/svg" x="0px" y="0px" viewBox="0 0 54.971 54.971" style="enable-background:new 0 0 54.971 54.971" class="title-link" xml:space="preserve"><g><path d="M51.173,3.801c-5.068-5.068-13.315-5.066-18.384,0l-9.192,9.192c-0.781,0.781-0.781,2.047,0,2.828 c0.781,0.781,2.047,0.781,2.828,0l9.192-9.192c1.691-1.69,3.951-2.622,6.363-2.622c2.413,0,4.673,0.932,6.364,2.623 s2.623,3.951,2.623,6.364c0,2.412-0.932,4.672-2.623,6.363L36.325,31.379c-3.51,3.508-9.219,3.508-12.729,0 c-0.781-0.781-2.047-0.781-2.828,0s-0.781,2.048,0,2.828c2.534,2.534,5.863,3.801,9.192,3.801s6.658-1.267,9.192-3.801 l12.021-12.021c2.447-2.446,3.795-5.711,3.795-9.192C54.968,9.512,53.62,6.248,51.173,3.801z"></path><path d="M27.132,40.57l-7.778,7.778c-1.691,1.691-3.951,2.623-6.364,2.623c-2.412,0-4.673-0.932-6.364-2.623 c-3.509-3.509-3.509-9.219,0-12.728L17.94,24.306c1.691-1.69,3.951-2.622,6.364-2.622c2.412,0,4.672,0.932,6.363,2.622 c0.781,0.781,2.047,0.781,2.828,0s0.781-2.047,0-2.828c-5.067-5.067-13.314-5.068-18.384,0L3.797,32.793 c-2.446,2.446-3.794,5.711-3.794,9.192c0,3.48,1.348,6.745,3.795,9.191c2.446,2.447,5.711,3.795,9.191,3.795 c3.481,0,6.746-1.348,9.192-3.795l7.778-7.778c0.781-0.781,0.781-2.047,0-2.828S27.913,39.789,27.132,40.57z"></path></g></svg></a></h3><p class="w-full max-w-3xl xl:max-w-4xl mx-auto sm:text-lg leading-extra-relaxed font-light mb-4  text-bodyWhite">Let&#x27;s go over what we learned through the article:</p><ol class="w-full max-w-3xl xl:max-w-4xl mx-auto list-inside mb-4 xl:text-2lg leading-relaxed pl-1"><li class="mb-1 pl-4 relative sm:text-lg leading-relaxed font-light text-bodyWhite"><span class="absolute left-0 top-0 font-bold text-white text-sm inline-block" style="line-height:1.9rem">0<!-- -->.</span><a href="#Using-meshes-to-create-100k-spheres" target="" class=" border-b-1 border-gray-200 text-white font-display tracking-tiny">Creating 100k meshes has bad performance</a> because it creates too many draw calls.</li><li class="mb-1 pl-4 relative sm:text-lg leading-relaxed font-light text-bodyWhite"><span class="absolute left-0 top-0 font-bold text-white text-sm inline-block" style="line-height:1.9rem">1<!-- -->.</span><a href="#Too-many-draw-calls" target="" class=" border-b-1 border-gray-200 text-white font-display tracking-tiny">Draw calls are CPU-to-GPU communication</a>. Drawing the objects is fast, but communicating is slow.  <em>Fewer draw calls, better performance.</em></li><li class="mb-1 pl-4 relative sm:text-lg leading-relaxed font-light text-bodyWhite"><span class="absolute left-0 top-0 font-bold text-white text-sm inline-block" style="line-height:1.9rem">2<!-- -->.</span><a href="#Reducing-draw-calls-by-Merging-Geometries" target="" class=" border-b-1 border-gray-200 text-white font-display tracking-tiny">Merging geometries</a> into a single mesh reduces draw calls to one. But adds overhead in the CPU depending on the size of the geometries. <em>Merging geometries takes time.</em></li><li class="mb-1 pl-4 relative sm:text-lg leading-relaxed font-light text-bodyWhite"><span class="absolute left-0 top-0 font-bold text-white text-sm inline-block" style="line-height:1.9rem">3<!-- -->.</span><a href="#Reducing-draw-calls-by-Instancing-Geometries" target="" class=" border-b-1 border-gray-200 text-white font-display tracking-tiny">Instanced Geometries</a> send the base geometry once, and the GPU takes care of drawing how many you want. Creating a single draw call, and minimal data. It only works if all instances have the same geometry. </li><li class="mb-1 pl-4 relative sm:text-lg leading-relaxed font-light text-bodyWhite"><span class="absolute left-0 top-0 font-bold text-white text-sm inline-block" style="line-height:1.9rem">4<!-- -->.</span><a href="#Reducing-draw-calls-by-Instancing-Geometries" target="" class=" border-b-1 border-gray-200 text-white font-display tracking-tiny">InstancedBufferAttributes</a> store data for each geometry instance. And are used in the shaders(GPU).</li><li class="mb-1 pl-4 relative sm:text-lg leading-relaxed font-light text-bodyWhite"><span class="absolute left-0 top-0 font-bold text-white text-sm inline-block" style="line-height:1.9rem">5<!-- -->.</span><a href="#Animating-in-the-Shaders" target="" class=" border-b-1 border-gray-200 text-white font-display tracking-tiny">Animating in the shaders</a> gives us better performance because we minimize CPU-to-GPU communication.</li></ol><p class="w-full max-w-3xl xl:max-w-4xl mx-auto sm:text-lg leading-extra-relaxed font-light mb-4  text-bodyWhite">Instantiating and animating in the shaders is a bit cumbersome. Pretty different than just using meshes and animating the matrix. But it gives us a really good performance boost! From 7,000 spheres with meshes to 100k spheres with instanced geometries!</p><p class="w-full max-w-3xl xl:max-w-4xl mx-auto sm:text-lg leading-extra-relaxed font-light mb-4  text-bodyWhite">In the next article of the series, we&#x27;re going to take advantage of this new-found performance to build a full-on curl simulation!</p><p class="w-full max-w-3xl xl:max-w-4xl mx-auto sm:text-lg leading-extra-relaxed font-light mb-4  text-bodyWhite">If you enjoyed the article or would like to nerd out about WebGL. Feel free to reach out on Twitter! </p><p class="w-full max-w-3xl xl:max-w-4xl mx-auto sm:text-lg leading-extra-relaxed font-light mb-4  text-bodyWhite">Next in series: Curl simulation &amp; FBO (coming soon)</p><h4 class="w-full max-w-3xl xl:max-w-4xl mx-auto sm:text-lg font-bold tracking-widest uppercase leading-none  text-normal mb-3 mt-7" id="Further-research">Further research<!-- --> <a class="inline-flex" href="#Further-research"><svg version="1.1" id="Capa_1" xmlns="http://www.w3.org/2000/svg" x="0px" y="0px" viewBox="0 0 54.971 54.971" style="enable-background:new 0 0 54.971 54.971" class="title-link" xml:space="preserve"><g><path d="M51.173,3.801c-5.068-5.068-13.315-5.066-18.384,0l-9.192,9.192c-0.781,0.781-0.781,2.047,0,2.828 c0.781,0.781,2.047,0.781,2.828,0l9.192-9.192c1.691-1.69,3.951-2.622,6.363-2.622c2.413,0,4.673,0.932,6.364,2.623 s2.623,3.951,2.623,6.364c0,2.412-0.932,4.672-2.623,6.363L36.325,31.379c-3.51,3.508-9.219,3.508-12.729,0 c-0.781-0.781-2.047-0.781-2.828,0s-0.781,2.048,0,2.828c2.534,2.534,5.863,3.801,9.192,3.801s6.658-1.267,9.192-3.801 l12.021-12.021c2.447-2.446,3.795-5.711,3.795-9.192C54.968,9.512,53.62,6.248,51.173,3.801z"></path><path d="M27.132,40.57l-7.778,7.778c-1.691,1.691-3.951,2.623-6.364,2.623c-2.412,0-4.673-0.932-6.364-2.623 c-3.509-3.509-3.509-9.219,0-12.728L17.94,24.306c1.691-1.69,3.951-2.622,6.364-2.622c2.412,0,4.672,0.932,6.363,2.622 c0.781,0.781,2.047,0.781,2.828,0s0.781-2.047,0-2.828c-5.067-5.067-13.314-5.068-18.384,0L3.797,32.793 c-2.446,2.446-3.794,5.711-3.794,9.192c0,3.48,1.348,6.745,3.795,9.191c2.446,2.447,5.711,3.795,9.191,3.795 c3.481,0,6.746-1.348,9.192-3.795l7.778-7.778c0.781-0.781,0.781-2.047,0-2.828S27.913,39.789,27.132,40.57z"></path></g></svg></a></h4><ul class="w-full max-w-3xl xl:max-w-4xl mx-auto list-inside mb-4 xl:text-2lg leading-relaxed pl-1"><li class="mb-1 pl-4 relative sm:text-lg leading-relaxed font-light text-bodyWhite"><span class="absolute left-0 top-0 font-bold text-white text-sm inline-block" style="line-height:1.9rem">0<!-- -->.</span><a href="https://medium.com/@Zadvorsky/into-vertex-shaders-part-3-memory-management-9a1204221a0a" target="_blank" class=" border-b-1 border-gray-200 text-white font-display tracking-tiny">Intro to Vertex Shaders - Memory management</a></li><li class="mb-1 pl-4 relative sm:text-lg leading-relaxed font-light text-bodyWhite"><span class="absolute left-0 top-0 font-bold text-white text-sm inline-block" style="line-height:1.9rem">1<!-- -->.</span><a href="https://thebookofshaders.com/01/" target="_blank" class=" border-b-1 border-gray-200 text-white font-display tracking-tiny">Why are shaders fast?</a></li><li class="mb-1 pl-4 relative sm:text-lg leading-relaxed font-light text-bodyWhite"><span class="absolute left-0 top-0 font-bold text-white text-sm inline-block" style="line-height:1.9rem">2<!-- -->.</span><a href="https://stackoverflow.com/questions/4853856/why-are-draw-calls-expensive" target="_blank" class=" border-b-1 border-gray-200 text-white font-display tracking-tiny">Why are draw calls expensive?</a></li><li class="mb-1 pl-4 relative sm:text-lg leading-relaxed font-light text-bodyWhite"><span class="absolute left-0 top-0 font-bold text-white text-sm inline-block" style="line-height:1.9rem">3<!-- -->.</span><a href="https://www.wepc.com/tips/cpu-gpu-bottleneck/" target="_blank" class=" border-b-1 border-gray-200 text-white font-display tracking-tiny">The CPU bottlenecks GPU</a></li><li class="mb-1 pl-4 relative sm:text-lg leading-relaxed font-light text-bodyWhite"><span class="absolute left-0 top-0 font-bold text-white text-sm inline-block" style="line-height:1.9rem">4<!-- -->.</span><a href="https://gamedev.stackexchange.com/questions/133194/webgl-draw-call-batching-and-optimizations" target="_blank" class=" border-b-1 border-gray-200 text-white font-display tracking-tiny">Draw call batching and optimization</a></li><li class="mb-1 pl-4 relative sm:text-lg leading-relaxed font-light text-bodyWhite"><span class="absolute left-0 top-0 font-bold text-white text-sm inline-block" style="line-height:1.9rem">5<!-- -->.</span><a href="https://medium.com/@toncijukic/draw-calls-in-a-nutshell-597330a85381" target="_blank" class=" border-b-1 border-gray-200 text-white font-display tracking-tiny">Draw calls in a nutshell</a></li><li class="mb-1 pl-4 relative sm:text-lg leading-relaxed font-light text-bodyWhite"><span class="absolute left-0 top-0 font-bold text-white text-sm inline-block" style="line-height:1.9rem">6<!-- -->.</span><a href="https://webglfundamentals.org/webgl/lessons/webgl-drawing-multiple-things.html" target="_blank" class=" border-b-1 border-gray-200 text-white font-display tracking-tiny">WebGL Fundamentals - Drawing Multiple Things</a></li><li class="mb-1 pl-4 relative sm:text-lg leading-relaxed font-light text-bodyWhite"><span class="absolute left-0 top-0 font-bold text-white text-sm inline-block" style="line-height:1.9rem">7<!-- -->.</span><a href="http://www.theappguruz.com/blog/learn-draw-call-reduction-and-make-your-games-run-superfast" target="_blank" class=" border-b-1 border-gray-200 text-white font-display tracking-tiny">Reduce draw calls and make your game super fast</a></li></ul><p class="w-full max-w-3xl xl:max-w-4xl mx-auto sm:text-lg leading-extra-relaxed font-light mb-4  text-bodyWhite">Note: Thanks to <a href="https://twitter.com/webdesign_ml" target="_blank" class=" border-b-1 border-gray-200 text-white font-display tracking-tiny">Matrin</a> for helping me out with feedback. And to <a href="https://twitter.com/marioecg" target="_blank" class=" border-b-1 border-gray-200 text-white font-display tracking-tiny">mario</a> for keeping me sane while I write the articles&lt;3</p><p class="w-full max-w-3xl xl:max-w-4xl mx-auto sm:text-lg leading-extra-relaxed font-light mb-4  text-bodyWhite"></p></div><div class="mt-5"><div class="relative w-full px-4 sm:px-0 mb-9 pt-6 md:pt-9 border-t-1 border-white"><div class="flex justify-center flex-col md:flex-row"><div class="w-full mx-auto md:mx-0 sm:w-10/12 md:w-7/12 lg:w-5/12 pb-4 md:pb-0 sm:pr-1"><h3 class="font-display text-2lg xs:text-xl mb-3 sm:text-2xl lg:text-3xl font-regular leading-tight tracking-normal">Me make article or project.<br/>You get email or read it?</h3><p class="text-sm leading-relaxed tracking-wide text-lowWhite">A newsletter about learning Web-creative! <br/>I&#x27;ll share anything interesting I read or write. WebGl, canvas, creative-coding etc</p></div><form class="w-full mx-auto sm:w-10/12 md:mx-0 md:w-4/12 lg:w-3/12 md:pl-1 flex flex-col items-end md:-mt-5"><label for="name-input" class="w-full mb-1 pl-1 font-display">Name</label><input type="text" id="name-input" class="mb-4 py-2 px-4 w-full border-1 border-white bg-transparent rounded-soft font-display" name="name" placeholder="Jose"/><p for="email-input" class="w-full mb-1 pl-1 font-display">Email</p><input type="text" id="email-input" class="mb-4 py-2 px-4 w-full border-1 border-white bg-transparent rounded-soft font-display" name="email" placeholder="jose@gmail.com"/><input type="submit" class="e-bump cursor-pointer font-display w-full sm:w-auto rounded-soft flex-grow-0 border-1 border-white hover:bg-transparent hover:text-white py-2 px-6 bg-white text-black " value="Subscribe"/></form></div></div></div></article></div><footer class="pb-4 py-6 px-4 xs:px-6 sm:pb-6 md:px-7  w-12"><div class="w-full mx-auto flex flex-row justify-between font-display text-xs"><h5 class="">Daniel Velasquez © <!-- -->2020</h5><ul class="list-none flex"><li class="pr-4 last:pr-0"><a href="mailto:velasquezdanield@gmail.com" target="_blank">Email</a></li><li class="pr-4 last:pr-0"><a href="https://twitter.com/Anemolito" target="_blank">Twitter</a></li></ul></div></footer></div></div></div><script>
    (function(f, a, t, h, o, m){
      a[h]=a[h]||function(){
        (a[h].q=a[h].q||[]).push(arguments)
      };
      o=f.createElement('script'),
      m=f.getElementsByTagName('script')[0];
      o.async=1; o.src=t; o.id='fathom-script';
      m.parentNode.insertBefore(o,m)
    })(document, window, '//cdn.usefathom.com/tracker.js', 'fathom');
    fathom('set', 'siteId', 'LELDQKIT');
  </script><script id="gatsby-script-loader">/*<![CDATA[*/window.pagePath="/blog/rendering-100k-spheres-instantianing-and-draw-calls/";window.webpackCompilationHash="552ba23ca7063ab8acc9";/*]]>*/</script><script id="gatsby-chunk-mapping">/*<![CDATA[*/window.___chunkMapping={"app":["/app-5d74ca955f61abd7afbb.js"],"component---src-templates-blog-post-js":["/component---src-templates-blog-post-js-f1eb32bc38fa7bff34a8.js"],"component---src-pages-404-js":["/component---src-pages-404-js-f6fe11f746f97afa97b1.js"],"component---src-pages-about-js":["/component---src-pages-about-js-1e59388aa5c0555ad457.js"],"component---src-pages-archive-js":["/component---src-pages-archive-js-d50a1dba5b78abebf0e8.js"],"component---src-pages-blog-js":["/component---src-pages-blog-js-5ac64edeca08253d93fa.js"],"component---src-pages-index-js":["/component---src-pages-index-js-00b2d20d99c3d97a2703.js"]};/*]]>*/</script><script src="/webpack-runtime-a9ec4b2830606288efa7.js" async=""></script><script src="/app-5d74ca955f61abd7afbb.js" async=""></script><script src="/commons-1758a6b6f23ad1712269.js" async=""></script><script src="/styles-d30453f2f4859e0a1e01.js" async=""></script><script src="/component---src-templates-blog-post-js-f1eb32bc38fa7bff34a8.js" async=""></script></body></html>
