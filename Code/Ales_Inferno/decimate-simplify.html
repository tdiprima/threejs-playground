<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta content="width=device-width, initial-scale=1.0" name="viewport">
  <title>Decimate</title>
  <link href="/css/main.css" rel="stylesheet">
</head>
<body>
<div id="info"></div>
<script src="/build/three.min.js"></script>
<script src="/js/simplify.js"></script>
<script>
  let scene = new THREE.Scene();
  let camera = new THREE.PerspectiveCamera(75, window.innerWidth / window.innerHeight, 0.1, 1000);
  let renderer = new THREE.WebGLRenderer();
  renderer.setSize(window.innerWidth, window.innerHeight);
  document.body.appendChild(renderer.domElement);

  let points = [-4.977912422015407, 3.3024199482638807, 0, -4.919634422928398, 3.3024199482638807, 0, -4.871069423689224, 3.282993948568211, 8.881784197001252e-16, -4.861356423841388, 3.282993948568212, 0, -4.861356423841388, 3.282993948568212, 0, -4.861356423841388, 3.282993948568212, 0, -4.861356423841388, 3.282993948568212, 0, -4.871069423689224, 3.282993948568211, 8.881784197001252e-16, -4.871069423689224, 3.282993948568211, 8.881784197001252e-16, -4.871069423689224, 3.282993948568211, 8.881784197001252e-16, -4.871069423689224, 3.282993948568211, 8.881784197001252e-16, -4.871069423689224, 3.282993948568211, 8.881784197001252e-16, -4.861356423841388, 3.282993948568212, 0, -4.861356423841388, 3.282993948568212, 0, -4.841930424145719, 3.2829939485682114, 0, -4.803078424754378, 3.2829939485682105, 8.881784197001252e-16, -4.793365424906543, 3.2732809487203753, 0, -4.793365424906543, 3.2732809487203753, 0, -4.793365424906543, 3.26356794887254, 0, -4.783652425058709, 3.2344289493290366, 0, -4.764226425363038, 3.215002949633366, 0, -4.744800425667368, 3.195576949937696, 0, -4.725374425971699, 3.1858639500898613, 0, -4.725374425971699, 3.1761509502420266, -8.881784197001252e-16, -4.715661426123864, 3.176150950242026, 0, -4.715661426123864, 3.166437950394191, 0, -4.6865224265803604, 3.156724950546356, -8.881784197001252e-16, -4.676809426732525, 3.1470119506985217, 0, -4.667096426884691, 3.1372989508506874, -8.881784197001252e-16, -4.667096426884691, 3.1372989508506874, -8.881784197001252e-16, -4.657383427036855, 3.127585951002852, 0, -4.647670427189019, 3.1275859510028523, 8.881784197001252e-16, -4.6185314276455145, 3.098446951459347, 0, -4.608818427797682, 3.098446951459347, -8.881784197001252e-16, -4.599105427949845, 3.0790209517636775, -8.881784197001252e-16, -4.58939242810201, 3.069307951915842, 0, -4.56996642840634, 3.049881952220172, 0, -4.5602534285585055, 3.040168952372338, 0, -4.540827428862835, 3.020742952676667, 0, -4.540827428862835, 3.020742952676667, 0, -4.540827428862835, 3.0110299528288325, 8.881784197001252e-16, -4.540827428862835, 3.001316952980997, 0, -4.540827428862836, 2.991603953133162, 0, -4.550540428710671, 2.9916039531331626, -8.881784197001252e-16, -4.58939242810201, 2.962464953589657, 0, -4.60881842779768, 2.952751953741823, 0, -4.637957427341185, 2.9333259540461527, 0, -4.647670427189019, 2.9333259540461523, 0, -4.647670427189019, 2.9333259540461523, 0, -4.657383427036855, 2.9333259540461523, -8.881784197001252e-16, -4.657383427036855, 2.9333259540461523, -8.881784197001252e-16, -4.68652242658036, 2.943038953893988, 0, -4.725374425971698, 2.952751953741823, 0, -4.793365424906544, 2.991603953133162, 0, -4.80307842475438, 3.0110299528288325, -8.881784197001252e-16, -4.822504424450048, 3.020742952676667, 0, -4.832217424297885, 3.0304559525245023, 0, -4.861356423841388, 3.0498819522201717, 0, -4.880782423537059, 3.059594952068007, 0, -4.909921423080564, 3.079020951763677, 0, -4.909921423080564, 3.079020951763677, 0, -4.909921423080564, 3.079020951763677, 0, -4.909921423080564, 3.0887339516115118, 0, -4.909921423080564, 3.0887339516115118, 0, -4.909921423080563, 3.1081599513071816, 0, -4.9196344229283975, 3.127585951002852, 0, -4.9196344229283975, 3.1372989508506866, 0, -4.919634422928399, 3.156724950546357, -8.881784197001252e-16, -4.9293474227762335, 3.166437950394191, 0, -4.9293474227762335, 3.185863950089862, 0, -4.929347422776234, 3.1955769499376965, 0, -4.939060422624069, 3.2150029496333667, 0, -4.939060422624069, 3.2150029496333667, 0, -4.939060422624067, 3.224715949481201, 0, -4.939060422624067, 3.224715949481201, 0, -4.939060422624067, 3.224715949481201, 0, -4.939060422624067, 3.224715949481201, 0, -4.939060422624069, 3.234428949329036, 0, -4.939060422624069, 3.234428949329036, 0, -4.939060422624069, 3.234428949329036, 0, -4.939060422624069, 3.234428949329036, 0, -4.939060422624069, 3.234428949329036, 0, -4.948773422471904, 3.244141949176871, 8.881784197001252e-16, -4.948773422471904, 3.244141949176871, 8.881784197001252e-16, -4.948773422471904, 3.2538549490247064, 0, -4.958486422319738, 3.2635679488725406, 0, -4.958486422319739, 3.273280948720376, -8.881784197001252e-16, -4.968199422167572, 3.2732809487203753, 0, -4.968199422167572, 3.2732809487203753, 0, -4.968199422167573, 3.282993948568211, 0, -4.968199422167573, 3.282993948568211, 0, -4.987625421863242, 3.3024199482638807, 0, -4.997338421711078, 3.3024199482638803, 0, -4.997338421711078, 3.3024199482638803, 0, -4.997338421711078, 3.3024199482638803, 0, -4.997338421711078, 3.312132948111715, 0, -4.997338421711078, 3.312132948111715, 0, -4.997338421711078, 3.312132948111715, 0];
  let len = points.length;
  console.log("original length:", len);

  reducePoints(points, scene);

  camera.position.z = 10;

  window.addEventListener('resize', () => {
    renderer.setSize(window.innerWidth, window.innerHeight);
    camera.aspect = window.innerWidth / window.innerHeight;
    camera.updateProjectionMatrix();
  });

  (function animate() {
    requestAnimationFrame(animate);
    renderer.render(scene, camera);
  })();

  function reducePoints(points, scene) {
    // CONVERT THE ARRAY
    let geometry = new THREE.BufferGeometry();

    // Convert array of points to Float32Array
    let positions = new Float32Array(points.length);
    for (let i = 0; i < points.length; i++) {
      positions[i] = points[i];
    }
    // console.log("positions", positions.length);

    // CREATE LINE.
    let positionAttribute = new THREE.BufferAttribute(positions, 3);
    geometry.setAttribute('position', positionAttribute);

    // Create THREE.Line* object using the geometry and a material
    let material = new THREE.LineBasicMaterial({color: 0x00ff00});
    // let line = new THREE.LineSegments(geometry, material);
    let line = new THREE.Line(geometry, material);
    scene.add(line);

    // CREATE ARRAYS IN CORRECT FORMAT FOR SIMPLIFICATION
    let simpArray = [];

    for (let i = 0, j = 0; i < points.length; i++, j += 3) {
      // Convert points to {x: Number, y: Number}
      let simpObject = {};
      simpObject.x = points[i];
      simpObject.y = points[i + 1];
      simpArray.push(simpObject);
    }
    // console.log("simpArray", simpArray);

    let tolerance = 5;
    // NOW, USE SIMPLIFY:
    let simplifiedPoints = simplify(simpArray, tolerance, true);
    let len1 = simplifiedPoints.length;
    console.log("new length:", len1);

    let info = document.getElementById("info");
    info.innerHTML = `Original points array length: ${len}, new length: ${len1}`;
  }
</script>
</body>
</html>
