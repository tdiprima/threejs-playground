<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta content="IE=edge" http-equiv="X-UA-Compatible">
  <meta content="width=device-width, initial-scale=1.0" name="viewport">
  <title>Smooth Image Color Transition</title>
  <style>
    #slider {
      width: 400px;
      margin-bottom: 20px;
    }
  </style>
</head>
<body>
<input id="slider" max="1" min="0" step="0.01" type="range" value="0">
<div id="canvas-container"></div>

<script src="/build/three.js"></script>
<script>
  // Shader code
  const vertexShader = `
  void main() {
    gl_Position = projectionMatrix * modelViewMatrix * vec4(position, 1.0);
  }
`;

  /*
  The fragment shader receives a time uniform (uTime) that represents the position of the slider, ranging from 0 to 1.
  Based on this value, the shader calculates the hue of the color and smoothly transitions between the colors of the
  rainbow.
  */
  const fragmentShader = `
  uniform float uTime;
  varying vec2 vUv;

  void main() {
    vec3 color = vec3(0.0);
    float t = mod(uTime, 1.0);
    float hue = fract(t * 6.0);

    if (hue < 0.1667) {
      color = mix(vec3(1.0, 0.0, 0.0), vec3(1.0, 0.0, 1.0), hue * 6.0);
    } else if (hue < 0.3333) {
      color = mix(vec3(1.0, 0.0, 1.0), vec3(0.0, 0.0, 1.0), (hue - 0.1667) * 6.0);
    } else if (hue < 0.5) {
      color = mix(vec3(0.0, 0.0, 1.0), vec3(0.0, 1.0, 1.0), (hue - 0.3333) * 6.0);
    } else if (hue < 0.6667) {
      color = mix(vec3(0.0, 1.0, 1.0), vec3(0.0, 1.0, 0.0), (hue - 0.5) * 6.0);
    } else if (hue < 0.8333) {
      color = mix(vec3(0.0, 1.0, 0.0), vec3(1.0, 1.0, 0.0), (hue - 0.6667) * 6.0);
    } else {
      color = mix(vec3(1.0, 1.0, 0.0), vec3(1.0, 0.0, 0.0), (hue - 0.8333) * 6.0);
    }

    gl_FragColor = vec4(color, 1.0);
  }
`;

  // Three.js setup
  const scene = new THREE.Scene();
  const camera = new THREE.PerspectiveCamera(75, window.innerWidth / window.innerHeight, 0.1, 1000);
  camera.position.z = 5;

  const renderer = new THREE.WebGLRenderer({antialias: true});
  renderer.setSize(window.innerWidth, window.innerHeight);
  document.getElementById('canvas-container').appendChild(renderer.domElement);

  // Slider
  const slider = document.getElementById('slider');

  // Uniforms
  const uniforms = {
    uTime: {value: 0}
  };

  // Material
  const material = new THREE.ShaderMaterial({
    uniforms,
    vertexShader,
    fragmentShader
  });

  // Geometry
  const geometry = new THREE.PlaneGeometry(2, 2);

  // Mesh
  const mesh = new THREE.Mesh(geometry, material);
  scene.add(mesh);

  // Animation loop
  function animate() {
    requestAnimationFrame(animate);

    // The animate function updates the shader's uTime uniform based on the slider's value.
    uniforms.uTime.value = slider.value;

    // Render scene
    renderer.render(scene, camera);
  }

  animate();
</script>
</body>
</html>
